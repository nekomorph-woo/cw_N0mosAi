# N0mosAi - é«˜çº§åŠŸèƒ½å¼€å‘è®¡åˆ’ (Phase 2)

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
> **æœ€åæ›´æ–°**: 2026-02-25
> **çŠ¶æ€**: Draft
> **å‰ç½®ä¾èµ–**: Phase 1 (Core Features) å®Œæˆ
> **å…³è”æ–‡æ¡£**: [06_Development_Plan_Overview.md](06_Development_Plan_Overview.md)

æœ¬æ–‡æ¡£å®šä¹‰ Phase 2 (Advanced Features) çš„è¯¦ç»†å¼€å‘è®¡åˆ’ï¼Œç›®æ ‡æ˜¯æå‡ç”¨æˆ·ä½“éªŒå’Œæ™ºèƒ½åŒ–æ°´å¹³ã€‚

---

## ç›®å½•

1. [é˜¶æ®µç›®æ ‡](#1-é˜¶æ®µç›®æ ‡)
2. [Gate 2.1: Validator Subagent](#2-gate-21-validator-subagent)
3. [Gate 2.2: Revert Manager](#3-gate-22-revert-manager)
4. [Gate 2.3: è¯šå®è¿½é—®å¼•æ“](#4-gate-23-è¯šå®è¿½é—®å¼•æ“)
5. [Gate 2.4: project-why.md æ™ºèƒ½ç»´æŠ¤](#5-gate-24-project-whymd-æ™ºèƒ½ç»´æŠ¤)
6. [Gate 2.5: PR è‡ªåŠ¨ç”Ÿæˆ](#6-gate-25-pr-è‡ªåŠ¨ç”Ÿæˆ)
7. [Gate 2.6: SKILL Marketplace](#7-gate-26-skill-marketplace)
8. [Gate 2.7: ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶](#8-gate-27-ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶)
9. [Gate é—´ä¾èµ–å…³ç³»](#9-gate-é—´ä¾èµ–å…³ç³»)
10. [éªŒæ”¶æ ‡å‡†](#10-éªŒæ”¶æ ‡å‡†)
11. [æŠ€æœ¯å†³ç­–è®°å½•](#11-æŠ€æœ¯å†³ç­–è®°å½•)

---

## 1. é˜¶æ®µç›®æ ‡

### 1.1 ç›®æ ‡å£°æ˜

**Phase 2 ç›®æ ‡**: åœ¨ Phase 1 åŸºç¡€ä¸Šï¼Œæ„å»º Validator Subagent åŒè½¨éªŒè¯ã€Revert Manager æœæ–­å›æ»šã€è¯šå®è¿½é—®å¼•æ“ã€project-why.md æ™ºèƒ½ç»´æŠ¤ã€PR è‡ªåŠ¨ç”Ÿæˆã€SKILL Marketplace å’Œç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶ï¼Œå®ç°æ™ºèƒ½åŒ–äººæœºåä½œé—­ç¯ã€‚

### 1.2 æˆåŠŸæ ‡å‡†

- [ ] Validator Subagent èƒ½ä»¥åªè¯»æ¨¡å¼å®¡æŸ¥ research.md / plan.md å¹¶è¾“å‡º Checklist æŠ¥å‘Š
- [ ] Revert Manager èƒ½åœ¨ CRITICAL è§¦å‘æ—¶è‡ªåŠ¨ git revert å¹¶åŒæ­¥æ•™è®­åˆ° project-why.md
- [ ] è¯šå®è¿½é—®å¼•æ“èƒ½æ£€æµ‹ Agent ç†è§£åå·®å¹¶ç”Ÿæˆæ¾„æ¸…é—®é¢˜
- [ ] project-why.md æ™ºèƒ½ç»´æŠ¤èƒ½æ£€æµ‹ç›¸ä¼¼çŸ¥è¯†å¹¶æ‰§è¡Œåˆå¹¶/å¢å¼º
- [ ] /nomos:pr èƒ½è‡ªåŠ¨ç”Ÿæˆ PR æè¿°
- [ ] SKILL Marketplace æ”¯æŒå­ SKILL è°ƒç”¨ (update-why / validate / archive)
- [ ] ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶æ”¯æŒ Command + Prompt + Agent æ··åˆ Handler

### 1.3 èŒƒå›´è¾¹ç•Œ

- **åŒ…å«**: Validator Subagentã€Revert Managerã€è¯šå®è¿½é—®å¼•æ“ã€project-why.md æ™ºèƒ½ç»´æŠ¤ã€PR è‡ªåŠ¨ç”Ÿæˆã€SKILL Marketplaceã€ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶
- **ä¸åŒ…å«**: Tree-sitter å¤šè¯­è¨€æ”¯æŒã€å¢é‡ Linter æ£€æŸ¥ã€YAML é…ç½®ç¬¬ä¸‰å±‚è§„åˆ™ã€æ€§èƒ½ä¼˜åŒ– (Phase 3)
- **å‰ç½®æ¡ä»¶**: Phase 1 çš„ Task Viewerã€æ ‡æ³¨ç³»ç»Ÿã€Why-First å¼•æ“ã€Git é›†æˆå‡å·²å®Œæˆ

### 1.4 é˜¶æ®µæ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 2: Advanced Features å¼€å‘è·¯çº¿å›¾                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Gate 2.1: Validator Subagent          Gate 2.3: è¯šå®è¿½é—®å¼•æ“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ åªè¯»å®¡æŸ¥ + Checklist ç®¡ç†    â”‚     â”‚ ç†è§£æ£€æµ‹ + è‡ªåŠ¨è¿½é—®ç”Ÿæˆ      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â”‚                                     â”‚                    â”‚
â”‚                 â–¼                                     â–¼                    â”‚
â”‚  Gate 2.2: Revert Manager              Gate 2.4: project-why.md æ™ºèƒ½ç»´æŠ¤  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ è§¦å‘æ£€æµ‹ + Git Revert + æ•™è®­ â”‚     â”‚ ç›¸ä¼¼æ£€æµ‹ + åˆå¹¶ + å¢å¼ºå»ºè®®   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â”‚                                     â”‚                    â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  Gate 2.5: PR è‡ªåŠ¨ç”Ÿæˆ                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PR æè¿°ç”Ÿæˆ + /nomos:pr + PR æ¨¡æ¿ç®¡ç†                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  Gate 2.6: SKILL Marketplace                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ update-why + validate + archive + å­ SKILL è°ƒç”¨æœºåˆ¶                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  Gate 2.7: ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è§„åˆ™ç¤ºä¾‹æ¨¡æ¿ + åŠ¨æ€è§„åˆ™è¯»å– + æ··åˆ Handler                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Gate 2.1: Validator Subagent

### 2.1 ç›®æ ‡

æ„å»º Builder + Validator åŒè½¨åˆ¶çš„ Validator ç«¯ï¼Œä»¥åªè¯»æ¨¡å¼ (ä»…ä½¿ç”¨ Read/Grep å·¥å…·) å®¡æŸ¥ research.md å’Œ plan.mdï¼Œæ£€æŸ¥ Protected Interfaces å®Œæ•´æ€§ï¼Œç®¡ç†å®¡æŸ¥ Checklistã€‚

### 2.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Validator Subagent æ¶æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è§¦å‘æ–¹å¼:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è‡ªåŠ¨è§¦å‘          â”‚     â”‚ æ‰‹åŠ¨è§¦å‘                                     â”‚ â”‚
â”‚  â”‚ (æ–‡æ¡£ç”Ÿæˆå spawn)â”‚     â”‚ /nomos:validate                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                     â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                          â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Validator Subagent (åªè¯»æ¨¡å¼)                      â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  å¯ç”¨å·¥å…·: Read, Grep (ç¦æ­¢ Write/Edit/Bash)                         â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ research.md    â”‚  â”‚ plan.md        â”‚  â”‚ Protected Interfaces   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ å®¡æŸ¥æ¨¡å—       â”‚  â”‚ å®¡æŸ¥æ¨¡å—       â”‚  â”‚ æ£€æŸ¥æ¨¡å— (AST æ¯”å¯¹)    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚           â”‚                   â”‚                        â”‚             â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚                               â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                    å®¡æŸ¥ Checklist å¼•æ“                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ å†…ç½®é»˜è®¤ Checklistâ”‚  â”‚ é¡¹ç›®è¦†ç›– Checklist               â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ (é€šç”¨å®¡æŸ¥é¡¹)      â”‚  â”‚ (.claude/validator-checklist.yml)â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                               â”‚                                      â”‚ â”‚
â”‚  â”‚                               â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                    å®¡æŸ¥æŠ¥å‘Š (Review Report)                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â†’ å†™å…¥ code_review.md çš„ Review Comments åŒº                  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/validator_subagent.py

import os
import re
import json
from dataclasses import dataclass, field
from typing import List, Optional, Dict
from enum import Enum

class ReviewSeverity(Enum):
    CRITICAL = "CRITICAL"
    MAJOR = "MAJOR"
    MINOR = "MINOR"
    SUGGEST = "SUGGEST"

@dataclass
class ChecklistItem:
    id: str                          # "CL-001"
    category: str                    # "completeness" / "consistency" / "interface"
    description: str                 # å®¡æŸ¥é¡¹æè¿°
    severity: ReviewSeverity         # æœªé€šè¿‡æ—¶çš„ä¸¥é‡ç¨‹åº¦
    check_fn: Optional[str] = None   # è‡ªå®šä¹‰æ£€æŸ¥å‡½æ•°å (å¯é€‰)

@dataclass
class ReviewFinding:
    checklist_id: str                # å…³è”çš„ Checklist é¡¹
    severity: ReviewSeverity
    location: str                    # "research.md:L42" / "plan.md:Section 3"
    message: str                     # å‘ç°æè¿°
    suggestion: str = ""             # ä¿®å¤å»ºè®®

@dataclass
class ValidationReport:
    target: str                      # "research.md" / "plan.md"
    passed: bool
    findings: List[ReviewFinding] = field(default_factory=list)
    checklist_results: Dict[str, bool] = field(default_factory=dict)

    def to_review_comments(self) -> str:
        """è½¬æ¢ä¸º Review Comments æ ¼å¼ï¼Œå†™å…¥ code_review.md"""
        pass

class ValidatorSubagent:
    """Validator Subagent - åªè¯»å®¡æŸ¥å­ Agent"""

    DEFAULT_CHECKLIST_PATH = ".claude/hooks/lib/default_checklist.yml"
    PROJECT_CHECKLIST_PATH = ".claude/validator-checklist.yml"

    def __init__(self, task_path: str):
        self.task_path = task_path
        self.checklist: List[ChecklistItem] = []

    def load_checklist(self) -> None:
        """åŠ è½½å®¡æŸ¥ Checklist (å†…ç½®é»˜è®¤ + é¡¹ç›®è¦†ç›–)"""
        pass

    def validate_research(self, research_path: str) -> ValidationReport:
        """
        å®¡æŸ¥ research.md

        æ£€æŸ¥é¡¹:
        - éœ€æ±‚ç†è§£å®Œæ•´æ€§ (æ˜¯å¦è¦†ç›–æ‰€æœ‰ç”¨æˆ·æ•…äº‹)
        - Protected Interfaces æ˜¯å¦å·²è¯†åˆ«
        - Why Questions æ˜¯å¦å·²å›ç­”
        - ä»£ç è°ƒç ”æ˜¯å¦å……åˆ†
        """
        pass

    def validate_plan(self, plan_path: str) -> ValidationReport:
        """
        å®¡æŸ¥ plan.md

        æ£€æŸ¥é¡¹:
        - Phase Gates å®šä¹‰å®Œæ•´æ€§
        - æ¶æ„è®¾è®¡ä¸ research.md ä¸€è‡´æ€§
        - Mermaid å›¾è¯­æ³•æ­£ç¡®æ€§
        - å®æ–½æ­¥éª¤å¯æ‰§è¡Œæ€§
        - Review Comments åŒºæ˜¯å¦å­˜åœ¨
        """
        pass

    def check_protected_interfaces(self, plan_path: str) -> List[ReviewFinding]:
        """
        Protected Interfaces AST æ¯”å¯¹

        æµç¨‹:
        1. ä» research.md æå– Protected Interfaces åˆ—è¡¨
        2. ä» plan.md æå–è®¡åˆ’ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨
        3. å¯¹æ¯”æ£€æŸ¥æ˜¯å¦æœ‰æœªå£°æ˜çš„æ¥å£ä¿®æ”¹
        4. ä½¿ç”¨ AST è§£ææ£€æµ‹æ¥å£ç­¾åå˜æ›´
        """
        pass

    def _read_file(self, path: str) -> str:
        """åªè¯»æ–¹å¼è¯»å–æ–‡ä»¶ (Validator å”¯ä¸€çš„æ–‡ä»¶æ“ä½œ)"""
        pass

    def _grep_pattern(self, path: str, pattern: str) -> List[str]:
        """åªè¯»æ–¹å¼æœç´¢æ–‡ä»¶å†…å®¹"""
        pass
```

### 2.4 å®¡æŸ¥ Checklist é»˜è®¤é…ç½®

```yaml
# .claude/hooks/lib/default_checklist.yml
# Validator Subagent å†…ç½®é»˜è®¤å®¡æŸ¥æ¸…å•

research_checklist:
  - id: CL-R001
    category: completeness
    description: "éœ€æ±‚ç†è§£éƒ¨åˆ†æ˜¯å¦åŒ…å«æ‰€æœ‰ç”¨æˆ·æ•…äº‹"
    severity: MAJOR
  - id: CL-R002
    category: completeness
    description: "Protected Interfaces æ˜¯å¦å·²è¯†åˆ«å¹¶åˆ—å‡º"
    severity: CRITICAL
  - id: CL-R003
    category: completeness
    description: "ä»£ç è°ƒç ”æ˜¯å¦è¦†ç›–ç›¸å…³æ¨¡å—"
    severity: MAJOR
  - id: CL-R004
    category: consistency
    description: "Why Questions æ˜¯å¦å·²å…¨éƒ¨å›ç­”"
    severity: MAJOR
  - id: CL-R005
    category: quality
    description: "YAML Frontmatter æ ¼å¼æ˜¯å¦æ­£ç¡®"
    severity: MINOR

plan_checklist:
  - id: CL-P001
    category: completeness
    description: "Phase Gates æ˜¯å¦å®šä¹‰å®Œæ•´ (è‡³å°‘ 3 ä¸ª)"
    severity: CRITICAL
  - id: CL-P002
    category: consistency
    description: "æ¶æ„è®¾è®¡æ˜¯å¦ä¸ research.md å‘ç°ä¸€è‡´"
    severity: MAJOR
  - id: CL-P003
    category: quality
    description: "Mermaid å›¾è¯­æ³•æ˜¯å¦æ­£ç¡®"
    severity: MINOR
  - id: CL-P004
    category: completeness
    description: "å®æ–½æ­¥éª¤æ˜¯å¦åŒ…å«éªŒæ”¶æ¡ä»¶"
    severity: MAJOR
  - id: CL-P005
    category: interface
    description: "Protected Interfaces ä¿®æ”¹æ˜¯å¦å·²å£°æ˜"
    severity: CRITICAL
```

### 2.5 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.1.1 | å®ç° `ValidatorSubagent` ç±»éª¨æ¶ | `validator_subagent.py` | ç±»å¯å®ä¾‹åŒ– |
| 2.1.2 | å®ç° `load_checklist()` (é»˜è®¤ + é¡¹ç›®è¦†ç›–) | `validator_subagent.py`, `default_checklist.yml` | æ­£ç¡®åŠ è½½åˆå¹¶ |
| 2.1.3 | å®ç° `validate_research()` | `validator_subagent.py` | æ£€æµ‹ research.md ç¼ºé™· |
| 2.1.4 | å®ç° `validate_plan()` | `validator_subagent.py` | æ£€æµ‹ plan.md ç¼ºé™· |
| 2.1.5 | å®ç° `check_protected_interfaces()` AST æ¯”å¯¹ | `validator_subagent.py` | æ£€æµ‹æœªå£°æ˜çš„æ¥å£ä¿®æ”¹ |
| 2.1.6 | å®ç° `to_review_comments()` æŠ¥å‘Šè¾“å‡º | `validator_subagent.py` | è¾“å‡ºæ ‡å‡† Review Comments |
| 2.1.7 | å®ç°è‡ªåŠ¨è§¦å‘ (PostToolUse Hook spawn) | `nomos-posttooluse.sh` | æ–‡æ¡£ç”Ÿæˆåè‡ªåŠ¨å®¡æŸ¥ |
| 2.1.8 | å®ç°æ‰‹åŠ¨è§¦å‘ `/nomos:validate` | `prompts/validate.md` | å‘½ä»¤å¯è°ƒç”¨ |
| 2.1.9 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_validator.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 2.6 Gate å®Œæˆæ¡ä»¶

- [ ] `ValidatorSubagent` èƒ½ä»¥åªè¯»æ¨¡å¼å®¡æŸ¥ research.md
- [ ] `ValidatorSubagent` èƒ½ä»¥åªè¯»æ¨¡å¼å®¡æŸ¥ plan.md
- [ ] Protected Interfaces AST æ¯”å¯¹èƒ½æ£€æµ‹æœªå£°æ˜çš„æ¥å£ä¿®æ”¹
- [ ] å®¡æŸ¥ Checklist æ”¯æŒå†…ç½®é»˜è®¤ + é¡¹ç›®è¦†ç›–
- [ ] å®¡æŸ¥æŠ¥å‘Šèƒ½æ­£ç¡®å†™å…¥ code_review.md çš„ Review Comments åŒº
- [ ] è‡ªåŠ¨è§¦å‘ (æ–‡æ¡£ç”Ÿæˆå spawn) æ­£å¸¸å·¥ä½œ
- [ ] æ‰‹åŠ¨è§¦å‘ `/nomos:validate` æ­£å¸¸å·¥ä½œ
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 3. Gate 2.2: Revert Manager

### 3.1 ç›®æ ‡

å®ç°æœæ–­ revert æœºåˆ¶ï¼Œå½“æ£€æµ‹åˆ° CRITICAL çº§åˆ«é—®é¢˜æˆ–æ–¹å‘é”™è¯¯æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ git revertï¼Œå¤‡ä»½åˆ° .old åˆ†æ”¯ï¼Œè®°å½• revert å†å²ï¼Œå¹¶å°†æ•™è®­åŒæ­¥åˆ° project-why.mdã€‚

### 3.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Revert Manager æ¶æ„                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è§¦å‘æº:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CRITICAL Review  â”‚  â”‚ æ–¹å‘é”™è¯¯æ£€æµ‹     â”‚  â”‚ äººç±»æ ‡æ³¨ [REVERT]        â”‚ â”‚
â”‚  â”‚ Comment          â”‚  â”‚ (Validator å‘ç°  â”‚  â”‚                          â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚  æ¶æ„å†²çª)       â”‚  â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                          â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                 â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Revert è§¦å‘æ£€æµ‹å™¨                                   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  æ¡ä»¶åˆ¤æ–­:                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Review Comment ä¸¥é‡ç¨‹åº¦ == CRITICAL?                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Review Comment åŒ…å« [REVERT] æ ‡è®°?                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Validator å‘ç°æ¶æ„å†²çª?                                         â”‚ â”‚
â”‚  â”‚  â””â”€â”€ æµ‹è¯•å¤±è´¥ç‡ > 30%?                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                           â”‚
â”‚                          è§¦å‘ Revert                                        â”‚
â”‚                                 â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Git Revert æ‰§è¡Œå™¨                                   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  Step 1: åˆ›å»ºå¤‡ä»½åˆ†æ”¯ (.old)                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ git branch {branch-name}.old                                 â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚         â”‚                                                             â”‚ â”‚
â”‚  â”‚         â–¼                                                             â”‚ â”‚
â”‚  â”‚  Step 2: æ‰§è¡Œ Revert                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ git revert --no-edit {commit-range}                          â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚         â”‚                                                             â”‚ â”‚
â”‚  â”‚         â–¼                                                             â”‚ â”‚
â”‚  â”‚  Step 3: æ›´æ–°çŠ¶æ€æ–‡ä»¶                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ plan.md: å›é€€åˆ° Plan é˜¶æ®µ                                    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ code_review.md: è®°å½• Revert ä¿¡æ¯                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ project-why.md: åŒæ­¥æ•™è®­                                     â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/revert_manager.py

import os
import subprocess
import json
from dataclasses import dataclass
from typing import List, Optional
from datetime import datetime

@dataclass
class RevertRecord:
    revert_id: str                   # "REV-001"
    timestamp: str                   # ISO 8601
    trigger: str                     # "critical_review" / "revert_tag" / "arch_conflict" / "test_failure"
    reason: str                      # è¯¦ç»†åŸå› 
    reverted_commits: List[str]      # è¢«å›æ»šçš„ commit hash åˆ—è¡¨
    backup_branch: str               # .old å¤‡ä»½åˆ†æ”¯å
    lesson: str                      # æ•™è®­æ€»ç»“
    task_id: str                     # å…³è”ä»»åŠ¡ ID

class RevertManager:
    """Revert Manager - æœæ–­å›æ»šç®¡ç†å™¨"""

    def __init__(self, task_path: str):
        self.task_path = task_path

    def detect_revert_trigger(self, code_review_path: str) -> Optional[str]:
        """
        æ£€æµ‹æ˜¯å¦éœ€è¦è§¦å‘ Revert

        æ£€æµ‹æ¡ä»¶:
        1. code_review.md ä¸­å­˜åœ¨ [CRITICAL] + pending çš„ Review Comment
        2. Review Comment åŒ…å« [REVERT] æ ‡è®°
        3. Validator æŠ¥å‘Šä¸­å­˜åœ¨æ¶æ„å†²çª
        4. æµ‹è¯•å¤±è´¥ç‡è¶…è¿‡ 30%

        Returns:
            è§¦å‘åŸå› å­—ç¬¦ä¸²ï¼ŒNone è¡¨ç¤ºä¸éœ€è¦ Revert
        """
        pass

    def execute_revert(self, commit_range: str, reason: str) -> RevertRecord:
        """
        æ‰§è¡Œ Git Revert

        æµç¨‹:
        1. åˆ›å»º .old å¤‡ä»½åˆ†æ”¯
        2. git revert --no-edit {commit_range}
        3. ç”Ÿæˆ RevertRecord
        """
        pass

    def update_plan_status(self, plan_path: str) -> None:
        """å›é€€ plan.md çŠ¶æ€åˆ° Plan é˜¶æ®µ (ä¿ç•™ research.md)"""
        pass

    def record_revert(self, record: RevertRecord, code_review_path: str) -> None:
        """
        è®°å½• Revert åˆ° code_review.md ç¬¬ 6 èŠ‚

        æ ¼å¼:
        ### REV-001: {reason}
        - **æ—¶é—´**: {timestamp}
        - **è§¦å‘**: {trigger}
        - **å›æ»šèŒƒå›´**: {commit_range}
        - **å¤‡ä»½åˆ†æ”¯**: {backup_branch}
        - **æ•™è®­**: {lesson}
        """
        pass

    def sync_lesson_to_why(self, record: RevertRecord, why_path: str) -> None:
        """
        å°† Revert æ•™è®­åŒæ­¥åˆ° project-why.md

        åœ¨ project-why.md çš„ "å¤±è´¥æ•™è®­" åŒºè¿½åŠ :
        - å¤±è´¥åŸå› 
        - æ•™è®­æ€»ç»“
        - é¿å…æªæ–½
        """
        pass

    def _create_backup_branch(self) -> str:
        """åˆ›å»º .old å¤‡ä»½åˆ†æ”¯"""
        pass

    def _get_gate_commits(self, gate_id: str) -> List[str]:
        """è·å–æŒ‡å®š Gate çš„æ‰€æœ‰ commit hash"""
        pass
```

### 3.4 Revert è§¦å‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Revert è§¦å‘å†³ç­–æµç¨‹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è¾“å…¥: code_review.md / Validator æŠ¥å‘Š / æµ‹è¯•ç»“æœ                           â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     æ˜¯      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å­˜åœ¨ [REVERT]    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ ç«‹å³è§¦å‘ Revert (æœ€é«˜ä¼˜å…ˆçº§)         â”‚ â”‚
â”‚  â”‚ æ ‡è®°?            â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚           â”‚ å¦                                                              â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     æ˜¯      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CRITICAL Review  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ è¯„ä¼°å½±å“èŒƒå›´ â†’ è§¦å‘ Revert           â”‚ â”‚
â”‚  â”‚ Comment pending? â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚           â”‚ å¦                                                              â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     æ˜¯      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Validator å‘ç°   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ è¯„ä¼°æ¶æ„å½±å“ â†’ è§¦å‘ Revert           â”‚ â”‚
â”‚  â”‚ æ¶æ„å†²çª?        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚           â”‚ å¦                                                              â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     æ˜¯      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æµ‹è¯•å¤±è´¥ç‡ > 30% â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ è¯„ä¼°å¤±è´¥èŒƒå›´ â†’ è§¦å‘ Revert           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚ å¦                                                              â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚  â”‚ ä¸è§¦å‘ Revert    â”‚                                                      â”‚
â”‚  â”‚ (æ­£å¸¸ç»§ç»­)       â”‚                                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.2.1 | å®ç° `RevertManager` ç±»éª¨æ¶ | `revert_manager.py` | ç±»å¯å®ä¾‹åŒ– |
| 2.2.2 | å®ç° `detect_revert_trigger()` | `revert_manager.py` | æ­£ç¡®æ£€æµ‹å››ç§è§¦å‘æ¡ä»¶ |
| 2.2.3 | å®ç° `_create_backup_branch()` | `revert_manager.py` | åˆ›å»º .old åˆ†æ”¯ |
| 2.2.4 | å®ç° `execute_revert()` | `revert_manager.py` | git revert æ­£ç¡®æ‰§è¡Œ |
| 2.2.5 | å®ç° `update_plan_status()` | `revert_manager.py` | plan.md å›é€€åˆ° Plan é˜¶æ®µ |
| 2.2.6 | å®ç° `record_revert()` | `revert_manager.py` | è®°å½•å†™å…¥ code_review.md |
| 2.2.7 | å®ç° `sync_lesson_to_why()` | `revert_manager.py` | æ•™è®­åŒæ­¥åˆ° project-why.md |
| 2.2.8 | é›†æˆåˆ° Stop Hook (Revert æ£€æµ‹) | `nomos-stop.sh` | Stop æ—¶è‡ªåŠ¨æ£€æµ‹ |
| 2.2.9 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_revert_manager.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 3.6 Gate å®Œæˆæ¡ä»¶

- [ ] `detect_revert_trigger()` èƒ½æ­£ç¡®æ£€æµ‹å››ç§è§¦å‘æ¡ä»¶
- [ ] `execute_revert()` èƒ½æ­£ç¡®æ‰§è¡Œ git revert å¹¶åˆ›å»ºå¤‡ä»½åˆ†æ”¯
- [ ] `update_plan_status()` èƒ½å°† plan.md å›é€€åˆ° Plan é˜¶æ®µ
- [ ] `record_revert()` èƒ½å°† Revert è®°å½•å†™å…¥ code_review.md ç¬¬ 6 èŠ‚
- [ ] `sync_lesson_to_why()` èƒ½å°†æ•™è®­åŒæ­¥åˆ° project-why.md
- [ ] Revert å research.md ä¿ç•™ä¸å˜
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 4. Gate 2.3: è¯šå®è¿½é—®å¼•æ“ (Honest Questioning Engine)

### 4.1 ç›®æ ‡

æ„å»ºè¯šå®è¿½é—®å¼•æ“ï¼Œå½“ Agent åœ¨æ ‡æ³¨å¾ªç¯ä¸­é‡åˆ°ä¸ç†è§£çš„äººç±»æ‰¹æ³¨æ—¶ï¼Œèƒ½è¯šå®åœ°ç”Ÿæˆæ¾„æ¸…é—®é¢˜è€ŒéçŒœæµ‹è¿åˆï¼Œç®¡ç† `pending_ai_question` çŠ¶æ€ï¼Œç¡®ä¿äººæœºç†è§£çœŸæ­£å¯¹é½ã€‚

### 4.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¯šå®è¿½é—®å¼•æ“ (Honest Questioning Engine)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è¾“å…¥: äººç±»æ ‡æ³¨ (Review Comment)                                            â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Agent ç†è§£æ£€æµ‹å™¨                                    â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  æ£€æµ‹ç»´åº¦:                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ è¯­ä¹‰æ¨¡ç³Šåº¦: æ ‡æ³¨æ˜¯å¦åŒ…å«æ¨¡ç³Šè¯æ±‡ (å¦‚ "å¤§æ¦‚"/"å¯èƒ½"/"ç±»ä¼¼")     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ä¸Šä¸‹æ–‡ç¼ºå¤±: æ ‡æ³¨å¼•ç”¨çš„ä¸Šä¸‹æ–‡æ˜¯å¦åœ¨å½“å‰æ–‡æ¡£ä¸­å¯æ‰¾åˆ°              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ çŸ›ç›¾æ£€æµ‹: æ ‡æ³¨æ˜¯å¦ä¸å·²æœ‰ project-why.md çŸ¥è¯†çŸ›ç›¾               â”‚ â”‚
â”‚  â”‚  â””â”€â”€ éšå«å‡è®¾: æ ‡æ³¨æ˜¯å¦åŒ…å«æœªæ˜ç¡®è¯´æ˜çš„å‰æå‡è®¾                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”œâ”€â”€ ç†è§£åº¦ >= é˜ˆå€¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â”‚                                                        â”‚          â”‚
â”‚         â”‚                                                        â–¼          â”‚
â”‚         â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚         â”‚                                              â”‚ æ­£å¸¸å¤„ç†æ ‡æ³¨ â”‚    â”‚
â”‚         â”‚                                              â”‚ (addressed)  â”‚    â”‚
â”‚         â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â””â”€â”€ ç†è§£åº¦ < é˜ˆå€¼                                                   â”‚
â”‚                   â”‚                                                          â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    è‡ªåŠ¨è¿½é—®ç”Ÿæˆå™¨                                      â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  ç”Ÿæˆç­–ç•¥:                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ è‹æ ¼æ‹‰åº•å¼æé—® (å¼•å¯¼ç”¨æˆ·æ¾„æ¸…æ„å›¾)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ é€‰é¡¹å¼æé—® (æä¾› 2-3 ä¸ªå¯èƒ½çš„ç†è§£ä¾›ç”¨æˆ·é€‰æ‹©)                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€ ç¡®è®¤å¼æé—® (å¤è¿°ç†è§£å¹¶è¯·æ±‚ç¡®è®¤)                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                   â”‚                                                          â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    pending_ai_question çŠ¶æ€ç®¡ç†                        â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ æ ‡æ³¨çŠ¶æ€: pending â†’ pending_ai_question                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Task Viewer: ğŸŸ£ ç´«è‰²é—ªçƒå›¾æ ‡æç¤º                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ CLI æç¤º: "â“ Agent æœ‰ N ä¸ªé—®é¢˜ç­‰å¾…æ‚¨å›ç­”"                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ ç”¨æˆ·å›ç­”å: pending_ai_question â†’ pending â†’ addressed           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/honest_questioning.py

import re
import json
from dataclasses import dataclass, field
from typing import List, Optional, Tuple
from enum import Enum

class QuestionType(Enum):
    SOCRATIC = "socratic"          # è‹æ ¼æ‹‰åº•å¼å¼•å¯¼
    OPTION = "option"              # é€‰é¡¹å¼æé—®
    CONFIRMATION = "confirmation"  # ç¡®è®¤å¼æé—®

@dataclass
class UnderstandingScore:
    overall: float                   # 0.0 ~ 1.0 ç»¼åˆç†è§£åº¦
    semantic_clarity: float          # è¯­ä¹‰æ¸…æ™°åº¦
    context_availability: float      # ä¸Šä¸‹æ–‡å¯ç”¨æ€§
    consistency: float               # ä¸å·²æœ‰çŸ¥è¯†ä¸€è‡´æ€§
    assumption_explicitness: float   # å‡è®¾æ˜ç¡®æ€§
    details: List[str] = field(default_factory=list)  # å…·ä½“é—®é¢˜ç‚¹

@dataclass
class ClarificationQuestion:
    question_type: QuestionType
    question_text: str               # é—®é¢˜æ–‡æœ¬
    context: str                     # é—®é¢˜ä¸Šä¸‹æ–‡ (å¼•ç”¨åŸæ ‡æ³¨)
    options: List[str] = field(default_factory=list)  # é€‰é¡¹ (option ç±»å‹)
    related_why: Optional[str] = None  # å…³è”çš„ project-why.md æ¡ç›®

class HonestQuestioningEngine:
    """è¯šå®è¿½é—®å¼•æ“ - ç¡®ä¿ Agent çœŸæ­£ç†è§£äººç±»æ„å›¾"""

    UNDERSTANDING_THRESHOLD = 0.7    # ç†è§£åº¦é˜ˆå€¼

    def __init__(self, task_path: str, why_path: str = "project-why.md"):
        self.task_path = task_path
        self.why_path = why_path

    def assess_understanding(self, annotation_text: str,
                              document_context: str) -> UnderstandingScore:
        """
        è¯„ä¼° Agent å¯¹æ ‡æ³¨çš„ç†è§£ç¨‹åº¦

        Args:
            annotation_text: äººç±»æ ‡æ³¨æ–‡æœ¬
            document_context: æ ‡æ³¨æ‰€åœ¨æ–‡æ¡£çš„ä¸Šä¸‹æ–‡

        Returns:
            UnderstandingScore è¯„ä¼°ç»“æœ
        """
        pass

    def generate_questions(self, annotation_text: str,
                           score: UnderstandingScore) -> List[ClarificationQuestion]:
        """
        ç”Ÿæˆæ¾„æ¸…é—®é¢˜

        ç­–ç•¥:
        - è¯­ä¹‰æ¨¡ç³Š â†’ è‹æ ¼æ‹‰åº•å¼æé—®
        - å¤šç§å¯èƒ½ç†è§£ â†’ é€‰é¡¹å¼æé—®
        - åŸºæœ¬ç†è§£ä½†ä¸ç¡®å®š â†’ ç¡®è®¤å¼æé—®
        """
        pass

    def update_annotation_status(self, annotation_id: str,
                                  questions: List[ClarificationQuestion],
                                  doc_path: str) -> None:
        """
        æ›´æ–°æ ‡æ³¨çŠ¶æ€ä¸º pending_ai_question

        åœ¨æ ‡æ³¨å†å²ä¸­è¿½åŠ :
        â“ **Agent è¿½é—®** ({timestamp}):
        {question_text}
        """
        pass

    def process_user_answer(self, annotation_id: str,
                            answer_text: str,
                            doc_path: str) -> None:
        """
        å¤„ç†ç”¨æˆ·å¯¹è¿½é—®çš„å›ç­”

        æµç¨‹:
        1. è§£æç”¨æˆ·å›ç­”
        2. æ›´æ–°æ ‡æ³¨çŠ¶æ€: pending_ai_question â†’ pending
        3. é‡æ–°è¯„ä¼°ç†è§£åº¦
        4. å¦‚æœç†è§£åº¦è¾¾æ ‡ â†’ å¤„ç†æ ‡æ³¨ â†’ addressed
        5. å¦‚æœä»ä¸è¾¾æ ‡ â†’ å†æ¬¡è¿½é—® (æœ€å¤š 3 è½®)
        """
        pass

    def _detect_ambiguity(self, text: str) -> List[str]:
        """æ£€æµ‹æ–‡æœ¬ä¸­çš„æ¨¡ç³Šè¡¨è¾¾"""
        pass

    def _check_context_availability(self, annotation: str,
                                     document: str) -> float:
        """æ£€æŸ¥æ ‡æ³¨å¼•ç”¨çš„ä¸Šä¸‹æ–‡æ˜¯å¦å¯ç”¨"""
        pass

    def _check_knowledge_consistency(self, annotation: str) -> Tuple[float, List[str]]:
        """æ£€æŸ¥æ ‡æ³¨ä¸ project-why.md å·²æœ‰çŸ¥è¯†çš„ä¸€è‡´æ€§"""
        pass
```

### 4.4 è¿½é—®çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ‡æ³¨çŠ¶æ€æµè½¬ (å«è¿½é—®)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚  â”‚ pending  â”‚ â—„â”€â”€â”€â”€ äººç±»åˆ›å»ºæ ‡æ³¨                                            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                               â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚ Agent å¤„ç†æ ‡æ³¨                                                       â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€ ç†è§£åº¦ >= 0.7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚       â”‚                                                        â–¼             â”‚
â”‚       â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚       â”‚                                              â”‚  addressed   â”‚       â”‚
â”‚       â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â””â”€â”€ ç†è§£åº¦ < 0.7                                                      â”‚
â”‚                â”‚                                                             â”‚
â”‚                â–¼                                                             â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚       â”‚ pending_ai_question    â”‚ â—„â”€â”€â”€â”€ ğŸŸ£ ç´«è‰²é—ªçƒ                          â”‚
â”‚       â”‚ (Agent è¿½é—®ä¸­)         â”‚                                            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                â”‚                                                             â”‚
â”‚                â”‚ ç”¨æˆ·å›ç­”                                                    â”‚
â”‚                â–¼                                                             â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚       â”‚ pending_user_clarify â”‚                                              â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                â”‚                                                             â”‚
â”‚                â”‚ Agent é‡æ–°è¯„ä¼°                                              â”‚
â”‚                â”‚                                                             â”‚
â”‚                â”œâ”€â”€ ç†è§£åº¦ >= 0.7 â”€â”€â–º addressed                              â”‚
â”‚                â”‚                                                             â”‚
â”‚                â””â”€â”€ ç†è§£åº¦ < 0.7 ä¸” è½®æ¬¡ < 3 â”€â”€â–º pending_ai_question (å†è¿½é—®)â”‚
â”‚                â”‚                                                             â”‚
â”‚                â””â”€â”€ è½®æ¬¡ >= 3 â”€â”€â–º pending (å‡çº§ä¸ºäººå·¥å¤„ç†)                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.3.1 | å®ç° `HonestQuestioningEngine` ç±»éª¨æ¶ | `honest_questioning.py` | ç±»å¯å®ä¾‹åŒ– |
| 2.3.2 | å®ç° `assess_understanding()` ç†è§£åº¦è¯„ä¼° | `honest_questioning.py` | è¿”å› 0.0~1.0 åˆ†æ•° |
| 2.3.3 | å®ç° `_detect_ambiguity()` æ¨¡ç³Šæ£€æµ‹ | `honest_questioning.py` | æ£€æµ‹æ¨¡ç³Šè¯æ±‡ |
| 2.3.4 | å®ç° `_check_context_availability()` | `honest_questioning.py` | æ£€æµ‹ä¸Šä¸‹æ–‡ç¼ºå¤± |
| 2.3.5 | å®ç° `_check_knowledge_consistency()` | `honest_questioning.py` | æ£€æµ‹çŸ¥è¯†çŸ›ç›¾ |
| 2.3.6 | å®ç° `generate_questions()` è¿½é—®ç”Ÿæˆ | `honest_questioning.py` | ç”Ÿæˆä¸‰ç§ç±»å‹é—®é¢˜ |
| 2.3.7 | å®ç° `update_annotation_status()` | `honest_questioning.py` | çŠ¶æ€æ­£ç¡®æµè½¬ |
| 2.3.8 | å®ç° `process_user_answer()` | `honest_questioning.py` | å¤„ç†å›ç­”å¹¶é‡æ–°è¯„ä¼° |
| 2.3.9 | é›†æˆåˆ°æ ‡æ³¨å¤„ç†æµç¨‹ | æ ‡æ³¨ç³»ç»Ÿ | è‡ªåŠ¨è§¦å‘è¿½é—® |
| 2.3.10 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_honest_questioning.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 4.6 Gate å®Œæˆæ¡ä»¶

- [ ] `assess_understanding()` èƒ½æ­£ç¡®è¯„ä¼° Agent å¯¹æ ‡æ³¨çš„ç†è§£åº¦
- [ ] `generate_questions()` èƒ½ç”Ÿæˆè‹æ ¼æ‹‰åº•å¼/é€‰é¡¹å¼/ç¡®è®¤å¼ä¸‰ç§è¿½é—®
- [ ] `update_annotation_status()` èƒ½æ­£ç¡®å°†çŠ¶æ€æ”¹ä¸º `pending_ai_question`
- [ ] `process_user_answer()` èƒ½å¤„ç†ç”¨æˆ·å›ç­”å¹¶é‡æ–°è¯„ä¼°
- [ ] è¿½é—®è½®æ¬¡é™åˆ¶ (æœ€å¤š 3 è½®) æ­£å¸¸å·¥ä½œ
- [ ] Task Viewer ä¸­ `pending_ai_question` æ˜¾ç¤ºç´«è‰²é—ªçƒå›¾æ ‡
- [ ] CLI ä¸­æ˜¾ç¤º "Agent æœ‰ N ä¸ªé—®é¢˜ç­‰å¾…å›ç­”" æç¤º
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 5. Gate 2.4: project-why.md æ™ºèƒ½ç»´æŠ¤

### 5.1 ç›®æ ‡

å®ç° project-why.md çš„æ™ºèƒ½ç»´æŠ¤æœºåˆ¶ï¼ŒåŒ…æ‹¬çŸ¥è¯†ç›¸ä¼¼åº¦æ£€æµ‹ã€é‡å¤å†…å®¹åˆå¹¶ã€çŸ¥è¯†å¢å¼ºå»ºè®®ï¼Œä½¿ project-why.md ä»ç®€å•è¿½åŠ æ¼”è¿›ä¸ºæ™ºèƒ½çŸ¥è¯†åº“ã€‚

### 5.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    project-why.md æ™ºèƒ½ç»´æŠ¤æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è¾“å…¥: æ–°çŸ¥è¯†æ¡ç›® (æ¥è‡ª Why-First / Revert æ•™è®­ / æ ‡æ³¨å¾ªç¯)                 â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Knowledge Similarity Detector                      â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ 1. åŠ è½½ project-why.md å·²æœ‰æ¡ç›®                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ 2. å¯¹æ–°æ¡ç›®è¿›è¡Œå…³é”®è¯æå–                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ 3. ä¸å·²æœ‰æ¡ç›®é€ä¸€æ¯”è¾ƒç›¸ä¼¼åº¦                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ 4. è¾“å‡º: ç›¸ä¼¼æ¡ç›®åˆ—è¡¨ + ç›¸ä¼¼åº¦åˆ†æ•°                             â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”œâ”€â”€ æ— ç›¸ä¼¼æ¡ç›® (ç›¸ä¼¼åº¦ < 0.3)                                       â”‚
â”‚         â”‚         â”‚                                                          â”‚
â”‚         â”‚         â–¼                                                          â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚         â”‚  â”‚ ç›´æ¥è¿½åŠ æ–°æ¡ç›®   â”‚                                             â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”œâ”€â”€ ä¸­ç­‰ç›¸ä¼¼ (0.3 ~ 0.7)                                            â”‚
â”‚         â”‚         â”‚                                                          â”‚
â”‚         â”‚         â–¼                                                          â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚         â”‚  â”‚                    çŸ¥è¯†å¢å¼ºå»ºè®®å™¨                              â”‚ â”‚
â”‚         â”‚  â”‚  â†’ å»ºè®®åœ¨å·²æœ‰æ¡ç›®åŸºç¡€ä¸Šè¡¥å……æ–°ä¿¡æ¯                             â”‚ â”‚
â”‚         â”‚  â”‚  â†’ ç”Ÿæˆå¢å¼ºåçš„æ¡ç›®ä¾›ç”¨æˆ·ç¡®è®¤                                 â”‚ â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â””â”€â”€ é«˜åº¦ç›¸ä¼¼ (>= 0.7)                                               â”‚
â”‚                   â”‚                                                          â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    çŸ¥è¯†åˆå¹¶æ“ä½œå™¨                                      â”‚ â”‚
â”‚  â”‚  â†’ åˆå¹¶é‡å¤å†…å®¹ï¼Œä¿ç•™æ›´å®Œæ•´çš„æè¿°                                     â”‚ â”‚
â”‚  â”‚  â†’ æ ‡è®°åˆå¹¶æ¥æº (å“ªäº›ä»»åŠ¡è´¡çŒ®äº†æ­¤çŸ¥è¯†)                                â”‚ â”‚
â”‚  â”‚  â†’ å†²çªæ—¶æç¤ºç”¨æˆ·é€‰æ‹©                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                   â”‚                                                          â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    project-why.md æ›´æ–°                                 â”‚ â”‚
â”‚  â”‚  â†’ å†™å…¥åˆå¹¶/å¢å¼ºåçš„å†…å®¹                                              â”‚ â”‚
â”‚  â”‚  â†’ æ›´æ–° YAML Frontmatter (last_updated, entry_count)                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/why_maintainer.py

import os
import re
import json
from dataclasses import dataclass, field
from typing import List, Optional, Tuple, Dict
from enum import Enum

class SimilarityLevel(Enum):
    NONE = "none"           # < 0.3
    MODERATE = "moderate"   # 0.3 ~ 0.7
    HIGH = "high"           # >= 0.7

@dataclass
class WhyEntry:
    entry_id: str                    # "WHY-001"
    category: str                    # "architecture" / "business" / "failure" / "decision"
    question: str                    # åŸå§‹é—®é¢˜
    answer: str                      # å›ç­”
    source_tasks: List[str] = field(default_factory=list)  # è´¡çŒ®ä»»åŠ¡ ID åˆ—è¡¨
    created: str = ""                # åˆ›å»ºæ—¶é—´
    updated: str = ""                # æœ€åæ›´æ–°æ—¶é—´
    tags: List[str] = field(default_factory=list)  # æ ‡ç­¾

@dataclass
class SimilarityResult:
    existing_entry: WhyEntry
    new_entry: WhyEntry
    score: float                     # 0.0 ~ 1.0
    level: SimilarityLevel
    matching_keywords: List[str]     # åŒ¹é…çš„å…³é”®è¯

@dataclass
class MergeProposal:
    merged_entry: WhyEntry           # åˆå¹¶åçš„æ¡ç›®
    sources: List[WhyEntry]          # åˆå¹¶æ¥æº
    conflict_fields: List[str]       # å­˜åœ¨å†²çªçš„å­—æ®µ
    needs_user_confirmation: bool    # æ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤

class WhyMaintainer:
    """project-why.md æ™ºèƒ½ç»´æŠ¤å™¨"""

    SIMILARITY_THRESHOLD_LOW = 0.3
    SIMILARITY_THRESHOLD_HIGH = 0.7

    def __init__(self, why_path: str = "project-why.md"):
        self.why_path = why_path
        self.entries: List[WhyEntry] = []

    def load_entries(self) -> List[WhyEntry]:
        """ä» project-why.md åŠ è½½æ‰€æœ‰æ¡ç›®"""
        pass

    def detect_similarity(self, new_entry: WhyEntry) -> List[SimilarityResult]:
        """
        æ£€æµ‹æ–°æ¡ç›®ä¸å·²æœ‰æ¡ç›®çš„ç›¸ä¼¼åº¦

        ç®—æ³•:
        1. å…³é”®è¯æå– (TF-IDF ç®€åŒ–ç‰ˆ)
        2. Jaccard ç›¸ä¼¼åº¦è®¡ç®—
        3. è¯­ä¹‰å…³é”®è¯åŒ¹é… (åŒä¹‰è¯è¡¨)
        """
        pass

    def merge_entries(self, entries: List[WhyEntry]) -> MergeProposal:
        """
        åˆå¹¶é‡å¤æ¡ç›®

        ç­–ç•¥:
        - ä¿ç•™æœ€å®Œæ•´çš„æè¿°
        - åˆå¹¶ source_tasks åˆ—è¡¨
        - åˆå¹¶ tags
        - å†²çªå­—æ®µæ ‡è®°ä¾›ç”¨æˆ·é€‰æ‹©
        """
        pass

    def enhance_entry(self, existing: WhyEntry, new_info: str) -> WhyEntry:
        """
        å¢å¼ºå·²æœ‰æ¡ç›®

        åœ¨å·²æœ‰å›ç­”åŸºç¡€ä¸Šè¡¥å……æ–°ä¿¡æ¯ï¼Œä¸è¦†ç›–åŸæœ‰å†…å®¹
        """
        pass

    def add_or_update(self, new_entry: WhyEntry) -> str:
        """
        æ™ºèƒ½æ·»åŠ æˆ–æ›´æ–°æ¡ç›® (ä¸»å…¥å£)

        æµç¨‹:
        1. æ£€æµ‹ç›¸ä¼¼åº¦
        2. æ— ç›¸ä¼¼ â†’ ç›´æ¥è¿½åŠ 
        3. ä¸­ç­‰ç›¸ä¼¼ â†’ å¢å¼ºå»ºè®®
        4. é«˜åº¦ç›¸ä¼¼ â†’ åˆå¹¶æ“ä½œ
        """
        pass

    def _extract_keywords(self, text: str) -> List[str]:
        """æå–æ–‡æœ¬å…³é”®è¯"""
        pass

    def _calculate_similarity(self, keywords_a: List[str],
                               keywords_b: List[str]) -> float:
        """è®¡ç®—å…³é”®è¯é›†åˆçš„ Jaccard ç›¸ä¼¼åº¦"""
        pass

    def _save_entries(self) -> None:
        """ä¿å­˜æ¡ç›®åˆ° project-why.md"""
        pass
```

### 5.4 project-why.md ç»“æ„åŒ–æ ¼å¼

```markdown
---
last_updated: 2026-02-25
entry_count: 15
categories:
  - architecture
  - business
  - failure
  - decision
---

# Project Why - é¡¹ç›®çŸ¥è¯†åº“

## Architecture (æ¶æ„å†³ç­–)

### WHY-001: ä¸ºä»€ä¹ˆé€‰æ‹©åˆ†å±‚æ¶æ„?
- **å›ç­”**: åˆ†å±‚æ¶æ„ä¾¿äºæ¨¡å—æ›¿æ¢å’Œæµ‹è¯•éš”ç¦»...
- **æ¥æºä»»åŠ¡**: t1, t3
- **æ ‡ç­¾**: #architecture #layering
- **æ›´æ–°æ—¶é—´**: 2026-02-25

## Business (ä¸šåŠ¡è§„åˆ™)

### WHY-005: ä¸ºä»€ä¹ˆé‡‘é¢å¿…é¡»ç”¨ Decimal?
- **å›ç­”**: æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ä¼šå¯¼è‡´é‡‘èè®¡ç®—é”™è¯¯...
- **æ¥æºä»»åŠ¡**: t2
- **æ ‡ç­¾**: #business #finance
- **æ›´æ–°æ—¶é—´**: 2026-02-25

## Failure (å¤±è´¥æ•™è®­)

### WHY-010: REV-001 æ•™è®­ - ç›´æ¥ä¿®æ”¹ Protected Interface
- **å›ç­”**: æœªå£°æ˜å°±ä¿®æ”¹ UserService.authenticate() å¯¼è‡´ä¸‹æ¸¸ 5 ä¸ªæ¨¡å—ç¼–è¯‘å¤±è´¥...
- **æ¥æºä»»åŠ¡**: t4
- **æ ‡ç­¾**: #failure #interface #revert
- **æ›´æ–°æ—¶é—´**: 2026-02-25

## Decision (æŠ€æœ¯å†³ç­–)

### WHY-012: ä¸ºä»€ä¹ˆé€‰æ‹© Ruff è€Œé Flake8?
- **å›ç­”**: Ruff é€Ÿåº¦å¿« 10-100 å€ï¼Œä¸”å…¼å®¹ Flake8 è§„åˆ™é›†...
- **æ¥æºä»»åŠ¡**: t1
- **æ ‡ç­¾**: #decision #tooling
- **æ›´æ–°æ—¶é—´**: 2026-02-25
```

### 5.5 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.4.1 | å®ç° `WhyMaintainer` ç±»éª¨æ¶ | `why_maintainer.py` | ç±»å¯å®ä¾‹åŒ– |
| 2.4.2 | å®ç° `load_entries()` è§£æ project-why.md | `why_maintainer.py` | æ­£ç¡®è§£ææ‰€æœ‰æ¡ç›® |
| 2.4.3 | å®ç° `_extract_keywords()` å…³é”®è¯æå– | `why_maintainer.py` | æå–æœ‰æ„ä¹‰çš„å…³é”®è¯ |
| 2.4.4 | å®ç° `_calculate_similarity()` Jaccard ç›¸ä¼¼åº¦ | `why_maintainer.py` | è¿”å› 0.0~1.0 åˆ†æ•° |
| 2.4.5 | å®ç° `detect_similarity()` | `why_maintainer.py` | æ­£ç¡®åˆ†ç±»ä¸‰ä¸ªç›¸ä¼¼åº¦çº§åˆ« |
| 2.4.6 | å®ç° `merge_entries()` åˆå¹¶æ“ä½œ | `why_maintainer.py` | åˆå¹¶é‡å¤æ¡ç›® |
| 2.4.7 | å®ç° `enhance_entry()` å¢å¼ºæ“ä½œ | `why_maintainer.py` | è¡¥å……æ–°ä¿¡æ¯ä¸è¦†ç›–æ—§å†…å®¹ |
| 2.4.8 | å®ç° `add_or_update()` ä¸»å…¥å£ | `why_maintainer.py` | æ™ºèƒ½è·¯ç”±ä¸‰ç§æ“ä½œ |
| 2.4.9 | å®ç° `_save_entries()` å†™å›æ–‡ä»¶ | `why_maintainer.py` | ä¿æŒæ ¼å¼ä¸€è‡´ |
| 2.4.10 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_why_maintainer.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 5.6 Gate å®Œæˆæ¡ä»¶

- [ ] `load_entries()` èƒ½æ­£ç¡®è§£æ project-why.md çš„ç»“æ„åŒ–æ ¼å¼
- [ ] `detect_similarity()` èƒ½æ­£ç¡®æ£€æµ‹ä¸‰ä¸ªç›¸ä¼¼åº¦çº§åˆ«
- [ ] `merge_entries()` èƒ½åˆå¹¶é«˜åº¦ç›¸ä¼¼çš„æ¡ç›®
- [ ] `enhance_entry()` èƒ½åœ¨å·²æœ‰æ¡ç›®åŸºç¡€ä¸Šè¡¥å……æ–°ä¿¡æ¯
- [ ] `add_or_update()` èƒ½æ™ºèƒ½è·¯ç”±åˆ°è¿½åŠ /å¢å¼º/åˆå¹¶æ“ä½œ
- [ ] åˆå¹¶å†²çªæ—¶èƒ½æ­£ç¡®æ ‡è®°éœ€è¦ç”¨æˆ·ç¡®è®¤çš„å­—æ®µ
- [ ] project-why.md çš„ YAML Frontmatter æ­£ç¡®æ›´æ–°
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ (Gate 2.4)

---

## 6. Gate 2.5: PR è‡ªåŠ¨ç”Ÿæˆ

### 6.1 ç›®æ ‡

å®ç° PR æè¿°è‡ªåŠ¨ç”Ÿæˆï¼Œä» plan.md æå– Summary/Changesï¼Œä» code_review.md æå– Test Plan/Checklistï¼Œæ”¯æŒ `/nomos:pr` æ‰‹åŠ¨è§¦å‘å’Œ PR æ¨¡æ¿ç®¡ç†ã€‚

### 6.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PR è‡ªåŠ¨ç”Ÿæˆæ¶æ„                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  è§¦å‘æ–¹å¼:                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ‰‹åŠ¨: /nomos:pr        â”‚  â”‚ è‡ªåŠ¨: auto_pr_on_complete é…ç½®      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                      â”‚                    â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    PR æè¿°ç”Ÿæˆå™¨                                       â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  æ•°æ®æºæå–:                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ plan.md        â”‚  â”‚ code_review.md â”‚  â”‚ git log               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â†’ Summary      â”‚  â”‚ â†’ Test Plan    â”‚  â”‚ â†’ Commit History      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â†’ Changes      â”‚  â”‚ â†’ Checklist    â”‚  â”‚ â†’ Changed Files       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â†’ Architecture â”‚  â”‚ â†’ Findings     â”‚  â”‚                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚           â”‚                   â”‚                        â”‚             â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚                               â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                    PR æ¨¡æ¿å¼•æ“                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ å†…ç½®é»˜è®¤æ¨¡æ¿     â”‚  â”‚ é¡¹ç›®è‡ªå®šä¹‰æ¨¡æ¿                    â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ (æ ‡å‡† PR æ ¼å¼)   â”‚  â”‚ (.claude/pr-template.md)         â”‚   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    è¾“å‡º                                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ PR æè¿° Markdown (stdout / æ–‡ä»¶)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ gh pr create (å¯é€‰ï¼Œéœ€ç”¨æˆ·ç¡®è®¤)                                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€ PR æè¿°ä¿å­˜åˆ° tasks/{task}/pr_description.md                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/pr_generator.py

import os
import re
import subprocess
import json
from dataclasses import dataclass, field
from typing import List, Optional, Dict

@dataclass
class PRDescription:
    title: str                       # PR æ ‡é¢˜
    summary: str                     # æ¦‚è¦æè¿°
    changes: List[str]               # å˜æ›´åˆ—è¡¨
    architecture_notes: str          # æ¶æ„è¯´æ˜ (æ¥è‡ª plan.md)
    test_plan: str                   # æµ‹è¯•è®¡åˆ’ (æ¥è‡ª code_review.md)
    checklist: List[str]             # å®¡æŸ¥æ¸…å•
    related_issues: List[str]        # å…³è” Issue
    commit_history: List[str]        # Commit å†å²
    changed_files: List[str]         # å˜æ›´æ–‡ä»¶åˆ—è¡¨
    revert_history: List[str] = field(default_factory=list)  # Revert å†å²

    def to_markdown(self) -> str:
        """ç”Ÿæˆ PR æè¿° Markdown"""
        pass

class PRGenerator:
    """PR è‡ªåŠ¨ç”Ÿæˆå™¨"""

    DEFAULT_TEMPLATE_PATH = ".claude/hooks/lib/pr_template.md"
    PROJECT_TEMPLATE_PATH = ".claude/pr-template.md"

    def __init__(self, task_path: str):
        self.task_path = task_path

    def generate(self) -> PRDescription:
        """
        ç”Ÿæˆ PR æè¿° (ä¸»å…¥å£)

        æµç¨‹:
        1. ä» plan.md æå– Summary / Changes / Architecture
        2. ä» code_review.md æå– Test Plan / Checklist / Findings
        3. ä» git log æå– Commit History / Changed Files
        4. åº”ç”¨ PR æ¨¡æ¿
        5. ç”Ÿæˆ PRDescription
        """
        pass

    def extract_from_plan(self, plan_path: str) -> Dict[str, str]:
        """
        ä» plan.md æå–ä¿¡æ¯

        æå–:
        - ç›®æ ‡å£°æ˜ â†’ Summary
        - Phase Gates â†’ Changes
        - æ¶æ„è®¾è®¡ â†’ Architecture Notes
        """
        pass

    def extract_from_code_review(self, review_path: str) -> Dict[str, str]:
        """
        ä» code_review.md æå–ä¿¡æ¯

        æå–:
        - æµ‹è¯•ç»“æœ â†’ Test Plan
        - å®¡æŸ¥å‘ç° â†’ Checklist
        - Revert è®°å½• â†’ Revert History
        """
        pass

    def extract_from_git(self) -> Dict[str, List[str]]:
        """
        ä» git æå–ä¿¡æ¯

        æå–:
        - git log --oneline â†’ Commit History
        - git diff --name-only â†’ Changed Files
        """
        pass

    def load_template(self) -> str:
        """åŠ è½½ PR æ¨¡æ¿ (é¡¹ç›®è‡ªå®šä¹‰ä¼˜å…ˆï¼Œå¦åˆ™ç”¨é»˜è®¤)"""
        pass

    def save_pr_description(self, pr: PRDescription) -> str:
        """ä¿å­˜ PR æè¿°åˆ° tasks/{task}/pr_description.md"""
        pass

    def create_pr(self, pr: PRDescription, draft: bool = True) -> Optional[str]:
        """
        ä½¿ç”¨ gh CLI åˆ›å»º PR (éœ€ç”¨æˆ·ç¡®è®¤)

        Returns:
            PR URL æˆ– None
        """
        pass
```

### 6.4 PR æ¨¡æ¿é»˜è®¤æ ¼å¼

```markdown
## Summary

{summary}

## Changes

{changes}

## Architecture Notes

{architecture_notes}

## Test Plan

{test_plan}

## Checklist

{checklist}

## Commit History

{commit_history}

## Changed Files

{changed_files}

---
*Auto-generated by Nomos from task {task_id}*
```

### 6.5 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.5.1 | å®ç° `PRGenerator` ç±»éª¨æ¶ | `pr_generator.py` | ç±»å¯å®ä¾‹åŒ– |
| 2.5.2 | å®ç° `extract_from_plan()` | `pr_generator.py` | æ­£ç¡®æå– plan.md ä¿¡æ¯ |
| 2.5.3 | å®ç° `extract_from_code_review()` | `pr_generator.py` | æ­£ç¡®æå– code_review.md ä¿¡æ¯ |
| 2.5.4 | å®ç° `extract_from_git()` | `pr_generator.py` | æ­£ç¡®æå– git ä¿¡æ¯ |
| 2.5.5 | å®ç° `load_template()` | `pr_generator.py` | é¡¹ç›®æ¨¡æ¿ä¼˜å…ˆåŠ è½½ |
| 2.5.6 | å®ç° `generate()` ä¸»å…¥å£ | `pr_generator.py` | ç”Ÿæˆå®Œæ•´ PR æè¿° |
| 2.5.7 | å®ç° `to_markdown()` | `pr_generator.py` | è¾“å‡ºæ ¼å¼æ­£ç¡® |
| 2.5.8 | å®ç° `/nomos:pr` æç¤ºè¯ | `prompts/pr.md` | å‘½ä»¤å¯è°ƒç”¨ |
| 2.5.9 | å®ç° `create_pr()` gh CLI é›†æˆ | `pr_generator.py` | å¯é€‰åˆ›å»º GitHub PR |
| 2.5.10 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_pr_generator.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 6.6 Gate å®Œæˆæ¡ä»¶

- [ ] `extract_from_plan()` èƒ½æ­£ç¡®æå– plan.md çš„ Summary/Changes/Architecture
- [ ] `extract_from_code_review()` èƒ½æ­£ç¡®æå– Test Plan/Checklist
- [ ] `extract_from_git()` èƒ½æ­£ç¡®æå– Commit History/Changed Files
- [ ] `generate()` èƒ½ç”Ÿæˆå®Œæ•´çš„ PR æè¿°
- [ ] PR æ¨¡æ¿æ”¯æŒé¡¹ç›®è‡ªå®šä¹‰è¦†ç›–
- [ ] `/nomos:pr` å‘½ä»¤æ­£å¸¸å·¥ä½œ
- [ ] PR æè¿°ä¿å­˜åˆ° `tasks/{task}/pr_description.md`
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ (Gate 2.5)

---

## 7. Gate 2.6: SKILL Marketplace

### 7.1 ç›®æ ‡

æ‰©å±• SKILL ç³»ç»Ÿä¸º Marketplace æ¨¡å¼ï¼Œå®ç°å­ SKILL è°ƒç”¨æœºåˆ¶ï¼Œæ–°å¢ `/nomos:update-why`ã€`/nomos:validate`ã€`/nomos:archive` ä¸‰ä¸ªå­å‘½ä»¤ã€‚

### 7.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SKILL Marketplace æ¶æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    /nomos ä¸» SKILL                               â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  å·²æœ‰å‘½ä»¤ (Phase 0/1):                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:start                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:list-tasks                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:switch-task                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:new-task                                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ /nomos:view-task                                           â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  æ–°å¢å‘½ä»¤ (Phase 2):                                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:update-why    â”€â”€â–º WhyMaintainer                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:validate      â”€â”€â–º ValidatorSubagent                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /nomos:archive       â”€â”€â–º TaskArchiver                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€ /nomos:pr            â”€â”€â–º PRGenerator                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    å­ SKILL è°ƒç”¨æœºåˆ¶                                   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ SKILL æ³¨å†Œè¡¨ (.claude/skills/nomos/SKILL.md)              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ commands:                                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   - name: update-why                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     handler: prompt                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     prompt: prompts/update-why.md                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   - name: validate                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     handler: agent                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     agent_config: validator_subagent                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   - name: archive                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     handler: prompt                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     prompt: prompts/archive.md                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   - name: pr                                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     handler: prompt                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     prompt: prompts/pr.md                                      â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  Handler ç±»å‹:                                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ prompt: åŠ è½½æç¤ºè¯æ–‡ä»¶ï¼Œå¼•å¯¼ Agent æ‰§è¡Œ                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ agent: spawn å­ Agent (å¦‚ Validator)                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ command: ç›´æ¥æ‰§è¡Œ Python/Bash è„šæœ¬                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å­å‘½ä»¤æç¤ºè¯

#### /nomos:update-why

```markdown
# .claude/skills/nomos/prompts/update-why.md

ä½ æ­£åœ¨æ‰§è¡Œ project-why.md çš„æ™ºèƒ½æ›´æ–°ã€‚

## æ‰§è¡Œæ­¥éª¤

1. **è¯»å–å½“å‰ project-why.md**
   - åŠ è½½æ‰€æœ‰å·²æœ‰æ¡ç›®
   - ç»Ÿè®¡æ¡ç›®æ•°é‡å’Œåˆ†ç±»

2. **æ”¶é›†æ–°çŸ¥è¯†**
   - ä»å½“å‰ä»»åŠ¡çš„ research.md æå–æ–°å‘ç°
   - ä» code_review.md æå–æ•™è®­
   - ä»æ ‡æ³¨å¾ªç¯ä¸­æå–æ¾„æ¸…ç»“æœ

3. **ç›¸ä¼¼åº¦æ£€æµ‹**
   - å¯¹æ¯ä¸ªæ–°æ¡ç›®ï¼Œæ£€æµ‹ä¸å·²æœ‰æ¡ç›®çš„ç›¸ä¼¼åº¦
   - æ— ç›¸ä¼¼ â†’ ç›´æ¥è¿½åŠ 
   - ä¸­ç­‰ç›¸ä¼¼ â†’ æç¤ºç”¨æˆ·ç¡®è®¤å¢å¼º
   - é«˜åº¦ç›¸ä¼¼ â†’ æç¤ºç”¨æˆ·ç¡®è®¤åˆå¹¶

4. **æ›´æ–° project-why.md**
   - å†™å…¥æ–°/åˆå¹¶/å¢å¼ºåçš„æ¡ç›®
   - æ›´æ–° YAML Frontmatter

## çº¦æŸ

- ä¸è¦†ç›–å·²æœ‰å†…å®¹ï¼Œåªè¿½åŠ æˆ–å¢å¼º
- åˆå¹¶æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤
- ä¿æŒåˆ†ç±»ç»“æ„ä¸€è‡´
```

#### /nomos:archive

```markdown
# .claude/skills/nomos/prompts/archive.md

ä½ æ­£åœ¨æ‰§è¡Œä»»åŠ¡å½’æ¡£æ“ä½œã€‚

## æ‰§è¡Œæ­¥éª¤

1. **éªŒè¯ä»»åŠ¡çŠ¶æ€**
   - ç¡®è®¤ä»»åŠ¡å·²å®Œæˆ (æ‰€æœ‰ Gates âœ…)
   - ç¡®è®¤æ‰€æœ‰ Review Comments å·² addressed
   - ç¡®è®¤ PR å·²åˆ›å»ºæˆ–ä¸éœ€è¦

2. **å½’æ¡£æ“ä½œ**
   - æ›´æ–° short-id-mapping.json: archived = true
   - æ›´æ–°ä»»åŠ¡æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶çš„ status: archived
   - æ¸…ç† current-task.txt (å¦‚æœæ˜¯å½“å‰ä»»åŠ¡)

3. **çŸ¥è¯†æ²‰æ·€**
   - å°†ä»»åŠ¡ä¸­çš„å…³é”®å†³ç­–åŒæ­¥åˆ° project-why.md
   - è®°å½•ä»»åŠ¡ç»Ÿè®¡ (è€—æ—¶ã€Revert æ¬¡æ•°ã€Linter é€šè¿‡ç‡)

4. **è¾“å‡ºå½’æ¡£æŠ¥å‘Š**
   - ä»»åŠ¡æ¦‚è¦
   - å…³é”®æŒ‡æ ‡
   - çŸ¥è¯†è´¡çŒ®

## çº¦æŸ

- ä¸åˆ é™¤ä»»åŠ¡æ–‡ä»¶å¤¹ (ä¿ç•™å†å²)
- å½’æ¡£åä»»åŠ¡å˜ä¸ºåªè¯»
```

### 7.4 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.6.1 | æ›´æ–° SKILL.md æ³¨å†Œæ–°å‘½ä»¤ | `SKILL.md` | æ–°å‘½ä»¤å¯è¢«è¯†åˆ« |
| 2.6.2 | ç¼–å†™ `update-why.md` æç¤ºè¯ | `prompts/update-why.md` | æµç¨‹æ­¥éª¤æ¸…æ™° |
| 2.6.3 | ç¼–å†™ `validate.md` æç¤ºè¯ | `prompts/validate.md` | è°ƒç”¨ ValidatorSubagent |
| 2.6.4 | ç¼–å†™ `archive.md` æç¤ºè¯ | `prompts/archive.md` | å½’æ¡£æµç¨‹å®Œæ•´ |
| 2.6.5 | ç¼–å†™ `pr.md` æç¤ºè¯ | `prompts/pr.md` | è°ƒç”¨ PRGenerator |
| 2.6.6 | å®ç° TaskArchiver å½’æ¡£é€»è¾‘ | `task_archiver.py` | æ­£ç¡®å½’æ¡£ä»»åŠ¡ |
| 2.6.7 | å®ç°å­ SKILL è°ƒç”¨æœºåˆ¶ | SKILL ç³»ç»Ÿ | prompt/agent/command ä¸‰ç§ handler |
| 2.6.8 | ç«¯åˆ°ç«¯æµ‹è¯•æ‰€æœ‰æ–°å‘½ä»¤ | æ‰‹åŠ¨æµ‹è¯• | æ‰€æœ‰å‘½ä»¤æ­£å¸¸å·¥ä½œ |

### 7.5 Gate å®Œæˆæ¡ä»¶

- [ ] `/nomos:update-why` èƒ½æ™ºèƒ½æ›´æ–° project-why.md
- [ ] `/nomos:validate` èƒ½è°ƒç”¨ ValidatorSubagent å®¡æŸ¥
- [ ] `/nomos:archive` èƒ½æ­£ç¡®å½’æ¡£å·²å®Œæˆä»»åŠ¡
- [ ] `/nomos:pr` èƒ½ç”Ÿæˆ PR æè¿°
- [ ] SKILL.md æ­£ç¡®æ³¨å†Œæ‰€æœ‰æ–°å‘½ä»¤
- [ ] å­ SKILL è°ƒç”¨æœºåˆ¶æ”¯æŒ prompt/agent/command ä¸‰ç§ handler
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 8. Gate 2.7: ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶

### 8.1 ç›®æ ‡

æ„å»ºç¬¬ä¸‰å±‚ä¸šåŠ¡è§„åˆ™æ¡†æ¶ï¼Œæä¾›è§„åˆ™ç¤ºä¾‹æ¨¡æ¿ (æ¨¡å—éš”ç¦»/i18n/logger/æ¥å£ä¿æŠ¤)ï¼Œå®ç° plan.md åŠ¨æ€è§„åˆ™è¯»å– ("æ ‡æ³¨å³æ‹¦æˆª")ï¼Œæ”¯æŒ Command + Prompt + Agent æ··åˆ Handlerã€‚

### 8.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶æ¶æ„                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ä¸‰å±‚è§„åˆ™ä½“ç³»                                        â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  ç¬¬ä¸€å±‚ (è¯­æ³•/é£æ ¼) â”€â”€â”€ Ruff / ESLint â”€â”€â”€ Command Handler           â”‚ â”‚
â”‚  â”‚  ç¬¬äºŒå±‚ (å®‰å…¨)      â”€â”€â”€ Bandit / Semgrep â”€â”€ Command Handler          â”‚ â”‚
â”‚  â”‚  ç¬¬ä¸‰å±‚ (ä¸šåŠ¡)      â”€â”€â”€ è‡ªå®šä¹‰è§„åˆ™ â”€â”€â”€â”€â”€â”€â”€â”€ æ··åˆ Handler â—„â”€â”€ æœ¬ Gate â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    æ··åˆ Handler æ¶æ„                                   â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Command Handler (é™æ€æ£€æŸ¥)                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ æ­£åˆ™åŒ¹é…ã€AST è§£æã€æ–‡ä»¶è·¯å¾„æ£€æŸ¥                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ é€Ÿåº¦å¿«ï¼Œç¡®å®šæ€§é«˜                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ ç¤ºä¾‹: æ¨¡å—éš”ç¦»æ£€æŸ¥ã€import è·¯å¾„æ£€æŸ¥                           â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                               â”‚                                       â”‚ â”‚
â”‚  â”‚                               â–¼ (é™æ€æ£€æŸ¥æ— æ³•åˆ¤æ–­æ—¶)                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Prompt Handler (è¯­ä¹‰åˆ¤æ–­)                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ è°ƒç”¨ Haiku å•è½®åˆ¤æ–­                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ å¤„ç†éœ€è¦è¯­ä¹‰ç†è§£çš„è§„åˆ™                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ ç¤ºä¾‹: i18n æ£€æŸ¥ã€logger è§„èŒƒæ£€æŸ¥                              â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                               â”‚                                       â”‚ â”‚
â”‚  â”‚                               â–¼ (éœ€è¦æ·±åº¦éªŒè¯æ—¶)                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Agent Handler (æ·±åº¦éªŒè¯)                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ spawn å­ Agent è¿›è¡Œæ·±åº¦æ£€æŸ¥                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ å¤„ç†è·¨æ–‡ä»¶ä¾èµ–ã€æ¶æ„ä¸€è‡´æ€§                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â†’ ç¤ºä¾‹: Protected Interface æ£€æŸ¥ã€trace_id ä¼ é€’æ£€æŸ¥             â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                           â”‚
â”‚                                â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    åŠ¨æ€è§„åˆ™è¯»å– (plan.md)                              â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  plan.md ä¸­çš„è§„åˆ™å£°æ˜:                                                â”‚ â”‚
â”‚  â”‚  ```yaml                                                              â”‚ â”‚
â”‚  â”‚  # plan.md YAML Frontmatter                                          â”‚ â”‚
â”‚  â”‚  custom_rules:                                                        â”‚ â”‚
â”‚  â”‚    - rule: module_isolation                                           â”‚ â”‚
â”‚  â”‚      config: { allowed_imports: ["src.core", "src.utils"] }          â”‚ â”‚
â”‚  â”‚    - rule: i18n_required                                              â”‚ â”‚
â”‚  â”‚      config: { target_dirs: ["src/ui/"] }                            â”‚ â”‚
â”‚  â”‚  ```                                                                  â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â†’ PreToolUse Hook è¯»å– plan.md çš„ custom_rules                      â”‚ â”‚
â”‚  â”‚  â†’ åŠ¨æ€åŠ è½½å¯¹åº”çš„ç¬¬ä¸‰å±‚è§„åˆ™                                           â”‚ â”‚
â”‚  â”‚  â†’ "æ ‡æ³¨å³æ‹¦æˆª": äººç±»åœ¨ plan.md æ ‡æ³¨çš„è§„åˆ™è‡ªåŠ¨ç”Ÿæ•ˆ                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/rules/layer3_business.py

import os
import re
import ast
import json
from typing import List, Optional, Dict, Any
from .base_rule import BaseRule, RuleViolation, Severity

class Layer3Rule(BaseRule):
    """ç¬¬ä¸‰å±‚ä¸šåŠ¡è§„åˆ™åŸºç±»"""

    layer = 3
    handler_type: str = "command"    # "command" / "prompt" / "agent"

    def __init__(self, config: Dict[str, Any] = None):
        self.config = config or {}


class ModuleIsolationRule(Layer3Rule):
    """æ¨¡å—éš”ç¦»è§„åˆ™ - Command Handler"""

    name = "module_isolation"
    handler_type = "command"
    description = "æ£€æŸ¥æ¨¡å—é—´ import æ˜¯å¦ç¬¦åˆéš”ç¦»è§„åˆ™"

    def check(self, file_path: str, content: str) -> List[RuleViolation]:
        """
        æ£€æŸ¥ import è·¯å¾„æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­

        config:
          allowed_imports: ["src.core", "src.utils"]
          forbidden_imports: ["src.internal"]
        """
        pass


class I18nRule(Layer3Rule):
    """å›½é™…åŒ–è§„åˆ™ - Prompt Handler"""

    name = "i18n_required"
    handler_type = "prompt"
    description = "æ£€æŸ¥ UI ç›¸å…³ä»£ç æ˜¯å¦ä½¿ç”¨ i18n"

    def check(self, file_path: str, content: str) -> List[RuleViolation]:
        """
        ä½¿ç”¨ Haiku åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¡¬ç¼–ç å­—ç¬¦ä¸²

        config:
          target_dirs: ["src/ui/", "src/views/"]
          exclude_patterns: ["test_*", "*_test.py"]
        """
        pass

    def _call_haiku(self, prompt: str) -> str:
        """è°ƒç”¨ Haiku è¿›è¡Œè¯­ä¹‰åˆ¤æ–­"""
        pass


class LoggerRule(Layer3Rule):
    """Logger è§„èŒƒè§„åˆ™ - Prompt Handler"""

    name = "logger_standard"
    handler_type = "prompt"
    description = "æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ ‡å‡† logger è€Œé print"

    def check(self, file_path: str, content: str) -> List[RuleViolation]:
        """
        æ£€æµ‹ print() è°ƒç”¨å¹¶å»ºè®®ä½¿ç”¨ logger

        config:
          logger_module: "src.utils.logger"
          allow_print_in: ["scripts/", "tests/"]
        """
        pass


class InterfaceProtectionRule(Layer3Rule):
    """æ¥å£ä¿æŠ¤è§„åˆ™ - Agent Handler"""

    name = "interface_protection"
    handler_type = "agent"
    description = "æ£€æŸ¥ Protected Interface æ˜¯å¦è¢«æœªå£°æ˜ä¿®æ”¹"

    def check(self, file_path: str, content: str) -> List[RuleViolation]:
        """
        spawn å­ Agent æ£€æŸ¥æ¥å£ç­¾åå˜æ›´

        config:
          protected_files: ["src/core/interfaces.py"]
          protected_functions: ["authenticate", "authorize"]
        """
        pass


class DynamicRuleLoader:
    """ä» plan.md åŠ¨æ€åŠ è½½ç¬¬ä¸‰å±‚è§„åˆ™"""

    RULE_REGISTRY = {
        "module_isolation": ModuleIsolationRule,
        "i18n_required": I18nRule,
        "logger_standard": LoggerRule,
        "interface_protection": InterfaceProtectionRule,
    }

    def load_from_plan(self, plan_path: str) -> List[Layer3Rule]:
        """
        ä» plan.md çš„ YAML Frontmatter è¯»å– custom_rules

        Returns:
            å®ä¾‹åŒ–çš„ç¬¬ä¸‰å±‚è§„åˆ™åˆ—è¡¨
        """
        pass

    def register_rule(self, name: str, rule_class: type) -> None:
        """æ³¨å†Œè‡ªå®šä¹‰è§„åˆ™åˆ°æ³¨å†Œè¡¨"""
        pass
```

### 8.4 è§„åˆ™ç¤ºä¾‹æ¨¡æ¿

```yaml
# .claude/hooks/lib/rule_templates/module_isolation.yml
# æ¨¡å—éš”ç¦»è§„åˆ™æ¨¡æ¿

name: module_isolation
layer: 3
handler_type: command
description: "æ£€æŸ¥æ¨¡å—é—´ import æ˜¯å¦ç¬¦åˆéš”ç¦»è§„åˆ™"

default_config:
  allowed_imports:
    - "src.core"
    - "src.utils"
    - "src.models"
  forbidden_imports:
    - "src.internal"
    - "src.deprecated"
  check_patterns:
    - "^from\\s+(\\S+)\\s+import"
    - "^import\\s+(\\S+)"

---
# .claude/hooks/lib/rule_templates/i18n_required.yml
# å›½é™…åŒ–è§„åˆ™æ¨¡æ¿

name: i18n_required
layer: 3
handler_type: prompt
description: "æ£€æŸ¥ UI ä»£ç æ˜¯å¦ä½¿ç”¨ i18n"

default_config:
  target_dirs:
    - "src/ui/"
    - "src/views/"
    - "src/components/"
  exclude_patterns:
    - "test_*"
    - "*_test.py"
  i18n_function: "_t"
  prompt_template: |
    æ£€æŸ¥ä»¥ä¸‹ä»£ç æ˜¯å¦å­˜åœ¨ç¡¬ç¼–ç çš„ç”¨æˆ·å¯è§å­—ç¬¦ä¸²ã€‚
    å¦‚æœå­˜åœ¨ï¼Œå»ºè®®ä½¿ç”¨ {i18n_function}() å‡½æ•°åŒ…è£¹ã€‚
    åªæŠ¥å‘Šç¡®å®šæ˜¯ç”¨æˆ·å¯è§çš„å­—ç¬¦ä¸²ï¼Œå¿½ç•¥æ—¥å¿—ã€æ³¨é‡Šã€å˜é‡åã€‚

---
# .claude/hooks/lib/rule_templates/logger_standard.yml
# Logger è§„èŒƒè§„åˆ™æ¨¡æ¿

name: logger_standard
layer: 3
handler_type: prompt
description: "æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ ‡å‡† logger"

default_config:
  logger_module: "src.utils.logger"
  allow_print_in:
    - "scripts/"
    - "tests/"
    - "tools/"
  prompt_template: |
    æ£€æŸ¥ä»¥ä¸‹ä»£ç æ˜¯å¦ä½¿ç”¨äº† print() è¿›è¡Œæ—¥å¿—è¾“å‡ºã€‚
    å¦‚æœæ˜¯ä¸šåŠ¡é€»è¾‘ä¸­çš„æ—¥å¿—ï¼Œå»ºè®®ä½¿ç”¨ {logger_module}ã€‚
    å¦‚æœæ˜¯è°ƒè¯•è¾“å‡ºæˆ–è„šæœ¬è¾“å‡ºï¼Œå¯ä»¥ä¿ç•™ print()ã€‚

---
# .claude/hooks/lib/rule_templates/interface_protection.yml
# æ¥å£ä¿æŠ¤è§„åˆ™æ¨¡æ¿

name: interface_protection
layer: 3
handler_type: agent
description: "æ£€æŸ¥ Protected Interface ç­¾åæ˜¯å¦è¢«ä¿®æ”¹"

default_config:
  protected_files: []
  protected_functions: []
  protected_classes: []
  check_signature: true
  check_return_type: true
```

### 8.5 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 2.7.1 | å®ç° `Layer3Rule` åŸºç±» | `layer3_business.py` | æ”¯æŒ config å‚æ•° |
| 2.7.2 | å®ç° `ModuleIsolationRule` (Command) | `layer3_business.py` | æ£€æµ‹éæ³• import |
| 2.7.3 | å®ç° `I18nRule` (Prompt) | `layer3_business.py` | æ£€æµ‹ç¡¬ç¼–ç å­—ç¬¦ä¸² |
| 2.7.4 | å®ç° `LoggerRule` (Prompt) | `layer3_business.py` | æ£€æµ‹ print è°ƒç”¨ |
| 2.7.5 | å®ç° `InterfaceProtectionRule` (Agent) | `layer3_business.py` | æ£€æµ‹æ¥å£ç­¾åå˜æ›´ |
| 2.7.6 | å®ç° `DynamicRuleLoader` | `layer3_business.py` | ä» plan.md åŠ è½½è§„åˆ™ |
| 2.7.7 | åˆ›å»ºè§„åˆ™ç¤ºä¾‹æ¨¡æ¿ | `rule_templates/*.yml` | å››ä¸ªæ¨¡æ¿æ–‡ä»¶ |
| 2.7.8 | é›†æˆåˆ° PreToolUse Hook | `nomos-pretooluse.sh` | åŠ¨æ€åŠ è½½ç¬¬ä¸‰å±‚è§„åˆ™ |
| 2.7.9 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_layer3_rules.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 8.6 Gate å®Œæˆæ¡ä»¶

- [ ] `Layer3Rule` åŸºç±»æ”¯æŒ Command/Prompt/Agent ä¸‰ç§ handler_type
- [ ] `ModuleIsolationRule` èƒ½æ£€æµ‹éæ³• import è·¯å¾„
- [ ] `I18nRule` èƒ½é€šè¿‡ Haiku æ£€æµ‹ç¡¬ç¼–ç å­—ç¬¦ä¸²
- [ ] `LoggerRule` èƒ½æ£€æµ‹ print è°ƒç”¨å¹¶å»ºè®®ä½¿ç”¨ logger
- [ ] `InterfaceProtectionRule` èƒ½æ£€æµ‹ Protected Interface ç­¾åå˜æ›´
- [ ] `DynamicRuleLoader` èƒ½ä» plan.md YAML Frontmatter åŠ¨æ€åŠ è½½è§„åˆ™
- [ ] å››ä¸ªè§„åˆ™ç¤ºä¾‹æ¨¡æ¿å·²åˆ›å»º
- [ ] PreToolUse Hook èƒ½åŠ¨æ€åŠ è½½ç¬¬ä¸‰å±‚è§„åˆ™
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ (Gate 2.7)

---

## 9. Gate é—´ä¾èµ–å…³ç³»

### 9.1 ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 2 Gate ä¾èµ–å…³ç³»                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Gate 2.1 (Validator Subagent)         Gate 2.3 (è¯šå®è¿½é—®å¼•æ“)             â”‚
â”‚     â”‚                                     â”‚                                 â”‚
â”‚     â”‚ Validator å‘ç°è§¦å‘ Revert           â”‚ è¿½é—®ç»“æœæ›´æ–° project-why.md     â”‚
â”‚     â”‚                                     â”‚                                 â”‚
â”‚     â–¼                                     â–¼                                 â”‚
â”‚  Gate 2.2 (Revert Manager)            Gate 2.4 (project-why.md æ™ºèƒ½ç»´æŠ¤)   â”‚
â”‚     â”‚                                     â”‚                                 â”‚
â”‚     â”‚ Revert æ•™è®­åŒæ­¥                     â”‚ çŸ¥è¯†åº“æ”¯æ’‘ PR æè¿°              â”‚
â”‚     â”‚                                     â”‚                                 â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                    â”‚                                                        â”‚
â”‚                    â–¼                                                        â”‚
â”‚  Gate 2.5 (PR è‡ªåŠ¨ç”Ÿæˆ)                                                    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”‚ PR å‘½ä»¤æ³¨å†Œåˆ° Marketplace                                            â”‚
â”‚     â–¼                                                                       â”‚
â”‚  Gate 2.6 (SKILL Marketplace)                                              â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”‚ å­ SKILL è°ƒç”¨ç¬¬ä¸‰å±‚è§„åˆ™                                              â”‚
â”‚     â–¼                                                                       â”‚
â”‚  Gate 2.7 (ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶)                                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ä¾èµ–çŸ©é˜µ

| Gate | ä¾èµ– | å¯å¹¶è¡Œ |
|------|------|--------|
| 2.1 Validator Subagent | Phase 1 å®Œæˆ | ä¸ 2.3 å¹¶è¡Œ |
| 2.2 Revert Manager | 2.1 (Validator è§¦å‘) | ä¸ 2.4 å¹¶è¡Œ |
| 2.3 è¯šå®è¿½é—®å¼•æ“ | Phase 1 æ ‡æ³¨ç³»ç»Ÿ | ä¸ 2.1 å¹¶è¡Œ |
| 2.4 project-why.md æ™ºèƒ½ç»´æŠ¤ | Phase 1 Why-First | ä¸ 2.2 å¹¶è¡Œ |
| 2.5 PR è‡ªåŠ¨ç”Ÿæˆ | 2.2, 2.4 | ä¸å¯å¹¶è¡Œ |
| 2.6 SKILL Marketplace | 2.1, 2.4, 2.5 | ä¸å¯å¹¶è¡Œ |
| 2.7 ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶ | 2.6 (åŠ¨æ€åŠ è½½) | ä¸å¯å¹¶è¡Œ |

### 9.3 æ¨èå¼€å‘é¡ºåº

```
æ—¶é—´çº¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

  Gate 2.1 (Validator) â”€â”€â–º Gate 2.2 (Revert) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        â”‚
  Gate 2.3 (è¿½é—®) â”€â”€â–º Gate 2.4 (Why ç»´æŠ¤) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â–º Gate 2.5 (PR)
                                                        â”‚
                                                        â””â”€â”€â–º Gate 2.6 (SKILL) â”€â”€â–º Gate 2.7 (L3 è§„åˆ™)
```

---

## 10. éªŒæ”¶æ ‡å‡†

### 10.1 ç«¯åˆ°ç«¯éªŒæ”¶åœºæ™¯

**åœºæ™¯: å®Œæ•´é«˜çº§åŠŸèƒ½å·¥ä½œæµ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 2 ç«¯åˆ°ç«¯éªŒæ”¶æµç¨‹                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Step 1: Validator è‡ªåŠ¨å®¡æŸ¥                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Agent ç”Ÿæˆ research.md â†’ Validator è‡ªåŠ¨ spawn                       â”‚ â”‚
â”‚  â”‚ Validator å‘ç° Protected Interfaces æœªåˆ—å‡º â†’ å†™å…¥ CRITICAL RC       â”‚ â”‚
â”‚  â”‚ Agent ä¿®å¤ â†’ Validator é‡æ–°å®¡æŸ¥ â†’ é€šè¿‡                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 2: æ ‡æ³¨å¾ªç¯ + è¯šå®è¿½é—®                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç”¨æˆ·æ ‡æ³¨: "è¿™é‡Œè¦è€ƒè™‘å¹¶å‘åœºæ™¯"                                       â”‚ â”‚
â”‚  â”‚ Agent ç†è§£åº¦ < 0.7 â†’ ç”Ÿæˆè¿½é—®: "æ‚¨æŒ‡çš„æ˜¯å“ªç§å¹¶å‘? å¤šçº¿ç¨‹/å¤šè¿›ç¨‹/å¼‚æ­¥?"â”‚ â”‚
â”‚  â”‚ æ ‡æ³¨çŠ¶æ€: pending â†’ pending_ai_question (ğŸŸ£ ç´«è‰²é—ªçƒ)               â”‚ â”‚
â”‚  â”‚ ç”¨æˆ·å›ç­”: "å¼‚æ­¥ IOï¼Œä½¿ç”¨ asyncio"                                    â”‚ â”‚
â”‚  â”‚ Agent ç†è§£åº¦ >= 0.7 â†’ å¤„ç†æ ‡æ³¨ â†’ addressed                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 3: Execute + Revert                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Agent å®ç°ä»£ç  â†’ ä¿®æ”¹äº† Protected Interface (æœªå£°æ˜)                 â”‚ â”‚
â”‚  â”‚ Validator æ£€æµ‹åˆ°æ¶æ„å†²çª â†’ è§¦å‘ Revert                              â”‚ â”‚
â”‚  â”‚ Revert Manager: åˆ›å»º .old åˆ†æ”¯ â†’ git revert â†’ å›é€€åˆ° Plan é˜¶æ®µ     â”‚ â”‚
â”‚  â”‚ æ•™è®­åŒæ­¥åˆ° project-why.md: "WHY-015: ä¿®æ”¹æ¥å£å‰å¿…é¡»å£°æ˜"            â”‚ â”‚
â”‚  â”‚ Agent é‡æ–°è®¾è®¡æ–¹æ¡ˆ â†’ å£°æ˜æ¥å£ä¿®æ”¹ â†’ é‡æ–°å®ç° â†’ é€šè¿‡                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 4: project-why.md æ™ºèƒ½ç»´æŠ¤                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /nomos:update-why                                               â”‚ â”‚
â”‚  â”‚ æ£€æµ‹åˆ° WHY-015 ä¸ WHY-003 (æ¥å£ä¿æŠ¤) é«˜åº¦ç›¸ä¼¼                       â”‚ â”‚
â”‚  â”‚ æç¤ºç”¨æˆ·: "å»ºè®®åˆå¹¶ WHY-003 å’Œ WHY-015"                             â”‚ â”‚
â”‚  â”‚ ç”¨æˆ·ç¡®è®¤ â†’ åˆå¹¶ä¸ºå¢å¼ºç‰ˆ WHY-003                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 5: PR è‡ªåŠ¨ç”Ÿæˆ                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /nomos:pr                                                       â”‚ â”‚
â”‚  â”‚ ä» plan.md æå– Summary/Changes                                     â”‚ â”‚
â”‚  â”‚ ä» code_review.md æå– Test Plan/Checklist                          â”‚ â”‚
â”‚  â”‚ ä» git log æå– Commit History                                      â”‚ â”‚
â”‚  â”‚ ç”Ÿæˆ PR æè¿° â†’ ä¿å­˜åˆ° pr_description.md                             â”‚ â”‚
â”‚  â”‚ ç”¨æˆ·ç¡®è®¤ â†’ gh pr create --draft                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 6: ä»»åŠ¡å½’æ¡£                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /nomos:archive                                                  â”‚ â”‚
â”‚  â”‚ éªŒè¯æ‰€æœ‰ Gates âœ… â†’ æ›´æ–° mapping â†’ åŒæ­¥çŸ¥è¯† â†’ è¾“å‡ºå½’æ¡£æŠ¥å‘Š          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 éªŒæ”¶ Checklist

| éªŒæ”¶é¡¹ | æè¿° | çŠ¶æ€ |
|--------|------|------|
| âœ… Validator è‡ªåŠ¨å®¡æŸ¥ | æ–‡æ¡£ç”Ÿæˆåè‡ªåŠ¨ spawn Validator | [ ] |
| âœ… Validator æ‰‹åŠ¨å®¡æŸ¥ | `/nomos:validate` æ­£å¸¸å·¥ä½œ | [ ] |
| âœ… Protected Interfaces | AST æ¯”å¯¹æ£€æµ‹æœªå£°æ˜ä¿®æ”¹ | [ ] |
| âœ… Revert è§¦å‘ | CRITICAL/[REVERT]/æ¶æ„å†²çª/æµ‹è¯•å¤±è´¥ è§¦å‘ Revert | [ ] |
| âœ… Revert æ‰§è¡Œ | git revert + .old åˆ†æ”¯ + çŠ¶æ€å›é€€ | [ ] |
| âœ… Revert æ•™è®­ | æ•™è®­åŒæ­¥åˆ° project-why.md | [ ] |
| âœ… è¯šå®è¿½é—® | ç†è§£åº¦ä¸è¶³æ—¶ç”Ÿæˆæ¾„æ¸…é—®é¢˜ | [ ] |
| âœ… è¿½é—®çŠ¶æ€ | pending_ai_question ç´«è‰²é—ªçƒ | [ ] |
| âœ… çŸ¥è¯†ç›¸ä¼¼æ£€æµ‹ | æ£€æµ‹é‡å¤/ç›¸ä¼¼çŸ¥è¯†æ¡ç›® | [ ] |
| âœ… çŸ¥è¯†åˆå¹¶ | é«˜åº¦ç›¸ä¼¼æ¡ç›®è‡ªåŠ¨åˆå¹¶ | [ ] |
| âœ… PR ç”Ÿæˆ | ä» plan.md + code_review.md ç”Ÿæˆ PR æè¿° | [ ] |
| âœ… SKILL Marketplace | å››ä¸ªæ–°å­å‘½ä»¤æ­£å¸¸å·¥ä½œ | [ ] |
| âœ… ç¬¬ä¸‰å±‚è§„åˆ™ | Command/Prompt/Agent ä¸‰ç§ Handler | [ ] |
| âœ… åŠ¨æ€è§„åˆ™ | plan.md æ ‡æ³¨çš„è§„åˆ™è‡ªåŠ¨ç”Ÿæ•ˆ | [ ] |

---

## 11. æŠ€æœ¯å†³ç­–è®°å½•

### 11.1 å†³ç­–æ¸…å•

| å†³ç­– | é€‰æ‹© | ç†ç”± | æ›¿ä»£æ–¹æ¡ˆ |
|------|------|------|----------|
| Validator å·¥å…·é™åˆ¶ | ä»… Read/Grep | ç¡®ä¿åªè¯»å®‰å…¨ï¼Œé˜²æ­¢ Validator æ„å¤–ä¿®æ”¹æ–‡ä»¶ | å…¨å·¥å…· (é£é™©é«˜) |
| ç›¸ä¼¼åº¦ç®—æ³• | Jaccard + å…³é”®è¯ | ç®€å•é«˜æ•ˆï¼Œæ— éœ€å¤–éƒ¨ä¾èµ– | å‘é‡åµŒå…¥ (éœ€è¦æ¨¡å‹) |
| Revert ç­–ç•¥ | git revert (é reset) | ä¿ç•™å†å²ï¼Œå¯è¿½æº¯ | git reset --hard (ä¸¢å¤±å†å²) |
| è¿½é—®è½®æ¬¡é™åˆ¶ | æœ€å¤š 3 è½® | é¿å…æ— é™è¿½é—®ï¼Œè¶…è¿‡ 3 è½®å‡çº§ä¸ºäººå·¥ | æ— é™åˆ¶ (ä½“éªŒå·®) |
| ç†è§£åº¦é˜ˆå€¼ | 0.7 | å¹³è¡¡è¿½é—®é¢‘ç‡å’Œç†è§£å‡†ç¡®æ€§ | 0.5 (è¿½é—®å¤ªå¤š) / 0.9 (è¿½é—®å¤ªå°‘) |
| Prompt Handler æ¨¡å‹ | Haiku | é€Ÿåº¦å¿«ã€æˆæœ¬ä½ï¼Œé€‚åˆå•è½®åˆ¤æ–­ | Sonnet (è¿‡åº¦) |
| åŠ¨æ€è§„åˆ™æ¥æº | plan.md YAML | ä¸ç°æœ‰æ–‡æ¡£ä½“ç³»ä¸€è‡´ | ç‹¬ç«‹é…ç½®æ–‡ä»¶ (åˆ†æ•£) |
| PR åˆ›å»ºæ–¹å¼ | gh CLI | æ ‡å‡†å·¥å…·ï¼Œè·¨å¹³å° | GitHub API (å¤æ‚) |
| å½’æ¡£ç­–ç•¥ | æ ‡è®° archived (ä¸åˆ é™¤) | ä¿ç•™å†å²ï¼Œæ”¯æŒå›æº¯ | ç§»åŠ¨åˆ° archive/ (è·¯å¾„å˜åŒ–) |
| å­ SKILL Handler | prompt/agent/command ä¸‰ç§ | è¦†ç›–ä¸åŒå¤æ‚åº¦åœºæ™¯ | ä»… prompt (èƒ½åŠ›ä¸è¶³) |

### 11.2 å·²çŸ¥é™åˆ¶

| é™åˆ¶ | å½±å“ | è®¡åˆ’è§£å†³é˜¶æ®µ |
|------|------|-------------|
| ç›¸ä¼¼åº¦ç®—æ³•ç²¾åº¦æœ‰é™ | å¯èƒ½è¯¯åˆ¤ç›¸ä¼¼/ä¸ç›¸ä¼¼ | Phase 3 (å‘é‡åµŒå…¥) |
| Haiku è¯­ä¹‰åˆ¤æ–­å¯èƒ½è¯¯æŠ¥ | ç¬¬ä¸‰å±‚ Prompt è§„åˆ™å¯èƒ½æœ‰è¯¯æŠ¥ | æä¾›äººå·¥è¦†ç›–æœºåˆ¶ |
| Revert ç²’åº¦ä¸º Gate | æ— æ³•ç²¾ç¡®åˆ°å•ä¸ªæ–‡ä»¶ | Phase 3 (ç»†ç²’åº¦ Revert) |
| è¿½é—®ä»…æ”¯æŒæ–‡æœ¬ | æ— æ³•è¿½é—®ä»£ç ç‰‡æ®µæˆ–å›¾è¡¨ | Phase 3 (å¤šæ¨¡æ€è¿½é—®) |
| PR ä»…æ”¯æŒ GitHub | ä¸æ”¯æŒ GitLab/Bitbucket | Phase 3 (å¤šå¹³å°) |
| ç¬¬ä¸‰å±‚è§„åˆ™æ—  YAML é…ç½® | éœ€è¦å†™ Python ä»£ç  | Phase 3 (YAML é…ç½®) |

---

## é™„å½•

### A. éœ€æ±‚è¿½æº¯çŸ©é˜µ

| Gate | å…³è” FR | å…³è” US |
|------|---------|---------|
| 2.1 Validator Subagent | FR-010, FR-105 | US-003, US-005 |
| 2.2 Revert Manager | FR-104, FR-110 | US-005, US-103 |
| 2.3 è¯šå®è¿½é—®å¼•æ“ | FR-021, FR-118 | US-001, US-004 |
| 2.4 project-why.md æ™ºèƒ½ç»´æŠ¤ | FR-022, FR-119, FR-120 | US-004, US-113 |
| 2.5 PR è‡ªåŠ¨ç”Ÿæˆ | FR-038, FR-111, FR-127 | US-110 |
| 2.6 SKILL Marketplace | FR-106, FR-114 | US-110, US-113 |
| 2.7 ç¬¬ä¸‰å±‚è§„åˆ™æ¡†æ¶ | FR-102, FR-103, FR-107 | US-001, US-003 |

### B. æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç±»å‹ | Gate |
|------|------|------|
| `.claude/hooks/lib/validator_subagent.py` | Python | 2.1 |
| `.claude/hooks/lib/default_checklist.yml` | é…ç½® | 2.1 |
| `.claude/validator-checklist.yml` | é…ç½® (é¡¹ç›®è¦†ç›–) | 2.1 |
| `.claude/hooks/lib/revert_manager.py` | Python | 2.2 |
| `.claude/hooks/lib/honest_questioning.py` | Python | 2.3 |
| `.claude/hooks/lib/why_maintainer.py` | Python | 2.4 |
| `.claude/hooks/lib/pr_generator.py` | Python | 2.5 |
| `.claude/hooks/lib/pr_template.md` | æ¨¡æ¿ | 2.5 |
| `.claude/pr-template.md` | æ¨¡æ¿ (é¡¹ç›®è¦†ç›–) | 2.5 |
| `.claude/hooks/lib/task_archiver.py` | Python | 2.6 |
| `.claude/skills/nomos/SKILL.md` | SKILL (æ›´æ–°) | 2.6 |
| `.claude/skills/nomos/prompts/validate.md` | Prompt | 2.1, 2.6 |
| `.claude/skills/nomos/prompts/update-why.md` | Prompt | 2.6 |
| `.claude/skills/nomos/prompts/archive.md` | Prompt | 2.6 |
| `.claude/skills/nomos/prompts/pr.md` | Prompt | 2.5, 2.6 |
| `.claude/hooks/lib/rules/layer3_business.py` | Python | 2.7 |
| `.claude/hooks/lib/rule_templates/module_isolation.yml` | æ¨¡æ¿ | 2.7 |
| `.claude/hooks/lib/rule_templates/i18n_required.yml` | æ¨¡æ¿ | 2.7 |
| `.claude/hooks/lib/rule_templates/logger_standard.yml` | æ¨¡æ¿ | 2.7 |
| `.claude/hooks/lib/rule_templates/interface_protection.yml` | æ¨¡æ¿ | 2.7 |
| `tests/test_validator.py` | æµ‹è¯• | 2.1 |
| `tests/test_revert_manager.py` | æµ‹è¯• | 2.2 |
| `tests/test_honest_questioning.py` | æµ‹è¯• | 2.3 |
| `tests/test_why_maintainer.py` | æµ‹è¯• | 2.4 |
| `tests/test_pr_generator.py` | æµ‹è¯• | 2.5 |
| `tests/test_layer3_rules.py` | æµ‹è¯• | 2.7 |

---

*æœ€åæ›´æ–°: 2026-02-25*
