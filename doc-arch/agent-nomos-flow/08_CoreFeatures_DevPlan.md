# N0mosAi - æ ¸å¿ƒåŠŸèƒ½å¼€å‘è®¡åˆ’ (Phase 1)

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
> **æœ€åæ›´æ–°**: 2026-02-25
> **çŠ¶æ€**: Draft
> **å‰ç½®ä¾èµ–**: Phase 0 (MVP) å®Œæˆ
> **å…³è”æ–‡æ¡£**: [06_Development_Plan_Overview.md](06_Development_Plan_Overview.md)

æœ¬æ–‡æ¡£å®šä¹‰ Phase 1 (Core Features) çš„è¯¦ç»†å¼€å‘è®¡åˆ’ï¼Œç›®æ ‡æ˜¯å®Œå–„åˆšæ€§æµç¨‹ï¼Œæ”¯æŒå®Œæ•´å·¥ä½œæµã€‚

---

## ç›®å½•

1. [é˜¶æ®µç›®æ ‡](#1-é˜¶æ®µç›®æ ‡)
2. [Gate 1.1: Task Viewer åŸºç¡€](#2-gate-11-task-viewer-åŸºç¡€)
3. [Gate 1.2: æ ‡æ³¨ç³»ç»Ÿ](#3-gate-12-æ ‡æ³¨ç³»ç»Ÿ)
4. [Gate 1.3: Why-First å¼•æ“](#4-gate-13-why-first-å¼•æ“)
5. [Gate 1.4: Git é›†æˆ](#5-gate-14-git-é›†æˆ)
6. [Gate 1.5: ä»»åŠ¡ç®¡ç†å¢å¼º](#6-gate-15-ä»»åŠ¡ç®¡ç†å¢å¼º)
7. [Gate 1.6: å†…å®¹åŒæ­¥](#7-gate-16-å†…å®¹åŒæ­¥)
8. [Gate é—´ä¾èµ–å…³ç³»](#8-gate-é—´ä¾èµ–å…³ç³»)
9. [éªŒæ”¶æ ‡å‡†](#9-éªŒæ”¶æ ‡å‡†)
10. [æŠ€æœ¯å†³ç­–è®°å½•](#10-æŠ€æœ¯å†³ç­–è®°å½•)
11. [æ–‡ä»¶æ¸…å•](#11-æ–‡ä»¶æ¸…å•)

---

## 1. é˜¶æ®µç›®æ ‡

### 1.1 ç›®æ ‡å£°æ˜

**Phase 1 ç›®æ ‡**: åœ¨ MVP åŸºç¡€ä¸Šï¼Œæ„å»º Task Viewer å¯è§†åŒ–ç•Œé¢ã€æ ‡æ³¨å¾ªç¯ç³»ç»Ÿã€Why-First å¼•æ“å’Œ Git é›†æˆï¼Œå®ç°å®Œæ•´çš„äººæœºåä½œå·¥ä½œæµã€‚

### 1.2 æˆåŠŸæ ‡å‡†

- [ ] Task Viewer èƒ½åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“ Markdown/Mermaid å¹¶æ”¯æŒåœ¨çº¿æ ‡æ³¨
- [ ] æ ‡æ³¨ç³»ç»Ÿæ”¯æŒå³é”®åˆ›å»ºã€å·¦é”®æŸ¥çœ‹ã€çŠ¶æ€æµè½¬ã€æŒä¹…åŒ–
- [ ] Why-First å¼•æ“èƒ½ç”Ÿæˆé’ˆå¯¹æ€§é—®é¢˜å¹¶ç®¡ç† project-why.md
- [ ] Git é›†æˆæ”¯æŒè‡ªåŠ¨åˆ†æ”¯åˆ›å»ºã€Gate commitã€commit message è§„èŒƒ
- [ ] UserPromptSubmit Hook èƒ½æ™ºèƒ½æ£€æµ‹ä»»åŠ¡åˆ‡æ¢æ„å›¾
- [ ] WebSocket + è½®è¯¢å®ç°å†…å®¹åŠ¨æ€åˆ·æ–°

### 1.3 èŒƒå›´è¾¹ç•Œ

- **åŒ…å«**: Task Viewer HTMLã€æ ‡æ³¨ç³»ç»Ÿã€Why-First å¼•æ“ã€Git é›†æˆã€ä»»åŠ¡ç®¡ç†å¢å¼ºã€å†…å®¹åŒæ­¥
- **ä¸åŒ…å«**: Validator Subagentã€Revert Managerã€è¯šå®è¿½é—®å¼•æ“ã€PR è‡ªåŠ¨ç”Ÿæˆ

### 1.4 é˜¶æ®µæ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 1: Core Features å¼€å‘è·¯çº¿å›¾                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Gate 1.1: Task Viewer åŸºç¡€                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Python HTTP æœåŠ¡å™¨ + HTML/CSS/JS å‰ç«¯ + marked.js + mermaid.js      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Gate 1.2: æ ‡æ³¨ç³»ç»Ÿ                          Gate 1.3: Why-First å¼•æ“       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å³é”®åˆ›å»º + å·¦é”®æŸ¥çœ‹ + çŠ¶æ€æµè½¬  â”‚     â”‚ Why é—®é¢˜ + project-why   â”‚    â”‚
â”‚  â”‚ + æŒä¹…åŒ– + ç‰¹æ®Šæ ¼å¼æ ‡æ³¨         â”‚     â”‚ + é˜¶æ®µé—¨æ§               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                       â†“                      â”‚
â”‚  Gate 1.4: Git é›†æˆ                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è‡ªåŠ¨åˆ†æ”¯åˆ›å»º + Gate commit + commit message è§„èŒƒ                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Gate 1.5: ä»»åŠ¡ç®¡ç†å¢å¼º                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ switch-task + new-task + view-task + UserPromptSubmit Hook          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Gate 1.6: å†…å®¹åŒæ­¥                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ WebSocket + è½®è¯¢æ··åˆåˆ·æ–° + æ ‡æ³¨çŠ¶æ€ä¿ç•™ + æºç è¡Œå·å…œåº•              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Gate 1.1: Task Viewer åŸºç¡€

### 2.1 ç›®æ ‡

æ„å»º Python HTTP æœåŠ¡å™¨ + HTML/CSS/JS å‰ç«¯ï¼Œæ”¯æŒ Markdown æ¸²æŸ“ (marked.js) å’Œ Mermaid æ¸²æŸ“ (mermaid.js)ï¼Œä¸ºæ ‡æ³¨ç³»ç»Ÿæä¾›å¯è§†åŒ–åŸºç¡€ã€‚

### 2.2 äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | è·¯å¾„ | è¯´æ˜ |
|--------|------|------|
| HTTP æœåŠ¡å™¨ | `.claude/hooks/lib/task_viewer.py` | Python http.server å°è£… |
| HTML æ¨¡æ¿ | `.claude/hooks/lib/viewer_template.html` | å‰ç«¯é¡µé¢æ¨¡æ¿ |
| ç”Ÿæˆè„šæœ¬ | `.claude/hooks/lib/viewer_generator.py` | ç”Ÿæˆ .task-viewer.html |
| å¯åŠ¨å…¥å£ | `.claude/hooks/rigid-view-task.sh` | å¯åŠ¨ Task Viewer çš„ Shell å…¥å£ |

### 2.3 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Task Viewer æ¶æ„                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æµè§ˆå™¨å‰ç«¯                                         â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚  HTML5 ç»“æ„    â”‚  â”‚  CSS3 æ ·å¼     â”‚  â”‚  JavaScript    â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  - å¯¼èˆªæ       â”‚  â”‚  - å“åº”å¼å¸ƒå±€  â”‚  â”‚  - marked.js   â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  - å†…å®¹åŒº      â”‚  â”‚  - ä»£ç é«˜äº®    â”‚  â”‚  - mermaid.js  â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  - ä¾§è¾¹æ       â”‚  â”‚  - æš—è‰²ä¸»é¢˜    â”‚  â”‚  - æ–‡ä»¶åˆ‡æ¢    â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†• HTTP                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Python åç«¯ (TaskViewerServer)                     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚  HTTP æœåŠ¡     â”‚  â”‚  ç«¯å£ç®¡ç†      â”‚  â”‚  æ–‡ä»¶ç›‘æ§      â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  http.server   â”‚  â”‚  åŠ¨æ€åˆ†é…      â”‚  â”‚  mtime æ£€æµ‹    â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  + API è·¯ç”±    â”‚  â”‚  ä» 8765 èµ·    â”‚  â”‚  å˜æ›´é€šçŸ¥      â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  è‡ªåŠ¨å…³é—­: 30 åˆ†é’Ÿè¶…æ—¶ + æµè§ˆå™¨å…³é—­ç›‘å¬                        â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†• æ–‡ä»¶ç³»ç»Ÿ                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  tasks/t1-2026-02-25-xxx/                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ research.md                                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ plan.md                                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ code_review.md                                                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€ .task-viewer.html  (ç”Ÿæˆçš„é™æ€é¡µé¢)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/task_viewer.py

import os
import json
import socket
import threading
from http.server import HTTPServer, SimpleHTTPRequestHandler
from typing import Optional
from datetime import datetime

class TaskViewerServer:
    """Task Viewer HTTP æœåŠ¡å™¨"""

    DEFAULT_PORT = 8765
    AUTO_CLOSE_TIMEOUT = 1800  # 30 åˆ†é’Ÿ

    def __init__(self, task_path: str):
        self.task_path = task_path
        self.port: Optional[int] = None
        self.server: Optional[HTTPServer] = None
        self._shutdown_timer: Optional[threading.Timer] = None

    def start_server(self, task_path: Optional[str] = None) -> int:
        """
        å¯åŠ¨ HTTP æœåŠ¡å™¨

        Args:
            task_path: ä»»åŠ¡æ–‡ä»¶å¤¹è·¯å¾„ (å¯é€‰ï¼Œè¦†ç›–åˆå§‹åŒ–æ—¶çš„è·¯å¾„)

        Returns:
            åˆ†é…çš„ç«¯å£å·
        """
        pass

    def stop_server(self) -> None:
        """åœæ­¢æœåŠ¡å™¨å¹¶æ¸…ç†èµ„æº"""
        pass

    def generate_html(self, task_path: Optional[str] = None) -> str:
        """
        ç”Ÿæˆ .task-viewer.html é™æ€é¡µé¢

        Args:
            task_path: ä»»åŠ¡æ–‡ä»¶å¤¹è·¯å¾„

        Returns:
            ç”Ÿæˆçš„ HTML æ–‡ä»¶è·¯å¾„
        """
        pass

    def _find_available_port(self) -> int:
        """ä» DEFAULT_PORT å¼€å§‹æŸ¥æ‰¾å¯ç”¨ç«¯å£"""
        port = self.DEFAULT_PORT
        while port < self.DEFAULT_PORT + 100:
            try:
                with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                    s.bind(('localhost', port))
                    return port
            except OSError:
                port += 1
        raise RuntimeError("æ— æ³•æ‰¾åˆ°å¯ç”¨ç«¯å£")

    def _setup_auto_close(self) -> None:
        """è®¾ç½®è‡ªåŠ¨å…³é—­å®šæ—¶å™¨ (30 åˆ†é’Ÿè¶…æ—¶)"""
        if self._shutdown_timer:
            self._shutdown_timer.cancel()
        self._shutdown_timer = threading.Timer(
            self.AUTO_CLOSE_TIMEOUT, self.stop_server
        )
        self._shutdown_timer.daemon = True
        self._shutdown_timer.start()

    def _reset_auto_close(self) -> None:
        """é‡ç½®è‡ªåŠ¨å…³é—­å®šæ—¶å™¨ (æ”¶åˆ°è¯·æ±‚æ—¶è°ƒç”¨)"""
        self._setup_auto_close()
```

### 2.5 å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | å¼•å…¥æ–¹å¼ | ç”¨é€” |
|------|------|----------|------|
| marked.js | v11.0+ | CDN (`cdn.jsdelivr.net`) | Markdown â†’ HTML æ¸²æŸ“ |
| mermaid.js | v10.0+ | CDN (`cdn.jsdelivr.net`) | Mermaid å›¾è¡¨æ¸²æŸ“ |
| HTML5 | - | åŸç”Ÿ | é¡µé¢ç»“æ„ |
| CSS3 | - | å†…è” | æ ·å¼å’Œå¸ƒå±€ |
| JavaScript | ES6+ | å†…è” | äº¤äº’é€»è¾‘ |

### 2.6 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 1.1.1 | å®ç° `TaskViewerServer` ç±»éª¨æ¶ | `task_viewer.py` | ç±»å¯å®ä¾‹åŒ– |
| 1.1.2 | å®ç°åŠ¨æ€ç«¯å£åˆ†é… `_find_available_port()` | `task_viewer.py` | ç«¯å£å†²çªæ—¶è‡ªåŠ¨é€’å¢ |
| 1.1.3 | å®ç° HTTP æœåŠ¡å™¨å¯åŠ¨/åœæ­¢ | `task_viewer.py` | æµè§ˆå™¨å¯è®¿é—® |
| 1.1.4 | å®ç°è‡ªåŠ¨å…³é—­æœºåˆ¶ | `task_viewer.py` | 30 åˆ†é’Ÿæ— è¯·æ±‚è‡ªåŠ¨å…³é—­ |
| 1.1.5 | ç¼–å†™ HTML æ¨¡æ¿ (marked.js + mermaid.js) | `viewer_template.html` | Markdown/Mermaid æ­£ç¡®æ¸²æŸ“ |
| 1.1.6 | å®ç° `generate_html()` é™æ€é¡µé¢ç”Ÿæˆ | `viewer_generator.py` | ç”Ÿæˆå¯ç¦»çº¿æŸ¥çœ‹çš„ HTML |
| 1.1.7 | å®ç°æ–‡ä»¶åˆ‡æ¢ (research/plan/code_review) | `viewer_template.html` | ä¾§è¾¹æ åˆ‡æ¢æ–‡ä»¶ |
| 1.1.8 | ç¼–å†™å¯åŠ¨è„šæœ¬ | `rigid-view-task.sh` | å‘½ä»¤è¡Œå¯åŠ¨ Task Viewer |
| 1.1.9 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_task_viewer.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 2.7 Gate å®Œæˆæ¡ä»¶

- [ ] `TaskViewerServer` èƒ½å¯åŠ¨ HTTP æœåŠ¡å™¨å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
- [ ] åŠ¨æ€ç«¯å£åˆ†é…æ­£å¸¸å·¥ä½œ (ä» 8765 å¼€å§‹)
- [ ] Markdown å†…å®¹é€šè¿‡ marked.js æ­£ç¡®æ¸²æŸ“
- [ ] Mermaid å›¾è¡¨é€šè¿‡ mermaid.js æ­£ç¡®æ¸²æŸ“
- [ ] æ–‡ä»¶åˆ‡æ¢ (research.md / plan.md / code_review.md) æ­£å¸¸å·¥ä½œ
- [ ] `generate_html()` èƒ½ç”Ÿæˆå¯ç¦»çº¿æŸ¥çœ‹çš„ .task-viewer.html
- [ ] 30 åˆ†é’Ÿæ— è¯·æ±‚è‡ªåŠ¨å…³é—­æœåŠ¡å™¨
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 3. Gate 1.2: æ ‡æ³¨ç³»ç»Ÿ

### 3.1 ç›®æ ‡

å®ç°é™„ç€å¼æ ‡æ³¨ç³»ç»Ÿï¼Œæ”¯æŒå³é”®åˆ›å»ºã€å·¦é”®æŸ¥çœ‹ã€çŠ¶æ€æµè½¬ã€æŒä¹…åŒ–å­˜å‚¨ï¼Œå°†æ ‡æ³¨æ•°æ®å†™å…¥ Markdown æ–‡ä»¶çš„ `## 8. Review Comments` èŠ‚ã€‚

### 3.2 äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | è·¯å¾„ | è¯´æ˜ |
|--------|------|------|
| æ ‡æ³¨ç®¡ç†å™¨ | `.claude/hooks/lib/annotation_manager.py` | æ ‡æ³¨ CRUD + çŠ¶æ€æµè½¬ |
| å‰ç«¯æ ‡æ³¨æ¨¡å— | `viewer_template.html` (å†…åµŒ) | æ ‡æ³¨ UI äº¤äº’é€»è¾‘ |
| æ ‡æ³¨ API | `task_viewer.py` (æ‰©å±•) | æ ‡æ³¨è¯»å†™ API ç«¯ç‚¹ |
| æ ‡æ³¨æ ·å¼ | `viewer_template.html` (å†…åµŒ) | æ ‡è®°ç‚¹ + æ‚¬æµ®æ¡†æ ·å¼ |

### 3.3 æ ‡æ³¨äº¤äº’è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ‡æ³¨äº¤äº’æµç¨‹                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â‘  å³é”®ç‚¹å‡»è¡Œ â†’ åˆ›å»ºæ ‡æ³¨                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç”¨æˆ·å³é”®ç‚¹å‡»æŸè¡Œå†…å®¹                                                 â”‚   â”‚
â”‚  â”‚         â”‚                                                            â”‚   â”‚
â”‚  â”‚         â–¼                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚   â”‚
â”‚  â”‚  â”‚ é«˜äº®è¯¥è¡Œ     â”‚                                                   â”‚   â”‚
â”‚  â”‚  â”‚ (é»„è‰²èƒŒæ™¯)   â”‚                                                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚   â”‚
â”‚  â”‚         â–¼                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚   â”‚
â”‚  â”‚  â”‚ å¼¹å‡ºæ–°å»ºæ ‡æ³¨æ¡†                        â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ä¸¥é‡ç¨‹åº¦: [CRITICAL|MAJOR|MINOR] â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ æ ‡æ³¨å†…å®¹: [æ–‡æœ¬è¾“å…¥æ¡†]           â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ [ä¿å­˜]  [å–æ¶ˆ]                   â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â‘¡ å·¦é”®ç‚¹å‡»æ ‡è®°ç‚¹ â†’ æŸ¥çœ‹/ç¼–è¾‘æ ‡æ³¨                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç”¨æˆ·å·¦é”®ç‚¹å‡»è¡Œæ—æ ‡è®°ç‚¹ (ğŸ”´/ğŸŸ¡/ğŸŸ¢)                                   â”‚   â”‚
â”‚  â”‚         â”‚                                                            â”‚   â”‚
â”‚  â”‚         â–¼                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚   â”‚
â”‚  â”‚  â”‚ å¼¹å‡ºæ ‡æ³¨è¯¦æƒ…æ¡†                        â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ RC-1: [MAJOR] å˜é‡å‘½åä¸è§„èŒƒ    â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ çŠ¶æ€: pending â†’ [addressed â–¼]   â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ è¿½é—®å†å²:                        â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ğŸ‘¤ äººç±»: è¿™é‡Œä¸ºä»€ä¹ˆç”¨ç¼©å†™?      â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ğŸ¤– Agent: å·²ä¿®æ”¹ä¸ºå®Œæ•´å‘½å      â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ [è¿½é—®]  [æ ‡è®°å·²å¤„ç†]  [å…³é—­]     â”‚ â”‚                           â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â‘¢ æ‚¬åœæ ‡è®°ç‚¹ â†’ æ‘˜è¦é¢„è§ˆ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  é¼ æ ‡æ‚¬åœåœ¨æ ‡è®°ç‚¹ä¸Š                                                   â”‚   â”‚
â”‚  â”‚         â”‚                                                            â”‚   â”‚
â”‚  â”‚         â–¼                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚   â”‚
â”‚  â”‚  â”‚ RC-1 [MAJOR] pending    â”‚  â† è½»é‡çº§ tooltip                     â”‚   â”‚
â”‚  â”‚  â”‚ "å˜é‡å‘½åä¸è§„èŒƒ"         â”‚                                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æ ‡æ³¨æ•°æ®ç»“æ„

æ ‡æ³¨æ•°æ®å­˜å‚¨åœ¨ Markdown æ–‡ä»¶çš„ `## 8. Review Comments` èŠ‚ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹:

```markdown
## 8. Review Comments

### RC-1: å˜é‡å‘½åä¸è§„èŒƒ

- **ä¸¥é‡ç¨‹åº¦**: ğŸŸ  MAJOR
- **çŠ¶æ€**: pending
- **å®šä½**: line:42
- **åˆ›å»ºè€…**: ğŸ‘¤ äººç±»
- **åˆ›å»ºæ—¶é—´**: 2026-02-25 14:30

**æ ‡æ³¨å†…å®¹**:
è¿™é‡Œçš„å˜é‡å `tmp` ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼Œå»ºè®®æ”¹ä¸º `user_session`ã€‚

**è¿½é—®å†å²**:
- ğŸ¤– Agent (2026-02-25 14:35): å·²å°† `tmp` é‡å‘½åä¸º `user_session`ï¼ŒåŒæ—¶æ›´æ–°äº†æ‰€æœ‰å¼•ç”¨ã€‚
- ğŸ‘¤ äººç±» (2026-02-25 14:40): ç¡®è®¤ï¼Œæ ‡è®°ä¸ºå·²å¤„ç†ã€‚
```

```python
# .claude/hooks/lib/annotation_manager.py

import re
import os
from dataclasses import dataclass, field
from typing import List, Optional, Dict
from enum import Enum
from datetime import datetime

class AnnotationSeverity(Enum):
    CRITICAL = "CRITICAL"   # ğŸš¨ è‡´å‘½ - é˜»å¡ + å¯èƒ½ Revert
    MAJOR = "MAJOR"         # âš ï¸ ä¸¥é‡ - é˜»å¡
    MINOR = "MINOR"         # ğŸ“ æ¬¡è¦ - ä¸é˜»å¡
    SUGGEST = "SUGGEST"     # ğŸ’¡ å»ºè®® - ä¸é˜»å¡

class AnnotationStatus(Enum):
    PENDING = "pending"                         # å¾…å¤„ç†
    PENDING_AI_QUESTION = "pending_ai_question" # AI è¿½é—®ä¸­
    PENDING_USER_CLARIFY = "pending_user_clarify"  # ç­‰å¾…ç”¨æˆ·æ¾„æ¸…
    ADDRESSED = "addressed"                     # å·²å¤„ç†
    WONT_FIX = "wont_fix"                       # ä¸ä¿®å¤

class AnnotationLocationType(Enum):
    LINE = "line"                   # æ™®é€šè¡Œ
    CODE_BLOCK = "code_block"       # ä»£ç å—
    MERMAID_BLOCK = "mermaid_block" # Mermaid å›¾è¡¨å—
    TABLE_ROW = "table_row"         # è¡¨æ ¼è¡Œ

@dataclass
class AnnotationLocation:
    type: AnnotationLocationType
    line: int                       # èµ·å§‹è¡Œå·
    end_line: Optional[int] = None  # ç»“æŸè¡Œå· (å—çº§æ ‡æ³¨)
    block_id: Optional[str] = None  # å—æ ‡è¯†ç¬¦

@dataclass
class AnnotationEntry:
    rc_id: str                      # RC-1, RC-2, ...
    severity: AnnotationSeverity
    status: AnnotationStatus
    location: AnnotationLocation
    content: str                    # æ ‡æ³¨å†…å®¹
    creator: str                    # "human" | "agent"
    created_at: str                 # ISO 8601
    history: List[Dict] = field(default_factory=list)

class AnnotationManager:
    """æ ‡æ³¨ç®¡ç†å™¨: CRUD + çŠ¶æ€æµè½¬ + æŒä¹…åŒ–"""

    def __init__(self, file_path: str):
        self.file_path = file_path

    def create_annotation(self, severity: AnnotationSeverity,
                          location: AnnotationLocation,
                          content: str, creator: str) -> AnnotationEntry:
        """åˆ›å»ºæ–°æ ‡æ³¨å¹¶å†™å…¥ MD æ–‡ä»¶"""
        pass

    def get_annotation(self, rc_id: str) -> Optional[AnnotationEntry]:
        """è¯»å–æŒ‡å®šæ ‡æ³¨"""
        pass

    def list_annotations(self, status: Optional[AnnotationStatus] = None
                         ) -> List[AnnotationEntry]:
        """åˆ—å‡ºæ ‡æ³¨ (å¯æŒ‰çŠ¶æ€è¿‡æ»¤)"""
        pass

    def update_status(self, rc_id: str,
                      new_status: AnnotationStatus) -> bool:
        """æ›´æ–°æ ‡æ³¨çŠ¶æ€"""
        pass

    def add_reply(self, rc_id: str, reply: str,
                  author: str) -> bool:
        """æ·»åŠ è¿½é—®/å›å¤"""
        pass

    def _next_rc_id(self) -> str:
        """åˆ†é…ä¸‹ä¸€ä¸ª RC ID (RC-1, RC-2, ...)"""
        pass

    def _parse_review_comments(self) -> List[AnnotationEntry]:
        """è§£æ MD æ–‡ä»¶ä¸­çš„ Review Comments èŠ‚"""
        pass

    def _write_review_comments(self,
                               annotations: List[AnnotationEntry]) -> None:
        """å°†æ ‡æ³¨å†™å› MD æ–‡ä»¶çš„ Review Comments èŠ‚"""
        pass
```

### 3.5 æ ‡æ³¨çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ‡æ³¨çŠ¶æ€æµè½¬å›¾                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                    â”‚   pending    â”‚ â† åˆå§‹çŠ¶æ€ (äººç±»åˆ›å»ºæ ‡æ³¨)                â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                           â”‚                                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚              â”‚            â”‚            â”‚                                    â”‚
â”‚              â–¼            â–¼            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ pending_ai_   â”‚ â”‚addressed â”‚ â”‚ wont_fix â”‚                              â”‚
â”‚  â”‚ question      â”‚ â”‚          â”‚ â”‚          â”‚                              â”‚
â”‚  â”‚ (Agent è¿½é—®)  â”‚ â”‚ (å·²å¤„ç†) â”‚ â”‚ (ä¸ä¿®å¤) â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚ pending_user_ â”‚                                                         â”‚
â”‚  â”‚ clarify       â”‚                                                         â”‚
â”‚  â”‚ (ç­‰å¾…ç”¨æˆ·)    â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚          â”‚                                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                            â”‚
â”‚     â”‚         â”‚                                                            â”‚
â”‚     â–¼         â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚pendingâ”‚ â”‚addressed â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                              â”‚
â”‚  é˜»å¡è§„åˆ™:                                                                  â”‚
â”‚  - CRITICAL + pending/pending_ai_question/pending_user_clarify â†’ é˜»å¡      â”‚
â”‚  - MAJOR + pending/pending_ai_question/pending_user_clarify â†’ é˜»å¡         â”‚
â”‚  - MINOR/SUGGEST â†’ ä¸é˜»å¡                                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 Markdown ç‰¹æ®Šæ ¼å¼æ ‡æ³¨

| æ ¼å¼ç±»å‹ | å®šä½æ–¹å¼ | æ ‡æ³¨è¡Œä¸º | ç¤ºä¾‹ |
|----------|----------|----------|------|
| æ™®é€šæ–‡æœ¬è¡Œ | `line:42` | æ ‡æ³¨é™„ç€åœ¨è¯¥è¡Œ | å•è¡Œæ ‡æ³¨ |
| ä»£ç å— | `code_block:15-25` | æ ‡æ³¨é™„ç€åœ¨æ•´ä¸ªä»£ç å— | ä»£ç å—çº§æ ‡æ³¨ |
| Mermaid å›¾è¡¨ | `mermaid_block:30-45` | æ ‡æ³¨é™„ç€åœ¨æ•´ä¸ª Mermaid å— | å›¾è¡¨çº§æ ‡æ³¨ |
| è¡¨æ ¼è¡Œ | `table_row:50` | æ ‡æ³¨é™„ç€åœ¨è¡¨æ ¼æŸè¡Œ | è¡¨æ ¼è¡Œæ ‡æ³¨ |

### 3.7 æ¸²æŸ“/æºç è§†å›¾åˆ‡æ¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è§†å›¾åˆ‡æ¢æœºåˆ¶                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [æ¸²æŸ“è§†å›¾]  [æºç è§†å›¾]  â† åˆ‡æ¢æŒ‰é’®                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  æ¸²æŸ“è§†å›¾ (é»˜è®¤):                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  marked.js æ¸²æŸ“åçš„ HTML                                             â”‚   â”‚
â”‚  â”‚  - æ ‡æ³¨æ ‡è®°ç‚¹é™„ç€åœ¨æ¸²æŸ“åçš„è¡Œæ—                                       â”‚   â”‚
â”‚  â”‚  - Mermaid å›¾è¡¨å·²æ¸²æŸ“ä¸º SVG                                          â”‚   â”‚
â”‚  â”‚  - è¡¨æ ¼å·²æ¸²æŸ“ä¸º HTML table                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  æºç è§†å›¾:                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  åŸå§‹ Markdown æºç  (å¸¦è¡Œå·)                                         â”‚   â”‚
â”‚  â”‚  - æ ‡æ³¨æ ‡è®°ç‚¹é™„ç€åœ¨æºç è¡Œå·æ—                                         â”‚   â”‚
â”‚  â”‚  - è¡Œå·ä¸æ ‡æ³¨å®šä½ç²¾ç¡®å¯¹åº”                                             â”‚   â”‚
â”‚  â”‚  - æ”¯æŒç›´æ¥ç¼–è¾‘ (æœªæ¥æ‰©å±•)                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  åˆ‡æ¢æ—¶ä¿ç•™:                                                                â”‚
â”‚  - å½“å‰æ‰“å¼€çš„æ ‡æ³¨æ¡†çŠ¶æ€                                                     â”‚
â”‚  - æ»šåŠ¨ä½ç½® (å°½é‡ä¿æŒ)                                                      â”‚
â”‚  - æ ‡æ³¨æ ‡è®°ç‚¹çš„æ˜¾ç¤º/éšè—çŠ¶æ€                                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.8 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 1.2.1 | å®ç° `AnnotationManager` ç±»éª¨æ¶ | `annotation_manager.py` | ç±»å¯å®ä¾‹åŒ– |
| 1.2.2 | å®ç° `_parse_review_comments()` | `annotation_manager.py` | æ­£ç¡®è§£æ RC å— |
| 1.2.3 | å®ç° `create_annotation()` | `annotation_manager.py` | å†™å…¥ MD æ–‡ä»¶ |
| 1.2.4 | å®ç° `update_status()` + `add_reply()` | `annotation_manager.py` | çŠ¶æ€æµè½¬æ­£ç¡® |
| 1.2.5 | å®ç°å‰ç«¯å³é”®åˆ›å»ºæ ‡æ³¨ UI | `viewer_template.html` | å³é”®å¼¹å‡ºæ ‡æ³¨æ¡† |
| 1.2.6 | å®ç°å‰ç«¯å·¦é”®æŸ¥çœ‹æ ‡æ³¨ UI | `viewer_template.html` | å·¦é”®å¼¹å‡ºè¯¦æƒ…æ¡† |
| 1.2.7 | å®ç°æ‚¬åœé¢„è§ˆ tooltip | `viewer_template.html` | æ‚¬åœæ˜¾ç¤ºæ‘˜è¦ |
| 1.2.8 | å®ç°æ ‡æ³¨ API ç«¯ç‚¹ | `task_viewer.py` | CRUD API å¯ç”¨ |
| 1.2.9 | å®ç°æ¸²æŸ“/æºç è§†å›¾åˆ‡æ¢ | `viewer_template.html` | åˆ‡æ¢ä¿ç•™æ ‡æ³¨çŠ¶æ€ |
| 1.2.10 | å®ç°å—çº§æ ‡æ³¨ (ä»£ç å—/Mermaid/è¡¨æ ¼) | `annotation_manager.py` | å—çº§å®šä½æ­£ç¡® |
| 1.2.11 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_annotation.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 3.9 Gate å®Œæˆæ¡ä»¶

- [ ] å³é”®ç‚¹å‡»è¡Œèƒ½åˆ›å»ºæ ‡æ³¨å¹¶å†™å…¥ MD æ–‡ä»¶
- [ ] å·¦é”®ç‚¹å‡»æ ‡è®°ç‚¹èƒ½æŸ¥çœ‹æ ‡æ³¨å†å²å’Œè¿½é—®
- [ ] æ‚¬åœæ ‡è®°ç‚¹æ˜¾ç¤ºæ‘˜è¦é¢„è§ˆ
- [ ] æ ‡æ³¨çŠ¶æ€æµè½¬ (pending â†’ addressed / wont_fix / pending_ai_question) æ­£å¸¸
- [ ] æ ‡æ³¨æ•°æ®æŒä¹…åŒ–åœ¨ MD æ–‡ä»¶çš„ Review Comments èŠ‚
- [ ] ä»£ç å—ã€Mermaid å—ã€è¡¨æ ¼è¡Œçš„å—çº§æ ‡æ³¨æ­£å¸¸å·¥ä½œ
- [ ] æ¸²æŸ“/æºç è§†å›¾åˆ‡æ¢ä¿ç•™æ ‡æ³¨æ¡†çŠ¶æ€
- [ ] æ ‡æ³¨ API ç«¯ç‚¹ (CRUD) æ­£å¸¸å·¥ä½œ
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 4. Gate 1.3: Why-First å¼•æ“

### 4.1 ç›®æ ‡

å®ç° Why-First é˜¶æ®µï¼Œå¼ºåˆ¶ Agent åœ¨å¼€å§‹ä»»åŠ¡å‰æ·±åº¦æ€è€ƒ"ä¸ºä»€ä¹ˆ"ï¼Œç”Ÿæˆé’ˆå¯¹æ€§ Why é—®é¢˜ï¼ŒéªŒè¯å›ç­”è´¨é‡ï¼Œå¹¶ç»´æŠ¤ `project-why.md` çŸ¥è¯†åº“ã€‚

### 4.2 äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | è·¯å¾„ | è¯´æ˜ |
|--------|------|------|
| Why-First å¼•æ“ | `.claude/hooks/lib/why_first_engine.py` | é—®é¢˜ç”Ÿæˆ + å›ç­”éªŒè¯ |
| project-why ç®¡ç† | `.claude/hooks/lib/project_why_manager.py` | çŸ¥è¯†åº“è¯»å†™ |
| Stop Hook æ‰©å±• | `nomos-stop.sh` (ä¿®æ”¹) | å¢åŠ  Why-First é˜¶æ®µæ£€æŸ¥ |
| project-why æ¨¡æ¿ | `project-why.md` (æ›´æ–°) | çŸ¥è¯†åº“åˆå§‹ç»“æ„ |

### 4.3 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Why-First å¼•æ“æ¶æ„                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ä»»åŠ¡å¯åŠ¨                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ /nomos:start <task_name>                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    WhyFirstEngine                                     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ 1. è¯»å–ä¸Šä¸‹æ–‡  â”‚ â”€â”€â–º â”‚ 2. ç”Ÿæˆ Why    â”‚ â”€â”€â–º â”‚ 3. éªŒè¯å›ç­”   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - task_context â”‚     â”‚    é—®é¢˜åˆ—è¡¨     â”‚     â”‚    è´¨é‡        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - project-why  â”‚     â”‚ - ä¸šåŠ¡ç›®æ ‡      â”‚     â”‚ - æ·±åº¦æ£€æŸ¥    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - å†å²æ•™è®­     â”‚     â”‚ - æŠ€æœ¯é€‰å‹      â”‚     â”‚ - å®Œæ•´æ€§æ£€æŸ¥  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ - é£é™©è¯„ä¼°      â”‚     â”‚ - ä¸€è‡´æ€§æ£€æŸ¥  â”‚   â”‚   â”‚
â”‚  â”‚                         â”‚ - ç”¨æˆ·å½±å“      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚   â”‚
â”‚  â”‚                                                          â”‚           â”‚   â”‚
â”‚  â”‚                                                          â–¼           â”‚   â”‚
â”‚  â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚                                              â”‚ 4. æ›´æ–°        â”‚     â”‚   â”‚
â”‚  â”‚                                              â”‚ project-why.md â”‚     â”‚   â”‚
â”‚  â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  Stop Hook æ£€æŸ¥: Why-First æ˜¯å¦å®Œæˆ?                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ… æ‰€æœ‰ Why é—®é¢˜å·²å›ç­” + è´¨é‡é€šè¿‡ â†’ å…è®¸è¿›å…¥ Research é˜¶æ®µ          â”‚   â”‚
â”‚  â”‚  âŒ æœªå®Œæˆ â†’ é˜»å¡ï¼Œæç¤ºå®Œæˆ Why-First                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/why_first_engine.py

import os
import json
from typing import List, Dict, Optional
from dataclasses import dataclass, field

@dataclass
class WhyQuestion:
    id: str                 # WQ-1, WQ-2, ...
    category: str           # business / technical / risk / user_impact
    question: str           # é—®é¢˜å†…å®¹
    answer: Optional[str] = None
    quality_score: float = 0.0  # 0.0 - 1.0

@dataclass
class WhyFirstResult:
    completed: bool
    questions: List[WhyQuestion]
    overall_score: float    # 0.0 - 1.0
    missing_categories: List[str] = field(default_factory=list)

class WhyFirstEngine:
    """Why-First å¼•æ“: å¼ºåˆ¶æ·±åº¦æ€è€ƒ"""

    REQUIRED_CATEGORIES = [
        "business",      # ä¸šåŠ¡ç›®æ ‡: ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªåŠŸèƒ½?
        "technical",     # æŠ€æœ¯é€‰å‹: ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆ?
        "risk",          # é£é™©è¯„ä¼°: å¯èƒ½å‡ºä»€ä¹ˆé—®é¢˜?
        "user_impact"    # ç”¨æˆ·å½±å“: å¯¹ç”¨æˆ·æœ‰ä»€ä¹ˆå½±å“?
    ]

    QUALITY_THRESHOLD = 0.6  # å›ç­”è´¨é‡é˜ˆå€¼

    def __init__(self, project_why_path: str = "project-why.md"):
        self.project_why_path = project_why_path

    def generate_questions(self, task_context: Dict) -> List[WhyQuestion]:
        """
        æ ¹æ®ä»»åŠ¡ä¸Šä¸‹æ–‡ç”Ÿæˆé’ˆå¯¹æ€§ Why é—®é¢˜

        Args:
            task_context: åŒ…å« task_name, task_type, description ç­‰

        Returns:
            WhyQuestion åˆ—è¡¨ (æ¯ä¸ªç±»åˆ«è‡³å°‘ 1 ä¸ªé—®é¢˜)
        """
        pass

    def validate_answers(self, questions: List[WhyQuestion]
                         ) -> WhyFirstResult:
        """
        éªŒè¯å›ç­”è´¨é‡

        æ£€æŸ¥é¡¹:
        1. æ‰€æœ‰å¿…éœ€ç±»åˆ«éƒ½æœ‰å›ç­”
        2. å›ç­”é•¿åº¦ >= 50 å­—ç¬¦
        3. å›ç­”ä¸æ˜¯æ¨¡æ¿/å ä½ç¬¦
        4. ä¸ project-why.md ä¸­å·²æœ‰çŸ¥è¯†ä¸çŸ›ç›¾

        Returns:
            WhyFirstResult
        """
        pass

    def update_project_why(self, new_knowledge: Dict) -> bool:
        """
        å°†æ–°çš„ Why çŸ¥è¯†å†™å…¥ project-why.md

        Args:
            new_knowledge: {category: str, content: str, task_id: str}

        Returns:
            æ˜¯å¦æˆåŠŸæ›´æ–°
        """
        pass

    def load_existing_knowledge(self) -> Dict[str, List[str]]:
        """ä» project-why.md åŠ è½½å·²æœ‰çŸ¥è¯†"""
        pass

    def check_why_first_completed(self, task_path: str) -> bool:
        """
        æ£€æŸ¥æŒ‡å®šä»»åŠ¡çš„ Why-First æ˜¯å¦å®Œæˆ
        (ä¾› Stop Hook è°ƒç”¨)
        """
        pass
```

### 4.5 project-why.md çŸ¥è¯†åº“ç»“æ„

```markdown
---
version: 1
last_updated: 2026-02-25
entries_count: 0
---

# Project Why - é¡¹ç›®çŸ¥è¯†åº“

æœ¬æ–‡ä»¶è®°å½•é¡¹ç›®ä¸­ç§¯ç´¯çš„"ä¸ºä»€ä¹ˆ"çŸ¥è¯†ï¼Œå¸®åŠ© Agent é¿å…é‡å¤çŠ¯é”™ã€‚

## 1. ä¸šåŠ¡çŸ¥è¯† (Business)

<!-- è®°å½•ä¸šåŠ¡ç›®æ ‡ã€ç”¨æˆ·éœ€æ±‚ã€äº§å“å†³ç­–çš„"ä¸ºä»€ä¹ˆ" -->

## 2. æŠ€æœ¯å†³ç­– (Technical)

<!-- è®°å½•æŠ€æœ¯é€‰å‹ã€æ¶æ„å†³ç­–çš„"ä¸ºä»€ä¹ˆ" -->

## 3. æ•™è®­æ€»ç»“ (Lessons Learned)

<!-- è®°å½•å¤±è´¥ç»éªŒã€Revert åŸå› ã€è¸©å‘è®°å½• -->

## 4. é£é™©è®°å½• (Risks)

<!-- è®°å½•å·²è¯†åˆ«çš„é£é™©å’Œåº”å¯¹ç­–ç•¥ -->
```

### 4.6 Why-First é˜¶æ®µé—¨æ§

Stop Hook ä¸­å¢åŠ  Why-First æ£€æŸ¥é€»è¾‘:

```python
# åœ¨ nomos-stop.sh ä¸­å¢åŠ çš„æ£€æŸ¥é€»è¾‘

def check_why_first_gate(task_path: str) -> dict:
    """
    æ£€æŸ¥ Why-First é˜¶æ®µæ˜¯å¦å®Œæˆ

    æ£€æŸ¥æ¡ä»¶:
    1. research.md çš„ YAML Frontmatter ä¸­ why_first_completed: true
    2. æˆ–è€… research.md ä¸­å­˜åœ¨ "## Why-First" èŠ‚ä¸”æ‰€æœ‰é—®é¢˜å·²å›ç­”

    Returns:
        {"passed": bool, "message": str}
    """
    research_path = os.path.join(task_path, "research.md")
    if not os.path.exists(research_path):
        return {"passed": False, "message": "research.md ä¸å­˜åœ¨"}

    with open(research_path, "r") as f:
        content = f.read()

    # æ£€æŸ¥ YAML Frontmatter
    if "why_first_completed: true" in content:
        return {"passed": True, "message": "Why-First å·²å®Œæˆ"}

    # æ£€æŸ¥ Why-First èŠ‚
    if "## Why-First" not in content:
        return {"passed": False,
                "message": "è¯·å…ˆå®Œæˆ Why-First é˜¶æ®µ (å›ç­”ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªä»»åŠ¡)"}

    return {"passed": False,
            "message": "Why-First å›ç­”æœªé€šè¿‡è´¨é‡æ£€æŸ¥"}
```

### 4.7 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 1.3.1 | å®ç° `WhyFirstEngine` ç±»éª¨æ¶ | `why_first_engine.py` | ç±»å¯å®ä¾‹åŒ– |
| 1.3.2 | å®ç° `generate_questions()` | `why_first_engine.py` | ç”Ÿæˆ 4 ç±» Why é—®é¢˜ |
| 1.3.3 | å®ç° `validate_answers()` | `why_first_engine.py` | è´¨é‡æ£€æŸ¥é€šè¿‡/å¤±è´¥ |
| 1.3.4 | å®ç° `update_project_why()` | `project_why_manager.py` | çŸ¥è¯†å†™å…¥ MD æ–‡ä»¶ |
| 1.3.5 | å®ç° `load_existing_knowledge()` | `project_why_manager.py` | æ­£ç¡®è§£æå·²æœ‰çŸ¥è¯† |
| 1.3.6 | æ‰©å±• Stop Hook å¢åŠ  Why-First æ£€æŸ¥ | `nomos-stop.sh` | æœªå®Œæˆæ—¶é˜»å¡ |
| 1.3.7 | æ›´æ–° research.md æ¨¡æ¿å¢åŠ  Why-First èŠ‚ | `templates/research.md` | æ¨¡æ¿åŒ…å« Why-First |
| 1.3.8 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_why_first.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 4.8 Gate å®Œæˆæ¡ä»¶

- [ ] `generate_questions()` èƒ½æ ¹æ®ä»»åŠ¡ä¸Šä¸‹æ–‡ç”Ÿæˆ 4 ç±» Why é—®é¢˜
- [ ] `validate_answers()` èƒ½æ£€æŸ¥å›ç­”è´¨é‡ (é•¿åº¦ã€éæ¨¡æ¿ã€ä¸€è‡´æ€§)
- [ ] `update_project_why()` èƒ½å°†æ–°çŸ¥è¯†å†™å…¥ project-why.md
- [ ] Stop Hook èƒ½æ£€æµ‹ Why-First æ˜¯å¦å®Œæˆå¹¶é˜»å¡æœªå®Œæˆçš„ä»»åŠ¡
- [ ] research.md æ¨¡æ¿åŒ…å« Why-First èŠ‚
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 5. Gate 1.4: Git é›†æˆ

### 5.1 ç›®æ ‡

å®ç°è‡ªåŠ¨åˆ†æ”¯åˆ›å»ºã€Gate commitã€commit message è§„èŒƒï¼Œç¡®ä¿æ¯ä¸ªä»»åŠ¡æœ‰ç‹¬ç«‹åˆ†æ”¯ï¼Œæ¯ä¸ª Gate å®Œæˆæ—¶è‡ªåŠ¨æäº¤ã€‚

### 5.2 äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | è·¯å¾„ | è¯´æ˜ |
|--------|------|------|
| Git é›†æˆæ¨¡å— | `.claude/hooks/lib/git_integration.py` | åˆ†æ”¯ç®¡ç† + commit è‡ªåŠ¨åŒ– |
| Stop Hook æ‰©å±• | `nomos-stop.sh` (ä¿®æ”¹) | Gate å®Œæˆæ—¶è§¦å‘ commit |
| commit è§„èŒƒ | æ–‡æ¡£çº¦å®š | commit message æ ¼å¼è§„èŒƒ |

### 5.3 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Git é›†æˆæ¶æ„                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ä»»åŠ¡å¯åŠ¨æ—¶:                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ /nomos:start user-login                                         â”‚   â”‚
â”‚  â”‚         â”‚                                                            â”‚   â”‚
â”‚  â”‚         â–¼                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚   â”‚
â”‚  â”‚  â”‚ create_branch()  â”‚ â†’ git checkout -b feat/t1-2026-02-25-user-loginâ”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Gate å®Œæˆæ—¶:                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent å‹¾é€‰ Gate checkbox                                             â”‚   â”‚
â”‚  â”‚         â”‚                                                            â”‚   â”‚
â”‚  â”‚         â–¼                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚   â”‚
â”‚  â”‚  â”‚ gate_commit()    â”‚ â†’ git add -A && git commit -m "[Gate X.Y] ..." â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  commit message éªŒè¯:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ validate_commit_message()                                            â”‚   â”‚
â”‚  â”‚         â”‚                                                            â”‚   â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                      â”‚   â”‚
â”‚  â”‚    â”‚         â”‚                                                      â”‚   â”‚
â”‚  â”‚    â–¼         â–¼                                                      â”‚   â”‚
â”‚  â”‚  âœ… æ ¼å¼æ­£ç¡®   âŒ æ ¼å¼é”™è¯¯ â†’ è‡ªåŠ¨ä¿®æ­£æˆ–æ‹’ç»                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/git_integration.py

import os
import subprocess
import re
from typing import Optional, Tuple
from dataclasses import dataclass
from datetime import datetime

@dataclass
class BranchInfo:
    name: str           # feat/t1-2026-02-25-user-login
    task_id: str        # t1
    task_name: str      # user-login
    created_at: str     # ISO 8601

class GitIntegration:
    """Git é›†æˆ: åˆ†æ”¯ç®¡ç† + commit è‡ªåŠ¨åŒ–"""

    BRANCH_PREFIX_MAP = {
        "feat": "feat",
        "fix": "fix",
        "refactor": "refactor",
        "test": "test",
        "docs": "docs"
    }

    COMMIT_PATTERN = re.compile(
        r'^\[Gate \d+\.\d+\] .{10,}$'
    )

    def __init__(self, repo_path: str = "."):
        self.repo_path = repo_path

    def create_branch(self, task_info: dict) -> BranchInfo:
        """
        åˆ›å»ºä»»åŠ¡åˆ†æ”¯

        åˆ†æ”¯å‘½å: {type}/{task_id}-{date}-{name}
        ç¤ºä¾‹: feat/t1-2026-02-25-user-login

        Args:
            task_info: {task_id, full_id, task_type, task_name}

        Returns:
            BranchInfo
        """
        pass

    def gate_commit(self, gate_id: str, message: str,
                    files: Optional[list] = None) -> str:
        """
        Gate å®Œæˆæ—¶è‡ªåŠ¨ commit

        commit message æ ¼å¼: [Gate {gate_id}] {message}
        ç¤ºä¾‹: [Gate 1.1] å®Œæˆ Task Viewer åŸºç¡€æ¡†æ¶

        Args:
            gate_id: Gate æ ‡è¯† (å¦‚ "1.1")
            message: commit æè¿°
            files: æŒ‡å®šæ–‡ä»¶åˆ—è¡¨ (None=å…¨éƒ¨)

        Returns:
            commit hash
        """
        pass

    def validate_commit_message(self, message: str) -> Tuple[bool, str]:
        """
        éªŒè¯ commit message æ ¼å¼

        è§„åˆ™:
        1. å¿…é¡»ä»¥ [Gate X.Y] å¼€å¤´
        2. æè¿°éƒ¨åˆ† >= 10 ä¸ªå­—ç¬¦
        3. ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯

        Returns:
            (is_valid, error_message)
        """
        pass

    def get_current_branch(self) -> str:
        """è·å–å½“å‰åˆ†æ”¯å"""
        pass

    def has_uncommitted_changes(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„å˜æ›´"""
        pass

    def _run_git(self, *args) -> str:
        """æ‰§è¡Œ git å‘½ä»¤"""
        result = subprocess.run(
            ["git", *args],
            cwd=self.repo_path,
            capture_output=True,
            text=True,
            check=True
        )
        return result.stdout.strip()
```

### 5.5 åˆ†æ”¯å‘½åè§„èŒƒ

| ä»»åŠ¡ç±»å‹ | åˆ†æ”¯å‰ç¼€ | ç¤ºä¾‹ |
|----------|----------|------|
| åŠŸèƒ½å¼€å‘ | `feat/` | `feat/t1-2026-02-25-user-login` |
| Bug ä¿®å¤ | `fix/` | `fix/t2-2026-02-25-login-crash` |
| é‡æ„ | `refactor/` | `refactor/t3-2026-02-25-auth-module` |
| æµ‹è¯• | `test/` | `test/t4-2026-02-25-unit-tests` |
| æ–‡æ¡£ | `docs/` | `docs/t5-2026-02-25-api-docs` |

### 5.6 commit message è§„èŒƒ

```
æ ¼å¼: [Gate X.Y] <æè¿°>

ç¤ºä¾‹:
  [Gate 1.1] å®Œæˆ Task Viewer HTTP æœåŠ¡å™¨å’Œå‰ç«¯æ¸²æŸ“
  [Gate 1.2] å®ç°æ ‡æ³¨ç³»ç»Ÿ CRUD å’ŒçŠ¶æ€æµè½¬
  [Gate 1.3] å®Œæˆ Why-First å¼•æ“å’Œ project-why ç®¡ç†
  [Gate 1.4] å®ç° Git è‡ªåŠ¨åˆ†æ”¯å’Œ Gate commit

è§„åˆ™:
  1. å¿…é¡»ä»¥ [Gate X.Y] å¼€å¤´
  2. æè¿°éƒ¨åˆ† >= 10 ä¸ªå­—ç¬¦
  3. ä½¿ç”¨ä¸­æ–‡æˆ–è‹±æ–‡æè¿°
  4. ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ (å¯†ç ã€å¯†é’¥ç­‰)
```

### 5.7 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 1.4.1 | å®ç° `GitIntegration` ç±»éª¨æ¶ | `git_integration.py` | ç±»å¯å®ä¾‹åŒ– |
| 1.4.2 | å®ç° `create_branch()` | `git_integration.py` | æ­£ç¡®åˆ›å»ºåˆ†æ”¯ |
| 1.4.3 | å®ç° `gate_commit()` | `git_integration.py` | è‡ªåŠ¨ commit |
| 1.4.4 | å®ç° `validate_commit_message()` | `git_integration.py` | æ ¼å¼éªŒè¯æ­£ç¡® |
| 1.4.5 | æ‰©å±• `/nomos:start` å¢åŠ åˆ†æ”¯åˆ›å»º | `prompts/start.md` | å¯åŠ¨æ—¶åˆ›å»ºåˆ†æ”¯ |
| 1.4.6 | æ‰©å±• Stop Hook å¢åŠ  Gate commit è§¦å‘ | `nomos-stop.sh` | Gate å®Œæˆæ—¶ commit |
| 1.4.7 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_git_integration.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 5.8 Gate å®Œæˆæ¡ä»¶

- [ ] `create_branch()` èƒ½åˆ›å»ºç¬¦åˆå‘½åè§„èŒƒçš„åˆ†æ”¯
- [ ] `gate_commit()` èƒ½åœ¨ Gate å®Œæˆæ—¶è‡ªåŠ¨ commit
- [ ] `validate_commit_message()` èƒ½éªŒè¯ commit message æ ¼å¼
- [ ] `/nomos:start` å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä»»åŠ¡åˆ†æ”¯
- [ ] Stop Hook åœ¨ Gate å®Œæˆæ—¶è§¦å‘è‡ªåŠ¨ commit
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 6. Gate 1.5: ä»»åŠ¡ç®¡ç†å¢å¼º

### 6.1 ç›®æ ‡

å¢å¼ºä»»åŠ¡ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒ `switch-task`ã€`new-task`ã€`view-task` SKILL å‘½ä»¤ï¼Œå®ç° UserPromptSubmit Hook æ™ºèƒ½æ£€æµ‹å’Œä»»åŠ¡ä¸Šä¸‹æ–‡æŒ‰éœ€æ³¨å…¥ã€‚

### 6.2 äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | è·¯å¾„ | è¯´æ˜ |
|--------|------|------|
| switch-task æç¤ºè¯ | `.claude/skills/nomos/prompts/switch-task.md` | åˆ‡æ¢ä»»åŠ¡å‘½ä»¤ |
| new-task æç¤ºè¯ | `.claude/skills/nomos/prompts/new-task.md` | åˆ›å»ºæ–°ä»»åŠ¡å‘½ä»¤ |
| view-task æç¤ºè¯ | `.claude/skills/nomos/prompts/view-task.md` | æŸ¥çœ‹ä»»åŠ¡å‘½ä»¤ |
| UserPromptSubmit Hook | `.claude/hooks/rigid-user-prompt.sh` | æ™ºèƒ½æ£€æµ‹ç”¨æˆ·æ„å›¾ |
| ä¸Šä¸‹æ–‡æ³¨å…¥æ¨¡å— | `.claude/hooks/lib/context_injector.py` | æŒ‰éœ€æ³¨å…¥ä»»åŠ¡ä¸Šä¸‹æ–‡ |
| SKILL å®šä¹‰æ›´æ–° | `.claude/skills/nomos/SKILL.md` (ä¿®æ”¹) | æ–°å¢å‘½ä»¤æ³¨å†Œ |

### 6.3 æ–°å¢ SKILL å‘½ä»¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SKILL å‘½ä»¤æ‰©å±•                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  /nomos:switch-task <task_id>                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŠŸèƒ½: åˆ‡æ¢å½“å‰æ´»è·ƒä»»åŠ¡                                               â”‚   â”‚
â”‚  â”‚ æµç¨‹:                                                                â”‚   â”‚
â”‚  â”‚   1. éªŒè¯ task_id å­˜åœ¨                                               â”‚   â”‚
â”‚  â”‚   2. ä¿å­˜å½“å‰ä»»åŠ¡çŠ¶æ€                                                â”‚   â”‚
â”‚  â”‚   3. æ›´æ–° current-task.txt                                           â”‚   â”‚
â”‚  â”‚   4. åˆ‡æ¢ Git åˆ†æ”¯                                                   â”‚   â”‚
â”‚  â”‚   5. åŠ è½½æ–°ä»»åŠ¡ä¸Šä¸‹æ–‡                                                â”‚   â”‚
â”‚  â”‚   6. æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€é¢æ¿                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  /nomos:new-task <task_name> [--type=feat]                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŠŸèƒ½: åˆ›å»ºæ–°ä»»åŠ¡ (å¢å¼ºç‰ˆ start)                                      â”‚   â”‚
â”‚  â”‚ æµç¨‹:                                                                â”‚   â”‚
â”‚  â”‚   1. è°ƒç”¨ TaskManager.create_task()                                  â”‚   â”‚
â”‚  â”‚   2. åˆ›å»º Git åˆ†æ”¯                                                   â”‚   â”‚
â”‚  â”‚   3. å¯åŠ¨ Why-First é˜¶æ®µ                                            â”‚   â”‚
â”‚  â”‚   4. æ‰“å¼€ Task Viewer                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  /nomos:view-task [task_id]                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŠŸèƒ½: åœ¨ Task Viewer ä¸­æŸ¥çœ‹ä»»åŠ¡                                      â”‚   â”‚
â”‚  â”‚ æµç¨‹:                                                                â”‚   â”‚
â”‚  â”‚   1. ç¡®å®šç›®æ ‡ä»»åŠ¡ (é»˜è®¤å½“å‰ä»»åŠ¡)                                     â”‚   â”‚
â”‚  â”‚   2. å¯åŠ¨ TaskViewerServer                                           â”‚   â”‚
â”‚  â”‚   3. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€                                                  â”‚   â”‚
â”‚  â”‚   4. æ˜¾ç¤ºè®¿é—® URL                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 UserPromptSubmit Hook æ™ºèƒ½æ£€æµ‹

```python
# .claude/hooks/lib/intent_detector.py

import re
from typing import Optional, Dict

class IntentDetector:
    """ç”¨æˆ·æ„å›¾æ£€æµ‹å™¨"""

    # ä»»åŠ¡åˆ‡æ¢æ„å›¾å…³é”®è¯
    SWITCH_PATTERNS = [
        r"åˆ‡æ¢åˆ°?\s*(t\d+|ä»»åŠ¡\s*\d+)",
        r"switch\s+(?:to\s+)?(t\d+)",
        r"æ¢ä¸ªä»»åŠ¡",
        r"å›åˆ°\s*(t\d+)",
    ]

    # æ–°ä»»åŠ¡æ„å›¾å…³é”®è¯
    NEW_TASK_PATTERNS = [
        r"æ–°å»º?\s*ä»»åŠ¡",
        r"å¼€å§‹\s*æ–°\s*ä»»åŠ¡",
        r"new\s+task",
        r"åˆ›å»º\s*ä»»åŠ¡",
    ]

    # æŸ¥çœ‹ä»»åŠ¡æ„å›¾å…³é”®è¯
    VIEW_PATTERNS = [
        r"æŸ¥çœ‹\s*(t\d+|ä»»åŠ¡)",
        r"æ‰“å¼€\s*viewer",
        r"view\s+task",
        r"çœ‹çœ‹\s*(t\d+|è¿›åº¦)",
    ]

    def detect_intent(self, user_prompt: str) -> Optional[Dict]:
        """
        æ£€æµ‹ç”¨æˆ·è¾“å…¥ä¸­çš„ä»»åŠ¡ç®¡ç†æ„å›¾

        Returns:
            None: æ— ç‰¹æ®Šæ„å›¾
            {"intent": "switch_task", "task_id": "t1"}: åˆ‡æ¢ä»»åŠ¡
            {"intent": "new_task", "task_name": "..."}: æ–°å»ºä»»åŠ¡
            {"intent": "view_task", "task_id": "t1"}: æŸ¥çœ‹ä»»åŠ¡
        """
        pass

    def _match_patterns(self, text: str,
                        patterns: list) -> Optional[re.Match]:
        """åŒ¹é…æ¨¡å¼åˆ—è¡¨"""
        for pattern in patterns:
            match = re.search(pattern, text, re.IGNORECASE)
            if match:
                return match
        return None
```

```bash
#!/bin/bash
# .claude/hooks/rigid-user-prompt.sh
# UserPromptSubmit Hook: æ™ºèƒ½æ£€æµ‹ç”¨æˆ·æ„å›¾

set -e

# ä» stdin è¯»å–ç”¨æˆ·è¾“å…¥
USER_PROMPT=$(cat)

# è¿è¡Œæ„å›¾æ£€æµ‹
RESULT=$(python3 -c "
import sys, json
sys.path.insert(0, '.claude/hooks')
from lib.intent_detector import IntentDetector

detector = IntentDetector()
prompt = '''$USER_PROMPT'''
intent = detector.detect_intent(prompt)

if intent:
    # æ³¨å…¥ä¸Šä¸‹æ–‡æç¤º
    if intent['intent'] == 'switch_task':
        msg = f\"æ£€æµ‹åˆ°ä»»åŠ¡åˆ‡æ¢æ„å›¾ã€‚è¯·ä½¿ç”¨ /nomos:switch-task {intent.get('task_id', '')}\"
        print(json.dumps({'message': msg}))
    elif intent['intent'] == 'new_task':
        msg = 'æ£€æµ‹åˆ°æ–°å»ºä»»åŠ¡æ„å›¾ã€‚è¯·ä½¿ç”¨ /nomos:new-task <ä»»åŠ¡å>'
        print(json.dumps({'message': msg}))
    elif intent['intent'] == 'view_task':
        msg = f\"æ£€æµ‹åˆ°æŸ¥çœ‹ä»»åŠ¡æ„å›¾ã€‚è¯·ä½¿ç”¨ /nomos:view-task {intent.get('task_id', '')}\"
        print(json.dumps({'message': msg}))
    else:
        print('{}')
else:
    print('{}')
")

echo "$RESULT"
```

### 6.5 ä»»åŠ¡ä¸Šä¸‹æ–‡æŒ‰éœ€æ³¨å…¥

```python
# .claude/hooks/lib/context_injector.py

import os
from typing import Dict, Optional

class ContextInjector:
    """ä»»åŠ¡ä¸Šä¸‹æ–‡æŒ‰éœ€æ³¨å…¥"""

    # ä¸Šä¸‹æ–‡æ³¨å…¥çº§åˆ«
    LEVEL_MINIMAL = "minimal"   # ä»…ä»»åŠ¡ ID å’ŒçŠ¶æ€
    LEVEL_SUMMARY = "summary"   # æ‘˜è¦ä¿¡æ¯
    LEVEL_FULL = "full"         # å®Œæ•´ä¸Šä¸‹æ–‡

    def __init__(self, task_path: str):
        self.task_path = task_path

    def inject_context(self, level: str = "summary") -> str:
        """
        ç”Ÿæˆä»»åŠ¡ä¸Šä¸‹æ–‡æ³¨å…¥æ–‡æœ¬

        Args:
            level: æ³¨å…¥çº§åˆ« (minimal/summary/full)

        Returns:
            ä¸Šä¸‹æ–‡æ–‡æœ¬ (æ³¨å…¥åˆ° Agent æç¤ºä¸­)
        """
        pass

    def get_minimal_context(self) -> str:
        """æœ€å°ä¸Šä¸‹æ–‡: ä»»åŠ¡ ID + å½“å‰é˜¶æ®µ"""
        pass

    def get_summary_context(self) -> str:
        """æ‘˜è¦ä¸Šä¸‹æ–‡: ä»»åŠ¡ä¿¡æ¯ + è¿›åº¦ + å¾…å¤„ç†æ ‡æ³¨"""
        pass

    def get_full_context(self) -> str:
        """å®Œæ•´ä¸Šä¸‹æ–‡: åŒ…å« research.md å’Œ plan.md å†…å®¹"""
        pass
```

### 6.6 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 1.5.1 | ç¼–å†™ `switch-task.md` æç¤ºè¯ | `prompts/switch-task.md` | æµç¨‹æ­¥éª¤æ¸…æ™° |
| 1.5.2 | ç¼–å†™ `new-task.md` æç¤ºè¯ | `prompts/new-task.md` | é›†æˆ Git + Why-First |
| 1.5.3 | ç¼–å†™ `view-task.md` æç¤ºè¯ | `prompts/view-task.md` | å¯åŠ¨ Task Viewer |
| 1.5.4 | æ›´æ–° `SKILL.md` æ³¨å†Œæ–°å‘½ä»¤ | `SKILL.md` | ä¸‰ä¸ªæ–°å‘½ä»¤å¯è¯†åˆ« |
| 1.5.5 | å®ç° `IntentDetector` | `intent_detector.py` | æ­£ç¡®æ£€æµ‹ä¸‰ç§æ„å›¾ |
| 1.5.6 | å®ç° `rigid-user-prompt.sh` | Hook è„šæœ¬ | æ™ºèƒ½æç¤ºç”¨æˆ· |
| 1.5.7 | å®ç° `ContextInjector` | `context_injector.py` | ä¸‰çº§ä¸Šä¸‹æ–‡æ³¨å…¥ |
| 1.5.8 | é…ç½® `settings.json` å¢åŠ  UserPromptSubmit | é…ç½®æ–‡ä»¶ | Hook æ­£ç¡®æ³¨å†Œ |
| 1.5.9 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_intent_detector.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 6.7 Gate å®Œæˆæ¡ä»¶

- [ ] `/nomos:switch-task t1` èƒ½åˆ‡æ¢ä»»åŠ¡å¹¶æ›´æ–° Git åˆ†æ”¯
- [ ] `/nomos:new-task user-login` èƒ½åˆ›å»ºä»»åŠ¡ + åˆ†æ”¯ + å¯åŠ¨ Why-First
- [ ] `/nomos:view-task` èƒ½å¯åŠ¨ Task Viewer å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
- [ ] UserPromptSubmit Hook èƒ½æ£€æµ‹ä»»åŠ¡åˆ‡æ¢/æ–°å»º/æŸ¥çœ‹æ„å›¾
- [ ] ä»»åŠ¡ä¸Šä¸‹æ–‡æŒ‰éœ€æ³¨å…¥ (minimal/summary/full) æ­£å¸¸å·¥ä½œ
- [ ] settings.json æ­£ç¡®æ³¨å†Œ UserPromptSubmit Hook
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 7. Gate 1.6: å†…å®¹åŒæ­¥

### 7.1 ç›®æ ‡

å®ç° WebSocket + è½®è¯¢æ··åˆåˆ·æ–°æœºåˆ¶ï¼Œå½“ Agent ä¿®æ”¹ Markdown æ–‡ä»¶æ—¶ï¼ŒTask Viewer è‡ªåŠ¨æ›´æ–°å†…å®¹ï¼ŒåŒæ—¶ä¿ç•™æ ‡æ³¨æ¡†çŠ¶æ€ã€‚

### 7.2 äº¤ä»˜ç‰©

| äº¤ä»˜ç‰© | è·¯å¾„ | è¯´æ˜ |
|--------|------|------|
| WebSocket æœåŠ¡ | `.claude/hooks/lib/ws_server.py` | WebSocket é€šä¿¡æœåŠ¡ |
| è½®è¯¢ API | `task_viewer.py` (æ‰©å±•) | mtime è½®è¯¢ç«¯ç‚¹ |
| å‰ç«¯åŒæ­¥æ¨¡å— | `viewer_template.html` (å†…åµŒ) | WebSocket å®¢æˆ·ç«¯ + è½®è¯¢å…œåº• |
| æ–‡ä»¶ç›‘æ§ | `.claude/hooks/lib/file_watcher.py` | æ–‡ä»¶å˜æ›´æ£€æµ‹ |

### 7.3 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å®¹åŒæ­¥æ¶æ„                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Agent ä¿®æ”¹æ–‡ä»¶                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent é€šè¿‡ Write/Edit ä¿®æ”¹ plan.md                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ–‡ä»¶ç›‘æ§ (FileWatcher)                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚  â”‚ mtime æ£€æµ‹     â”‚     â”‚ å˜æ›´äº‹ä»¶ç”Ÿæˆ   â”‚                          â”‚   â”‚
â”‚  â”‚  â”‚ (æ¯ 2 ç§’è½®è¯¢)  â”‚ â”€â”€â–º â”‚ file_changed   â”‚                          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚                                   â”‚                   â”‚
â”‚                    â–¼                                   â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  WebSocket æ¨é€ (ä¼˜å…ˆ)   â”‚     â”‚  HTTP è½®è¯¢ (å…œåº•)        â”‚           â”‚
â”‚  â”‚  ws://localhost:PORT/ws  â”‚     â”‚  GET /api/file/mtime     â”‚           â”‚
â”‚  â”‚                          â”‚     â”‚  (æ¯ 5 ç§’è½®è¯¢)           â”‚           â”‚
â”‚  â”‚  { "type":               â”‚     â”‚                          â”‚           â”‚
â”‚  â”‚    "file_changed",       â”‚     â”‚  è¿”å›: { "mtime": ... }  â”‚           â”‚
â”‚  â”‚    "file": "plan.md" }   â”‚     â”‚                          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚               â”‚                                 â”‚                         â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                             â”‚                                              â”‚
â”‚                             â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æµè§ˆå™¨å‰ç«¯åˆ·æ–°                                     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  1. æ”¶åˆ°å˜æ›´é€šçŸ¥                                                     â”‚   â”‚
â”‚  â”‚  2. ä¿å­˜å½“å‰æ ‡æ³¨æ¡†çŠ¶æ€ (æ‰“å¼€çš„æ¡†ã€è¾“å…¥å†…å®¹ã€æ»šåŠ¨ä½ç½®)                â”‚   â”‚
â”‚  â”‚  3. é‡æ–°è·å–æ–‡ä»¶å†…å®¹ (GET /api/file/{filename})                     â”‚   â”‚
â”‚  â”‚  4. é‡æ–°æ¸²æŸ“ Markdown/Mermaid                                       â”‚   â”‚
â”‚  â”‚  5. æ¢å¤æ ‡æ³¨æ¡†çŠ¶æ€                                                   â”‚   â”‚
â”‚  â”‚  6. æ¢å¤æ»šåŠ¨ä½ç½®                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 æ ¸å¿ƒæ¥å£

```python
# .claude/hooks/lib/ws_server.py

import asyncio
import json
from typing import Set, Optional
# æ³¨æ„: éœ€è¦å®‰è£… websockets åº“ (pip install websockets)

class WebSocketServer:
    """WebSocket é€šä¿¡æœåŠ¡"""

    def __init__(self, port: int):
        self.port = port
        self.clients: Set = set()
        self._server = None

    async def start(self) -> None:
        """å¯åŠ¨ WebSocket æœåŠ¡"""
        pass

    async def stop(self) -> None:
        """åœæ­¢ WebSocket æœåŠ¡"""
        pass

    async def broadcast(self, message: dict) -> None:
        """
        å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­æ¶ˆæ¯

        æ¶ˆæ¯æ ¼å¼:
        { "type": "file_changed", "file": "plan.md", "mtime": 1234567890 }
        """
        pass

    async def _handler(self, websocket, path) -> None:
        """å¤„ç† WebSocket è¿æ¥"""
        pass
```

```python
# .claude/hooks/lib/file_watcher.py

import os
import time
import threading
from typing import Dict, Callable, Optional

class FileWatcher:
    """æ–‡ä»¶å˜æ›´ç›‘æ§"""

    POLL_INTERVAL = 2.0  # è½®è¯¢é—´éš” (ç§’)

    def __init__(self, watch_dir: str):
        self.watch_dir = watch_dir
        self._mtimes: Dict[str, float] = {}
        self._callbacks: list = []
        self._running = False
        self._thread: Optional[threading.Thread] = None

    def start(self) -> None:
        """å¯åŠ¨æ–‡ä»¶ç›‘æ§"""
        pass

    def stop(self) -> None:
        """åœæ­¢æ–‡ä»¶ç›‘æ§"""
        pass

    def on_change(self, callback: Callable[[str, float], None]) -> None:
        """
        æ³¨å†Œå˜æ›´å›è°ƒ

        callback(file_path, new_mtime)
        """
        self._callbacks.append(callback)

    def _poll(self) -> None:
        """è½®è¯¢æ£€æµ‹æ–‡ä»¶å˜æ›´"""
        while self._running:
            for filename in os.listdir(self.watch_dir):
                if filename.endswith('.md'):
                    filepath = os.path.join(self.watch_dir, filename)
                    mtime = os.path.getmtime(filepath)
                    if filepath in self._mtimes:
                        if mtime > self._mtimes[filepath]:
                            for cb in self._callbacks:
                                cb(filepath, mtime)
                    self._mtimes[filepath] = mtime
            time.sleep(self.POLL_INTERVAL)
```

è½®è¯¢ API ç«¯ç‚¹ (æ‰©å±• `task_viewer.py`):

```python
# åœ¨ TaskViewerServer ä¸­å¢åŠ çš„ API ç«¯ç‚¹

class TaskViewerHandler(SimpleHTTPRequestHandler):
    """æ‰©å±•çš„ HTTP è¯·æ±‚å¤„ç†å™¨"""

    def do_GET(self):
        # GET /api/file/{filename}/mtime
        # è¿”å›æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´
        if self.path.startswith("/api/file/") and self.path.endswith("/mtime"):
            filename = self.path.split("/")[3]
            filepath = os.path.join(self.server.task_path, filename)
            if os.path.exists(filepath):
                mtime = os.path.getmtime(filepath)
                self._send_json({"mtime": mtime, "file": filename})
            else:
                self._send_json({"error": "File not found"}, 404)
            return

        # GET /api/file/{filename}
        # è¿”å›æ–‡ä»¶å†…å®¹
        if self.path.startswith("/api/file/"):
            filename = self.path.split("/")[3]
            filepath = os.path.join(self.server.task_path, filename)
            if os.path.exists(filepath):
                with open(filepath, "r") as f:
                    content = f.read()
                self._send_json({"content": content, "file": filename})
            else:
                self._send_json({"error": "File not found"}, 404)
            return

        super().do_GET()

    def _send_json(self, data: dict, status: int = 200):
        """å‘é€ JSON å“åº”"""
        self.send_response(status)
        self.send_header("Content-Type", "application/json")
        self.send_header("Access-Control-Allow-Origin", "*")
        self.end_headers()
        self.wfile.write(json.dumps(data).encode())
```

### 7.5 åˆ·æ–°ç­–ç•¥

| åœºæ™¯ | ç­–ç•¥ | è¯´æ˜ |
|------|------|------|
| WebSocket è¿æ¥æ­£å¸¸ | å®æ—¶æ¨é€ | æ–‡ä»¶å˜æ›´åç«‹å³é€šçŸ¥æµè§ˆå™¨ |
| WebSocket æ–­å¼€ | è‡ªåŠ¨é™çº§ä¸ºè½®è¯¢ | æ¯ 5 ç§’æ£€æŸ¥ mtime |
| WebSocket é‡è¿ | è‡ªåŠ¨é‡è¿ (æŒ‡æ•°é€€é¿) | 1s â†’ 2s â†’ 4s â†’ 8s â†’ æœ€å¤§ 30s |
| åˆ·æ–°æ—¶æ ‡æ³¨æ¡†æ‰“å¼€ | ä¿ç•™æ ‡æ³¨æ¡†çŠ¶æ€ | åªæ›´æ–°å†…å®¹åŒºï¼Œä¸å…³é—­æ ‡æ³¨æ¡† |
| åˆ·æ–°æ—¶æ­£åœ¨è¾“å…¥ | å»¶è¿Ÿåˆ·æ–° | ç­‰å¾…è¾“å…¥å®Œæˆåå†åˆ·æ–° |

### 7.6 æºç è¡Œå·å…œåº•

å½“æ¸²æŸ“è§†å›¾ä¸­çš„è¡Œå·ä¸æºç è¡Œå·ä¸ä¸€è‡´æ—¶ (å¦‚ Mermaid æ¸²æŸ“åè¡Œæ•°å˜åŒ–)ï¼Œä½¿ç”¨ä»¥ä¸‹å…œåº•ç­–ç•¥:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æºç è¡Œå·å…œåº•ç­–ç•¥                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. ä¼˜å…ˆä½¿ç”¨æºç è¡Œå· (line:42)                                              â”‚
â”‚     - åœ¨æºç è§†å›¾ä¸­ç²¾ç¡®å®šä½                                                  â”‚
â”‚     - åœ¨æ¸²æŸ“è§†å›¾ä¸­é€šè¿‡ data-source-line å±æ€§å®šä½                            â”‚
â”‚                                                                              â”‚
â”‚  2. å—çº§æ ‡æ³¨ä½¿ç”¨å— ID                                                       â”‚
â”‚     - code_block:15-25 â†’ å®šä½åˆ°ç¬¬ 15-25 è¡Œçš„ä»£ç å—                         â”‚
â”‚     - mermaid_block:30-45 â†’ å®šä½åˆ°ç¬¬ 30-45 è¡Œçš„ Mermaid å—                 â”‚
â”‚                                                                              â”‚
â”‚  3. å†…å®¹å˜æ›´åè¡Œå·æ¼‚ç§»å¤„ç†                                                  â”‚
â”‚     - è®°å½•æ ‡æ³¨é™„è¿‘çš„ä¸Šä¸‹æ–‡æ–‡æœ¬ (å‰åå„ 2 è¡Œ)                                â”‚
â”‚     - æ–‡ä»¶å˜æ›´åï¼Œé€šè¿‡ä¸Šä¸‹æ–‡æ–‡æœ¬æ¨¡ç³ŠåŒ¹é…é‡æ–°å®šä½                            â”‚
â”‚     - å¦‚æœåŒ¹é…å¤±è´¥ï¼Œæ ‡è®°ä¸º "è¡Œå·å·²æ¼‚ç§»ï¼Œè¯·æ‰‹åŠ¨ç¡®è®¤"                         â”‚
â”‚                                                                              â”‚
â”‚  4. æ¸²æŸ“è§†å›¾è¡Œå·æ˜ å°„                                                        â”‚
â”‚     - marked.js æ¸²æŸ“æ—¶æ³¨å…¥ data-source-line="{N}" å±æ€§                     â”‚
â”‚     - é€šè¿‡è¯¥å±æ€§å°†æ¸²æŸ“åçš„ DOM å…ƒç´ æ˜ å°„å›æºç è¡Œå·                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.7 å®æ–½æ­¥éª¤

| æ­¥éª¤ | æè¿° | æ¶‰åŠæ–‡ä»¶ | éªŒæ”¶æ¡ä»¶ |
|------|------|----------|----------|
| 1.6.1 | å®ç° `FileWatcher` æ–‡ä»¶ç›‘æ§ | `file_watcher.py` | æ£€æµ‹ MD æ–‡ä»¶å˜æ›´ |
| 1.6.2 | å®ç° `WebSocketServer` | `ws_server.py` | WebSocket è¿æ¥å’Œå¹¿æ’­ |
| 1.6.3 | å®ç°è½®è¯¢ API ç«¯ç‚¹ | `task_viewer.py` | mtime å’Œ content API |
| 1.6.4 | å®ç°å‰ç«¯ WebSocket å®¢æˆ·ç«¯ | `viewer_template.html` | æ¥æ”¶æ¨é€å¹¶åˆ·æ–° |
| 1.6.5 | å®ç°å‰ç«¯è½®è¯¢å…œåº• | `viewer_template.html` | WebSocket æ–­å¼€æ—¶é™çº§ |
| 1.6.6 | å®ç°åˆ·æ–°æ—¶æ ‡æ³¨æ¡†çŠ¶æ€ä¿ç•™ | `viewer_template.html` | åˆ·æ–°ä¸ä¸¢å¤±æ ‡æ³¨çŠ¶æ€ |
| 1.6.7 | å®ç°æºç è¡Œå·å…œåº• (data-source-line) | `viewer_template.html` | è¡Œå·æ˜ å°„æ­£ç¡® |
| 1.6.8 | å®ç°è¡Œå·æ¼‚ç§»æ£€æµ‹å’Œæ¨¡ç³ŠåŒ¹é… | `annotation_manager.py` | æ¼‚ç§»åé‡æ–°å®šä½ |
| 1.6.9 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/test_sync.py` | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### 7.8 Gate å®Œæˆæ¡ä»¶

- [ ] WebSocket æœåŠ¡èƒ½å‘æµè§ˆå™¨æ¨é€æ–‡ä»¶å˜æ›´é€šçŸ¥
- [ ] è½®è¯¢ API (`/api/file/{filename}/mtime`) æ­£å¸¸å·¥ä½œ
- [ ] WebSocket æ–­å¼€æ—¶è‡ªåŠ¨é™çº§ä¸ºè½®è¯¢
- [ ] æ–‡ä»¶å˜æ›´åæµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°å†…å®¹
- [ ] åˆ·æ–°æ—¶ä¿ç•™æ‰“å¼€çš„æ ‡æ³¨æ¡†çŠ¶æ€å’Œè¾“å…¥å†…å®¹
- [ ] `data-source-line` å±æ€§æ­£ç¡®æ³¨å…¥ï¼Œè¡Œå·æ˜ å°„å‡†ç¡®
- [ ] è¡Œå·æ¼‚ç§»æ—¶èƒ½é€šè¿‡ä¸Šä¸‹æ–‡æ¨¡ç³ŠåŒ¹é…é‡æ–°å®šä½
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 8. Gate é—´ä¾èµ–å…³ç³»

### 8.1 ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Gate ä¾èµ–å…³ç³»                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Gate 1.1 (Task Viewer åŸºç¡€)                                                â”‚
â”‚     â”‚                                                                        â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚                                                  â”‚                    â”‚
â”‚     â–¼                                                  â”‚                    â”‚
â”‚  Gate 1.2 (æ ‡æ³¨ç³»ç»Ÿ)                                   â”‚                    â”‚
â”‚     â”‚                                                  â”‚                    â”‚
â”‚     â”‚                                                  â”‚                    â”‚
â”‚     â”‚         Gate 1.3 (Why-First å¼•æ“) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚     â”‚            â”‚                                                          â”‚
â”‚     â”‚            â”‚                                                          â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚     â”‚                                                                        â”‚
â”‚     â–¼                                                                        â”‚
â”‚  Gate 1.4 (Git é›†æˆ)                                                        â”‚
â”‚     â”‚                                                                        â”‚
â”‚     â–¼                                                                        â”‚
â”‚  Gate 1.5 (ä»»åŠ¡ç®¡ç†å¢å¼º)                                                    â”‚
â”‚     â”‚                                                                        â”‚
â”‚     â–¼                                                                        â”‚
â”‚  Gate 1.6 (å†…å®¹åŒæ­¥)                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ä¾èµ–çŸ©é˜µ

| Gate | ä¾èµ– | å¯å¹¶è¡Œ | è¯´æ˜ |
|------|------|--------|------|
| 1.1 Task Viewer åŸºç¡€ | Phase 0 å®Œæˆ | - | Phase 1 å…¥å£ |
| 1.2 æ ‡æ³¨ç³»ç»Ÿ | 1.1 | ä¸ 1.3 å¹¶è¡Œ | ä¾èµ– Task Viewer UI |
| 1.3 Why-First å¼•æ“ | 1.1 | ä¸ 1.2 å¹¶è¡Œ | ä¾èµ– Task Viewer å±•ç¤º |
| 1.4 Git é›†æˆ | 1.2, 1.3 | ä¸å¯å¹¶è¡Œ | ä¾èµ–æ ‡æ³¨å’Œ Why-First |
| 1.5 ä»»åŠ¡ç®¡ç†å¢å¼º | 1.4 | ä¸å¯å¹¶è¡Œ | ä¾èµ– Git åˆ†æ”¯ç®¡ç† |
| 1.6 å†…å®¹åŒæ­¥ | 1.5 | ä¸å¯å¹¶è¡Œ | ä¾èµ–å®Œæ•´ä»»åŠ¡ç®¡ç† |

### 8.3 æ¨èå¼€å‘é¡ºåº

```
æ—¶é—´çº¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

  Gate 1.1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚
              Gate 1.2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                  â”œâ”€â”€â–º Gate 1.4 â”€â”€â–º Gate 1.5 â”€â”€â–º Gate 1.6
              Gate 1.3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                  â”‚
                                                  â”˜
```

---

## 9. éªŒæ”¶æ ‡å‡†

### 9.1 ç«¯åˆ°ç«¯éªŒæ”¶åœºæ™¯

**åœºæ™¯: å®Œæˆä¸€ä¸ªä»»åŠ¡çš„å®Œæ•´ Phase 1 å·¥ä½œæµ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 1 ç«¯åˆ°ç«¯éªŒæ”¶æµç¨‹                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Step 1: åˆ›å»ºä»»åŠ¡                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨æˆ·: /nomos:new-task user-login --type=feat                    â”‚   â”‚
â”‚  â”‚ æœŸæœ›:                                                                â”‚   â”‚
â”‚  â”‚   - åˆ›å»º tasks/t1-2026-02-25-user-login/                           â”‚   â”‚
â”‚  â”‚   - åˆ›å»º Git åˆ†æ”¯ feat/t1-2026-02-25-user-login                    â”‚   â”‚
â”‚  â”‚   - å¯åŠ¨ Why-First é˜¶æ®µ                                             â”‚   â”‚
â”‚  â”‚   - æ‰“å¼€ Task Viewer (æµè§ˆå™¨)                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 2: Why-First é˜¶æ®µ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent: ç”Ÿæˆ Why é—®é¢˜ (ä¸šåŠ¡/æŠ€æœ¯/é£é™©/ç”¨æˆ·å½±å“)                      â”‚   â”‚
â”‚  â”‚ Agent: å›ç­”æ‰€æœ‰ Why é—®é¢˜                                             â”‚   â”‚
â”‚  â”‚ Agent: æ›´æ–° project-why.md                                           â”‚   â”‚
â”‚  â”‚ æœŸæœ›: Why-First è´¨é‡æ£€æŸ¥é€šè¿‡                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 3: Research + æ ‡æ³¨å¾ªç¯                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent: å¡«å…… research.md                                              â”‚   â”‚
â”‚  â”‚ ç”¨æˆ·: åœ¨ Task Viewer ä¸­å³é”®åˆ›å»ºæ ‡æ³¨                                  â”‚   â”‚
â”‚  â”‚ Agent: å¤„ç†æ ‡æ³¨ï¼Œæ ‡è®° addressed                                      â”‚   â”‚
â”‚  â”‚ æœŸæœ›: æ ‡æ³¨åœ¨ Task Viewer ä¸­å®æ—¶æ›´æ–°                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 4: Plan + æ ‡æ³¨å¾ªç¯                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent: ç”Ÿæˆ plan.md                                                  â”‚   â”‚
â”‚  â”‚ ç”¨æˆ·: åœ¨ Task Viewer ä¸­æ ‡æ³¨                                          â”‚   â”‚
â”‚  â”‚ Agent: å¤„ç†æ ‡æ³¨                                                      â”‚   â”‚
â”‚  â”‚ æœŸæœ›: Task Viewer å†…å®¹åŠ¨æ€åˆ·æ–°ï¼Œæ ‡æ³¨æ¡†çŠ¶æ€ä¿ç•™                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 5: Execute + Gate commit                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent: æŒ‰ Phase Gates é€æ­¥å®ç°                                       â”‚   â”‚
â”‚  â”‚ Agent: æ¯å®Œæˆä¸€ä¸ª Gate â†’ è‡ªåŠ¨ commit                                 â”‚   â”‚
â”‚  â”‚ æœŸæœ›: commit message æ ¼å¼ [Gate X.Y] æè¿°                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                               â”‚
â”‚  Step 6: ä»»åŠ¡åˆ‡æ¢                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨æˆ·: /nomos:switch-task t2                                     â”‚   â”‚
â”‚  â”‚ æœŸæœ›: åˆ‡æ¢ current-task.txt + Git åˆ†æ”¯ + ä¸Šä¸‹æ–‡                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 éªŒæ”¶ Checklist

| éªŒæ”¶é¡¹ | æè¿° | Gate | çŠ¶æ€ |
|--------|------|------|------|
| Task Viewer å¯åŠ¨ | HTTP æœåŠ¡å™¨å¯åŠ¨å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ | 1.1 | [ ] |
| Markdown æ¸²æŸ“ | marked.js æ­£ç¡®æ¸²æŸ“ Markdown å†…å®¹ | 1.1 | [ ] |
| Mermaid æ¸²æŸ“ | mermaid.js æ­£ç¡®æ¸²æŸ“å›¾è¡¨ | 1.1 | [ ] |
| åŠ¨æ€ç«¯å£ | ç«¯å£å†²çªæ—¶è‡ªåŠ¨é€’å¢ | 1.1 | [ ] |
| è‡ªåŠ¨å…³é—­ | 30 åˆ†é’Ÿæ— è¯·æ±‚è‡ªåŠ¨å…³é—­ | 1.1 | [ ] |
| å³é”®åˆ›å»ºæ ‡æ³¨ | å³é”®ç‚¹å‡»è¡Œå¼¹å‡ºæ ‡æ³¨æ¡† | 1.2 | [ ] |
| å·¦é”®æŸ¥çœ‹æ ‡æ³¨ | å·¦é”®ç‚¹å‡»æ ‡è®°ç‚¹å¼¹å‡ºè¯¦æƒ… | 1.2 | [ ] |
| æ ‡æ³¨æŒä¹…åŒ– | æ ‡æ³¨å†™å…¥ MD æ–‡ä»¶ Review Comments èŠ‚ | 1.2 | [ ] |
| æ ‡æ³¨çŠ¶æ€æµè½¬ | pending â†’ addressed / wont_fix | 1.2 | [ ] |
| å—çº§æ ‡æ³¨ | ä»£ç å—/Mermaid/è¡¨æ ¼æ ‡æ³¨æ­£å¸¸ | 1.2 | [ ] |
| è§†å›¾åˆ‡æ¢ | æ¸²æŸ“/æºç è§†å›¾åˆ‡æ¢ä¿ç•™çŠ¶æ€ | 1.2 | [ ] |
| Why é—®é¢˜ç”Ÿæˆ | ç”Ÿæˆ 4 ç±» Why é—®é¢˜ | 1.3 | [ ] |
| Why è´¨é‡æ£€æŸ¥ | å›ç­”è´¨é‡éªŒè¯é€šè¿‡/å¤±è´¥ | 1.3 | [ ] |
| project-why æ›´æ–° | æ–°çŸ¥è¯†å†™å…¥ project-why.md | 1.3 | [ ] |
| Why-First é—¨æ§ | æœªå®Œæˆæ—¶ Stop Hook é˜»å¡ | 1.3 | [ ] |
| è‡ªåŠ¨åˆ†æ”¯åˆ›å»º | ä»»åŠ¡å¯åŠ¨æ—¶åˆ›å»º Git åˆ†æ”¯ | 1.4 | [ ] |
| Gate commit | Gate å®Œæˆæ—¶è‡ªåŠ¨ commit | 1.4 | [ ] |
| commit æ ¼å¼ | commit message ç¬¦åˆ [Gate X.Y] è§„èŒƒ | 1.4 | [ ] |
| switch-task | åˆ‡æ¢ä»»åŠ¡ + Git åˆ†æ”¯ + ä¸Šä¸‹æ–‡ | 1.5 | [ ] |
| new-task | åˆ›å»ºä»»åŠ¡ + åˆ†æ”¯ + Why-First | 1.5 | [ ] |
| view-task | å¯åŠ¨ Task Viewer | 1.5 | [ ] |
| æ„å›¾æ£€æµ‹ | UserPromptSubmit æ£€æµ‹ä»»åŠ¡æ„å›¾ | 1.5 | [ ] |
| WebSocket æ¨é€ | æ–‡ä»¶å˜æ›´å®æ—¶æ¨é€ | 1.6 | [ ] |
| è½®è¯¢å…œåº• | WebSocket æ–­å¼€æ—¶é™çº§è½®è¯¢ | 1.6 | [ ] |
| åˆ·æ–°ä¿ç•™çŠ¶æ€ | åˆ·æ–°æ—¶æ ‡æ³¨æ¡†çŠ¶æ€ä¸ä¸¢å¤± | 1.6 | [ ] |
| è¡Œå·å…œåº• | è¡Œå·æ¼‚ç§»æ—¶æ¨¡ç³ŠåŒ¹é…å®šä½ | 1.6 | [ ] |

---

## 10. æŠ€æœ¯å†³ç­–è®°å½•

### TDR-1.1: å‰ç«¯æ— æ¡†æ¶ (çº¯ JS)

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| å†³ç­– | ä½¿ç”¨çº¯ HTML5/CSS3/JavaScriptï¼Œä¸å¼•å…¥ React/Vue ç­‰æ¡†æ¶ |
| ç†ç”± | Task Viewer æ˜¯è½»é‡çº§å·¥å…·ï¼Œé¡µé¢å¤æ‚åº¦æœ‰é™ï¼›çº¯ JS æ— éœ€æ„å»ºå·¥å…·é“¾ï¼Œå‡å°‘ä¾èµ–ï¼›CDN å¼•å…¥ marked.js å’Œ mermaid.js å³å¯æ»¡è¶³æ¸²æŸ“éœ€æ±‚ï¼›é™ä½é¡¹ç›®ç»´æŠ¤æˆæœ¬ |
| æ›¿ä»£æ–¹æ¡ˆ | React/Vue SPA |
| æ›¿ä»£æ–¹æ¡ˆç¼ºç‚¹ | éœ€è¦ Node.js æ„å»ºç¯å¢ƒã€å¢åŠ é¡¹ç›®å¤æ‚åº¦ã€å¯¹äºæ–‡æ¡£æŸ¥çœ‹å™¨è¿‡åº¦è®¾è®¡ |
| é£é™© | å¦‚æœæœªæ¥ UI å¤æ‚åº¦å¤§å¹…å¢åŠ ï¼Œå¯èƒ½éœ€è¦è¿ç§»åˆ°æ¡†æ¶ |
| ç¼“è§£ | ä¿æŒ JS ä»£ç æ¨¡å—åŒ–ï¼Œä¾¿äºæœªæ¥è¿ç§» |

### TDR-1.2: WebSocket + è½®è¯¢æ··åˆ

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| å†³ç­– | ä¼˜å…ˆä½¿ç”¨ WebSocket æ¨é€ï¼ŒWebSocket ä¸å¯ç”¨æ—¶é™çº§ä¸º HTTP è½®è¯¢ |
| ç†ç”± | WebSocket æä¾›å®æ—¶æ€§ï¼›è½®è¯¢ä½œä¸ºå…œåº•ç¡®ä¿å¯é æ€§ï¼›æ··åˆæ–¹æ¡ˆå…¼é¡¾æ€§èƒ½å’Œç¨³å®šæ€§ |
| æ›¿ä»£æ–¹æ¡ˆ A | çº¯ WebSocket |
| æ›¿ä»£æ–¹æ¡ˆ A ç¼ºç‚¹ | è¿æ¥æ–­å¼€æ—¶æ— æ³•è·å–æ›´æ–°ï¼Œéœ€è¦å¤æ‚çš„é‡è¿å’ŒçŠ¶æ€åŒæ­¥é€»è¾‘ |
| æ›¿ä»£æ–¹æ¡ˆ B | çº¯è½®è¯¢ |
| æ›¿ä»£æ–¹æ¡ˆ B ç¼ºç‚¹ | å»¶è¿Ÿé«˜ (å–å†³äºè½®è¯¢é—´éš”)ï¼Œé¢‘ç¹è½®è¯¢æµªè´¹èµ„æº |
| é£é™© | WebSocket åº“ (websockets) éœ€è¦é¢å¤–å®‰è£… |
| ç¼“è§£ | è½®è¯¢å…œåº•ç¡®ä¿å³ä½¿ WebSocket ä¸å¯ç”¨ä¹Ÿèƒ½å·¥ä½œ |

### TDR-1.3: æ ‡æ³¨å­˜å‚¨åœ¨ MD æ–‡ä»¶ä¸­

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| å†³ç­– | æ ‡æ³¨æ•°æ®å­˜å‚¨åœ¨ Markdown æ–‡ä»¶çš„ `## 8. Review Comments` èŠ‚ä¸­ |
| ç†ç”± | ä¸æ–‡æ¡£ä¸€ä½“åŒ–ï¼ŒGit å‹å¥½ï¼›äººç±»å¯ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹å’Œç¼–è¾‘æ ‡æ³¨ï¼›æ— éœ€é¢å¤–çš„æ•°æ®åº“æˆ– JSON æ–‡ä»¶ï¼›è·¨ä¼šè¯è‡ªç„¶æŒä¹…åŒ– |
| æ›¿ä»£æ–¹æ¡ˆ | ç‹¬ç«‹ JSON æ–‡ä»¶ (å¦‚ `annotations.json`) |
| æ›¿ä»£æ–¹æ¡ˆç¼ºç‚¹ | éœ€è¦é¢å¤–çš„æ–‡ä»¶ç®¡ç†ï¼›æ ‡æ³¨ä¸æ–‡æ¡£åˆ†ç¦»ï¼Œä¸ç›´è§‚ï¼›åˆå¹¶å†²çªæ—¶éš¾ä»¥å¤„ç† |
| é£é™© | MD æ–‡ä»¶è§£æå¤æ‚åº¦è¾ƒé«˜ï¼›æ ‡æ³¨æ ¼å¼å˜æ›´éœ€è¦è¿ç§» |
| ç¼“è§£ | ä½¿ç”¨ä¸¥æ ¼çš„ Markdown æ ¼å¼è§„èŒƒï¼›æä¾›è§£æå™¨å•å…ƒæµ‹è¯• |

### TDR-1.4: CDN å¼•å…¥ç¬¬ä¸‰æ–¹åº“

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| å†³ç­– | é€šè¿‡ CDN (jsdelivr) å¼•å…¥ marked.js å’Œ mermaid.js |
| ç†ç”± | æ— éœ€ npm/æ„å»ºå·¥å…·ï¼›CDN ç¼“å­˜åŠ é€ŸåŠ è½½ï¼›ç‰ˆæœ¬é”å®šç¡®ä¿ç¨³å®šæ€§ï¼›å‡å°‘é¡¹ç›®ä½“ç§¯ |
| æ›¿ä»£æ–¹æ¡ˆ | npm å®‰è£… + æ‰“åŒ… (webpack/vite) |
| æ›¿ä»£æ–¹æ¡ˆç¼ºç‚¹ | éœ€è¦ Node.js ç¯å¢ƒå’Œæ„å»ºå·¥å…·é“¾ï¼›å¢åŠ é¡¹ç›®å¤æ‚åº¦ï¼›å¯¹äºè½»é‡çº§å·¥å…·è¿‡åº¦è®¾è®¡ |
| é£é™© | ç¦»çº¿ç¯å¢ƒæ— æ³•åŠ è½½ CDN èµ„æº |
| ç¼“è§£ | `generate_html()` ç”Ÿæˆçš„é™æ€é¡µé¢å†…è”æ‰€æœ‰ä¾èµ–ï¼Œæ”¯æŒç¦»çº¿æŸ¥çœ‹ |

---

## 11. æ–‡ä»¶æ¸…å•

### 11.1 æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ç±»å‹ | Gate | è¯´æ˜ |
|------|------|------|------|
| `.claude/hooks/lib/task_viewer.py` | Python | 1.1 | Task Viewer HTTP æœåŠ¡å™¨ |
| `.claude/hooks/lib/viewer_template.html` | HTML | 1.1 | å‰ç«¯é¡µé¢æ¨¡æ¿ |
| `.claude/hooks/lib/viewer_generator.py` | Python | 1.1 | é™æ€ HTML ç”Ÿæˆå™¨ |
| `.claude/hooks/rigid-view-task.sh` | Shell | 1.1 | Task Viewer å¯åŠ¨è„šæœ¬ |
| `.claude/hooks/lib/annotation_manager.py` | Python | 1.2 | æ ‡æ³¨ç®¡ç†å™¨ |
| `.claude/hooks/lib/why_first_engine.py` | Python | 1.3 | Why-First å¼•æ“ |
| `.claude/hooks/lib/project_why_manager.py` | Python | 1.3 | project-why ç®¡ç† |
| `.claude/hooks/lib/git_integration.py` | Python | 1.4 | Git é›†æˆæ¨¡å— |
| `.claude/hooks/lib/intent_detector.py` | Python | 1.5 | ç”¨æˆ·æ„å›¾æ£€æµ‹å™¨ |
| `.claude/hooks/lib/context_injector.py` | Python | 1.5 | ä»»åŠ¡ä¸Šä¸‹æ–‡æ³¨å…¥ |
| `.claude/hooks/rigid-user-prompt.sh` | Shell | 1.5 | UserPromptSubmit Hook |
| `.claude/hooks/lib/ws_server.py` | Python | 1.6 | WebSocket æœåŠ¡ |
| `.claude/hooks/lib/file_watcher.py` | Python | 1.6 | æ–‡ä»¶å˜æ›´ç›‘æ§ |
| `.claude/skills/nomos/prompts/switch-task.md` | Prompt | 1.5 | åˆ‡æ¢ä»»åŠ¡æç¤ºè¯ |
| `.claude/skills/nomos/prompts/new-task.md` | Prompt | 1.5 | æ–°å»ºä»»åŠ¡æç¤ºè¯ |
| `.claude/skills/nomos/prompts/view-task.md` | Prompt | 1.5 | æŸ¥çœ‹ä»»åŠ¡æç¤ºè¯ |
| `tests/test_task_viewer.py` | Test | 1.1 | Task Viewer å•å…ƒæµ‹è¯• |
| `tests/test_annotation.py` | Test | 1.2 | æ ‡æ³¨ç³»ç»Ÿå•å…ƒæµ‹è¯• |
| `tests/test_why_first.py` | Test | 1.3 | Why-First å•å…ƒæµ‹è¯• |
| `tests/test_git_integration.py` | Test | 1.4 | Git é›†æˆå•å…ƒæµ‹è¯• |
| `tests/test_intent_detector.py` | Test | 1.5 | æ„å›¾æ£€æµ‹å•å…ƒæµ‹è¯• |
| `tests/test_sync.py` | Test | 1.6 | å†…å®¹åŒæ­¥å•å…ƒæµ‹è¯• |

### 11.2 ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | Gate | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| `.claude/settings.json` | 1.5 | å¢åŠ  UserPromptSubmit Hook é…ç½® |
| `.claude/hooks/nomos-stop.sh` | 1.3, 1.4 | å¢åŠ  Why-First æ£€æŸ¥ + Gate commit è§¦å‘ |
| `.claude/skills/nomos/SKILL.md` | 1.5 | æ³¨å†Œ switch-task/new-task/view-task å‘½ä»¤ |
| `.claude/skills/nomos/prompts/start.md` | 1.4 | å¢åŠ  Git åˆ†æ”¯åˆ›å»ºæ­¥éª¤ |
| `.claude/templates/research.md` | 1.3 | å¢åŠ  Why-First èŠ‚ |
| `project-why.md` | 1.3 | æ›´æ–°çŸ¥è¯†åº“ç»“æ„ |

---

## é™„å½•

### A. éœ€æ±‚è¿½æº¯çŸ©é˜µ

| Gate | å…³è” FR | å…³è” US |
|------|---------|---------|
| 1.1 Task Viewer åŸºç¡€ | FR-023, FR-024, FR-025, FR-026, FR-027, FR-028 | US-004 |
| 1.2 æ ‡æ³¨ç³»ç»Ÿ | FR-005, FR-029, FR-030, FR-031, FR-032, FR-033, FR-034 | US-003, US-005 |
| 1.3 Why-First å¼•æ“ | FR-011, FR-012 | US-001 |
| 1.4 Git é›†æˆ | FR-036, FR-037, FR-112, FR-113, FR-126 | US-103 |
| 1.5 ä»»åŠ¡ç®¡ç†å¢å¼º | FR-018, FR-019, FR-020, FR-115, FR-116 | US-110, US-113 |
| 1.6 å†…å®¹åŒæ­¥ | FR-035, FR-121, FR-123, FR-124 | US-004 |

### B. æŠ€æœ¯å†³ç­–ç´¢å¼•

| å†³ç­– ID | æ ‡é¢˜ | é€‰æ‹© |
|---------|------|------|
| TDR-1.1 | å‰ç«¯æ¡†æ¶é€‰å‹ | çº¯ JS (æ— æ¡†æ¶) |
| TDR-1.2 | å®æ—¶é€šä¿¡æ–¹æ¡ˆ | WebSocket + è½®è¯¢æ··åˆ |
| TDR-1.3 | æ ‡æ³¨å­˜å‚¨æ–¹æ¡ˆ | MD æ–‡ä»¶å†…åµŒ |
| TDR-1.4 | ç¬¬ä¸‰æ–¹åº“å¼•å…¥æ–¹å¼ | CDN |

---

*æœ€åæ›´æ–°: 2026-02-25*
